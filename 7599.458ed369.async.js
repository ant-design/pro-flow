"use strict";(self.webpackChunk_ant_design_pro_flow=self.webpackChunk_ant_design_pro_flow||[]).push([[7599],{70020:function(k,w,n){n.d(w,{F:function(){return I}});var $=n(26068),R=n.n($),L=n(48305),H=n.n(L),T=n(67825),A=n.n(T),x=n(96855),f=n(79810),D=n(50959),h=n(11527),B=["value","onChange","onValueChanging","onChangeEnd"],I=(0,D.memo)(function(N){var d=N.value,O=N.onChange,C=N.onValueChanging,m=N.onChangeEnd,g=A()(N,B),y=d||"",P=(0,D.useState)(y),j=H()(P,2),l=j[0],u=j[1],K=(0,D.useRef)(null),E=(0,D.useRef)(!1),S=(0,D.useRef)(!1),F=(0,D.useCallback)(function(){O==null||O(l)},[l]);return(0,D.useEffect)(function(){typeof d!="undefined"&&u(d)},[d]),(0,h.jsx)(f.I,R()(R()({ref:K},g),{},{value:l,onCompositionStart:function(){E.current=!0},onCompositionEnd:function(){E.current=!1},onFocus:function(){S.current=!0},onBlur:function(){S.current=!1,m==null||m(l)},onChange:function(p){u(p.target.value),C==null||C(p.target.value)},onPressEnter:function(p){!p.shiftKey&&!E.current&&(p.preventDefault(),F(),S.current=!1,m==null||m(l))},suffix:d===l?(0,h.jsx)("span",{}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(x.ZP,{type:"link",size:"small",onClick:function(){u(d)},style:{padding:0},children:"\u91CD\u7F6E"}),(0,h.jsx)(x.ZP,{type:"link",size:"small",style:{padding:0},onClick:function(){F()},children:"\u4FDD\u5B58 \u21B5"})]})}))})},48828:function(k,w,n){n.d(w,{AC:function(){return B},iq:function(){return d},oR:function(){return h}});var $=n(15558),R=n.n($),L=n(50959),H=n(69323),T=n(13422),A=n(29130),x=n(11527),f=function(C){var m=C.collapsedKeys,g=C.onCollapsedKeysChange;return(0,H.Ue)(function(y,P){return{collapsedKeys:m!=null?m:[],onCollapsedKeysChange:g,toggleCollapsedKey:function(l){var u,K,E=[];P().collapsedKeys.includes(l)?E=P().collapsedKeys.filter(function(S){return S!==l}):E=[].concat(R()(P().collapsedKeys),[l]),y({collapsedKeys:E}),(u=(K=P()).onCollapsedKeysChange)===null||u===void 0||u.call(K,E)}}})},D=(0,T.k)(),h=D.useStore,B=D.useStoreApi,I=D.Provider,N=(0,L.memo)(function(O){var C=O.collapsedKeys,m=B(),g=(0,A.N)(m);return g("collapsedKeys",C),null}),d=(0,L.memo)(function(O){var C=O.children,m=O.defaultCollapsedKeys,g=O.onCollapsedKeysChange,y=O.collapsedKeys;return(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)(I,{createStore:function(){return f({collapsedKeys:m,onCollapsedKeysChange:g})},children:[C,(0,x.jsx)(N,{collapsedKeys:y})]})})})},77599:function(k,w,n){var $=n(26068),R=n.n($),L=n(67825),H=n.n(L),T=n(53649),A=n.n(T),x=n(59318),f=n(25452),D=n(73523),h=n(50959),B=n(36036),I=n(75364),N=n(48828),d=n(11527),O=["id","onTitleChange","onCollapsedKeysChange"],C,m,g=(0,D.kc)(function(l){var u=l.css,K=l.token,E=l.prefixCls;return{container:u(C||(C=A()([`
    will-change: transform;
    width: 100%;
    max-width: 600px;
    border: 1px solid `,`;
    border-radius: 12px;
    .`,`-card-head {
      padding-right: 16px;
    }

    .editor-field-item-container:not(:last-child) {
      margin-bottom: 24px;
    }
  `])),K.colorBorder,E),selected:u(m||(m=A()([`
    border-color: `,`;
    border-width: 2px;
    box-shadow: 0 9px 25px -6px rgba(0, 0, 0, 0.1);
  `])),K.colorPrimary)}}),y=(0,h.memo)(function(l){var u=l.active,K=l.collapsedKeys,E=l.onCollapsedKeysChange,S=l.onTitleChange,F=l.style,W=l.className,p=l.title,ee=l.children,G=l.extra,Q=g(),X=Q.styles,te=Q.cx,q=(0,h.useRef)(null);return(0,d.jsx)(x.ZP,{getPopupContainer:function(){return q.current||document.body},children:(0,d.jsx)(N.iq,{collapsedKeys:K,onCollapsedKeysChange:E,children:(0,d.jsx)(f.Z,{ref:q,title:(0,d.jsx)(B.Z,{onChange:S,value:p||"\u57FA\u7840\u8282\u70B9"}),className:te(X.container,u&&X.selected,W),extra:G,style:F,children:ee})})})}),P=(0,h.memo)(function(l){var u=l.id,K=l.onTitleChange,E=l.onCollapsedKeysChange,S=H()(l,O),F=(0,I.d)();return(0,d.jsx)(y,R()({onTitleChange:function(p){F.updateNodeMeta(u,"title",p),K==null||K(p)},onCollapsedKeysChange:function(p){F.updateNodeState(u,"collapsedKeys",p),E==null||E(p)}},S))}),j=P;j.Preview=y,w.Z=j},36036:function(k,w,n){var $=n(48305),R=n.n($),L=n(52327),H=n(19235),T=n(50959),A=n(24819),x=n(70020),f=n(11527),D=(0,T.memo)(function(h){var B=h.value,I=h.onChange,N=(0,T.useState)(!1),d=R()(N,2),O=d[0],C=d[1];return O?(0,f.jsx)(x.F,{onChange:I,onChangeEnd:function(){C(!1)},value:B}):(0,f.jsxs)(A.D,{gap:8,align:"center",horizontal:!0,children:[(0,f.jsx)("span",{style:{lineHeight:1},children:B}),(0,f.jsx)(H.Z,{icon:(0,f.jsx)(L.Z,{}),onClick:function(){C(!O)},placement:"right",title:"Edit"})]})});w.Z=D},75364:function(k,w,n){n.d(w,{d:function(){return h}});var $=n(26068),R=n.n($),L=n(67825),H=n.n(L),T=n(80111),A=n(50959),x=n(6951),f=n(75656),D=["yjsDoc","flattenEdges","selectedKeys","onFlattenNodesChange","onEdgesChange","onFlattenEdgesChange","onNodesChange","onViewPortChange","onNodesTreeChange","onSelectionChange","onElementSelectChange","updateEdgesOnEdgeChange","updateEdgesOnConnection","internalUpdateEdges","internalUpdateNodes","internalUpdateSelection"],h=function(){var I=(0,f.AC)(),N=(0,x._K)(),d=I.getState(),O=d.yjsDoc,C=d.flattenEdges,m=d.selectedKeys,g=d.onFlattenNodesChange,y=d.onEdgesChange,P=d.onFlattenEdgesChange,j=d.onNodesChange,l=d.onViewPortChange,u=d.onNodesTreeChange,K=d.onSelectionChange,E=d.onElementSelectChange,S=d.updateEdgesOnEdgeChange,F=d.updateEdgesOnConnection,W=d.internalUpdateEdges,p=d.internalUpdateNodes,ee=d.internalUpdateSelection,G=H()(d,D),Q=(0,T.Z)(function(){return I.getState().flattenNodes}),X=(0,T.Z)(function(){return I.getState().flattenEdges}),te=(0,T.Z)(function(){return I.getState().selectedKeys}),q=(0,A.useCallback)(function(oe){return N?N.screenToFlowPosition(oe):{x:0,y:0}},[N]);return(0,A.useMemo)(function(){return R()(R()({},G),{},{screenToFlowPosition:q,getFlattenNodes:Q,getSelectedKeys:te,getFlattenEdges:X})},[G])}},75656:function(k,w,n){n.d(w,{zt:function(){return Oe},ze:function(){return De},oR:function(){return Pe},AC:function(){return Me}});var $=n(4208),R=n(64445),L=n(38980),H=n(13422),T=n(48305),A=n.n(T),x=n(62657),f=n.n(x),D=n(21742),h=n.n(D),B=n(83136),I=n.n(B),N=n(17069),d=n.n(N),O=n(25298),C=n.n(O),m=n(82092),g=n.n(m),y=n(15836),P=d()(function Z(i){C()(this,Z),g()(this,"type",void 0),g()(this,"name",void 0),g()(this,"timestamp",void 0),this.type=i.type,this.name=i.name,this.timestamp=i.timestamp}),j=function(Z){h()(t,Z);var i=I()(t);function t(a){var e;return C()(this,t),e=i.call(this,a),g()(f()(e),"_internalHistoryKey","__INTERNAL_HISTORY_MAP__"),g()(f()(e),"undoManager",void 0),g()(f()(e),"updateHistoryData",function(o){var r=e.getMap(e._internalHistoryKey);Object.entries(o).forEach(function(s){var c=A()(s,2),v=c[0],_=c[1];r.set(v,_)})}),g()(f()(e),"recordHistoryData",function(o,r){e.transact(function(){e.updateHistoryData(o)},new P(r))}),g()(f()(e),"getHistoryMap",function(){return e.getMap(e._internalHistoryKey)}),g()(f()(e),"getHistoryJSON",function(){var o=e.getMap(e._internalHistoryKey);return o.toJSON()}),g()(f()(e),"redo",function(){return e.undoManager.redo()}),g()(f()(e),"undo",function(){return e.undoManager.undo()}),e.undoManager=new y.H6(e.getHistoryMap(),{trackedOrigins:new Set([P])}),e}return d()(t)}(y.QW),l=n(26068),u=n.n(l),K={reactflow:{},flattenNodes:{},flattenEdges:{},selectedKeys:[],yjsDoc:new j},E=n(67825),S=n.n(E),F=n(3341),W=n.n(F),p=n(64461),ee="$$",G="@@",Q=function(i,t){return i+G+(t||"")},X=function(i,t,a,e){return Q(i,a)+ee+Q(t,e)},te=function(i){var t=i.split(ee),a=_slicedToArray(t,2),e=a[0],o=a[1];if(!e||!o)return{source:"",target:"",sourceHandle:"",targetHandle:""};var r=e.split(G),s=_slicedToArray(r,2),c=s[0],v=s[1],_=o.split(G),M=_slicedToArray(_,2),b=M[0],J=M[1];return{source:c,target:b,sourceHandle:v,targetHandle:J}},q=function(i,t){switch(t.type){case"addEdge":return(0,p.Uy)(i,function(a){a[t.edge.id]=t.edge});case"addEdges":return(0,p.Uy)(i,function(a){var e=t.edges;e&&Object.keys(e).forEach(function(o){a[o]||(a[o]=e[o])})});case"updateEdge":return(0,p.Uy)(i,function(a){var e=t.id,o=t.edge;a[e]=u()(u()({},a[e]),o)});case"deleteEdge":return(0,p.Uy)(i,function(a){delete a[t.id]});case"createEdgeFromConnection":return(0,p.Uy)(i,function(a){var e=t.connection,o=e.source,r=e.target,s=e.sourceHandle,c=e.targetHandle;if(!(!o||!r)){var v=X(o,r,s,c);a[v]={id:v,source:o,target:r,sourceHandle:s,targetHandle:c}}});default:return i}},oe=["type"],le=function(i,t){return{internalUpdateEdges:function(e,o){var r,s;i({flattenEdges:e},!1,o),(r=(s=t()).onFlattenEdgesChange)===null||r===void 0||r.call(s,e)},dispatchEdges:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},r=o.recordHistory,s=r===void 0?!0:r,c=e.type,v=S()(e,oe),_=q(t().flattenEdges,e);if(!W()(_,t().flattenEdges)){var M=t(),b=M.internalUpdateEdges,J=M.yjsDoc;b(_,{type:"dispatchFlattenEdges/".concat(c),payload:v}),s&&J.recordHistoryData({flattenEdges:_},{type:"edge",name:e.type,timestamp:Date.now()})}},addEdges:function(e,o){t().dispatchEdges({type:"addEdges",edges:e},o)},updateEdgesOnConnection:function(e){t().dispatchEdges({type:"createEdgeFromConnection",connection:e})},updateEdgesOnEdgeChange:function(e){e.forEach(function(o){switch(o.type){case"remove":t().dispatchEdges({type:"deleteEdge",id:o.id})}})}}},ie=n(62071),ue=function(i,t){switch(t.type){case"addNode":return(0,p.Uy)(i,function(a){!t.node||!t.node.id||(a[t.node.id]=t.node)});case"addNodes":return(0,p.Uy)(i,function(a){var e=t.nodes;e&&Object.keys(e).forEach(function(o){a[o]||(a[o]=e[o])})});case"deleteNode":return(0,p.Uy)(i,function(a){delete a[t.id]});case"updateNodePosition":return(0,p.Uy)(i,function(a){a[t.id]&&t.position&&(a[t.id].position=t.position)});case"updateNodeMeta":return(0,p.Uy)(i,function(a){if(a[t.id]){var e=a[t.id];e.data.meta[t.key]=t.value}});case"updateNodeState":return(0,p.Uy)(i,function(a){if(a[t.id]){var e=a[t.id];e.data.state[t.key]=t.value}});case"updateNodeContent":return(0,p.Uy)(i,function(a){var e=t.key,o=t.id,r=t.value;if(a[o]){var s=a[o];s.data.content?s.data.content[e]=r:s.data.content=g()({},e,r)}});case"updateNodeData":return(0,p.Uy)(i,function(a){var e=t.newData,o=t.id,r=t.deepReplace;if(a[o]){var s=a[o];r?s.data=u()(u()({},s.data),e):(0,ie.Z)(s.data,e)}});default:return i}},ce=["type"],_e=function(i,t){return{internalUpdateNodes:function(e,o){var r,s;W()(e,t().flattenNodes)||(i({flattenNodes:e},!1,o),(r=(s=t()).onFlattenNodesChange)===null||r===void 0||r.call(s,e))},dispatchNodes:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},r=o.recordHistory,s=r===void 0?!0:r,c=e.type,v=S()(e,ce),_=ue(t().flattenNodes,e);if(!W()(_,t().flattenNodes)){t().internalUpdateNodes(_,{type:"dispatchFlattenNodes/".concat(c),payload:v});var M=t(),b=M.yjsDoc;s&&b.recordHistoryData({flattenNodes:_},{type:"nodes",name:e.type,timestamp:Date.now()})}},updateNodeMeta:function(e,o,r,s){t().dispatchNodes({type:"updateNodeMeta",id:e,key:o,value:r},s)},updateNodeState:function(e,o,r,s){t().dispatchNodes({type:"updateNodeState",id:e,key:o,value:r},s)},updateNodeContent:function(e,o,r,s){t().dispatchNodes({type:"updateNodeContent",id:e,key:o,value:r},s)},updateNodeData:function(e,o){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=arguments.length>3?arguments[3]:void 0;t().dispatchNodes({type:"updateNodeData",id:e,newData:o,deepReplace:r},s)},addNode:function(e){t().dispatchNodes({type:"addNode",node:e})},addNodes:function(e,o){t().dispatchNodes({type:"addNodes",nodes:e},o)},deleteNode:function(e){t().deselectElement(e),t().dispatchNodes({type:"deleteNode",id:e})}}},pe=n(335),fe=n.n(pe),ve=n(90228),ae=n.n(ve),ge=n(87999),de=n.n(ge),Ee=n(15558),ne=n.n(Ee),me=n(67197),ye=(0,me.kP)("0123456789abcdefghijklmnopqrstuvwxyz",16),he=function(i,t){return{internalUpdateSelection:function(e,o){var r,s;i({selectedKeys:e},!1,o),(r=(s=t()).onSelectionChange)===null||r===void 0||r.call(s,e)},onElementSelectChange:function(e,o){o?t().selectElement(e):t().deselectElement(e)},actionList:function(){var e=t(),o=e.yjsDoc;return{undo:o.undoManager.undoStack.length,redo:o.undoManager.redoStack.length}},selectElement:function(e){t().selectedKeys.includes(e)||t().internalUpdateSelection([].concat(ne()(t().selectedKeys),[e]),{type:"selection/selectElement",payload:{id:e}})},selectElements:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;t().internalUpdateSelection(o?[].concat(ne()(t().selectedKeys),ne()(e)):e,{type:"selection/selectElements",payload:{ids:e}})},selectAll:function(){var e=t().reactflow.getNodes(),o=t().reactflow.getEdges(),r=[].concat(ne()(e.map(function(s){return s.id})),ne()(o.map(function(s){return s.id})));t().internalUpdateSelection(r,{type:"selection/selectAll",payload:{ids:r}})},deselectElement:function(e){t().internalUpdateSelection(t().selectedKeys.filter(function(o){return o!==e}),{type:"selection/deselectElement",payload:{id:e}})},deselectAll:function(){t().internalUpdateSelection([],{type:"selection/deselectAll",payload:{}})},deleteSelection:function(){var e=t(),o=e.selectedKeys,r=e.flattenEdges,s=e.flattenNodes,c=e.dispatchNodes,v=e.dispatchEdges;o.forEach(function(_){s[_]&&c({type:"deleteNode",id:_}),r[_]&&v({type:"deleteEdge",id:_})})},copySelection:function(){var a=de()(ae()().mark(function o(){var r,s,c,v,_,M,b,J,U,z;return ae()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(r=t(),s=r.selectedKeys,c=r.flattenEdges,v=r.flattenNodes,s.length!==0){Y.next=3;break}return Y.abrupt("return");case 3:return _=Object.values(v).filter(function(se){return s.includes(se.id)}),M=Object.values(c).filter(function(se){return s.includes(se.id)}),b={nodes:_,edges:M},J=new Blob([JSON.stringify(b)],{type:"text/html"}),U=new Blob([JSON.stringify(b)],{type:"text/plain"}),z=new ClipboardItem({"text/html":J,"text/plain":U}),Y.next=11,navigator.clipboard.write([z]);case 11:return Y.abrupt("return",b);case 12:case"end":return Y.stop()}},o)}));function e(){return a.apply(this,arguments)}return e}(),paste:function(){var a=de()(ae()().mark(function o(){var r;return ae()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,navigator.clipboard.read();case 2:r=c.sent,r.forEach(function(v){var _=fe()(v.types),M;try{for(_.s();!(M=_.n()).done;){var b=M.value;if(b==="text/plain"){var J=v.getType(b);J.then(function(U){U.text().then(function(z){var V=void 0;try{V=JSON.parse(z)}catch(Y){}V&&t().pasteIntoFlow(V)})})}}}catch(U){_.e(U)}finally{_.f()}});case 4:case"end":return c.stop()}},o)}));function e(){return a.apply(this,arguments)}return e}(),pasteIntoFlow:function(e){var o=t(),r=o.yjsDoc,s=o.addEdges,c=o.addNodes,v=o.deselectAll,_=o.selectElements,M={},b={};v(),e.nodes.forEach(function(U){var z=ye();M[z]=u()(u()({},U),{},{id:z,position:{x:U.position.x+10,y:U.position.y+10}}),e.edges.forEach(function(V){V.source===U.id&&(V.source=z),V.target===U.id&&(V.target=z)})}),e.edges.forEach(function(U){var z=X(U.source,U.target,U.sourceHandle,U.targetHandle);b[z]=u()(u()({},U),{},{id:z})}),c(M,{recordHistory:!1}),s(b,{recordHistory:!1}),r.recordHistoryData({flattenNodes:t().flattenNodes,flattenEdges:t().flattenEdges},{type:"paste",name:"\u7C98\u8D34",timestamp:Date.now()});var J=Object.keys(M).concat(Object.keys(b));_(J)},undo:function(){var e=t(),o=e.yjsDoc,r=e.internalUpdateEdges,s=e.internalUpdateNodes,c=o.undo(),v=o.getHistoryJSON(),_=v.flattenNodes,M=v.flattenEdges;s(_||{},{type:"history/undo",payload:c}),r(M||{},{type:"history/undo",payload:c})},redo:function(){var e=t(),o=e.yjsDoc,r=e.internalUpdateEdges,s=e.internalUpdateNodes,c=o.redo(),v=o.getHistoryJSON(),_=v.flattenNodes,M=v.flattenEdges;s(_,{type:"history/redo",payload:c}),r(M,{type:"history/redo",payload:c})}}},Ce=function(i){return function(){return u()(u()(u()(u()({},K),{},{yjsDoc:i},le.apply(void 0,arguments)),_e.apply(void 0,arguments)),he.apply(void 0,arguments))}},De=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=new j;return(0,R.F)()((0,L.v)(i)(Ce(t),{name:"FLOW_EDITOR"}),$.X)},re=(0,H.k)(),Oe=re.Provider,Pe=re.useStore,Me=re.useStoreApi},79810:function(k,w,n){n.d(w,{I:function(){return m},K:function(){return g}});var $=n(26068),R=n.n($),L=n(67825),H=n.n(L),T=n(7787),A=n(50959),x=n(53649),f=n.n(x),D=n(73523),h,B,I,N=(0,D.kc)(function(y){var P=y.css,j=y.token;return{input:P(h||(h=f()([`
    position: relative;

    max-width: 100%;
    height: 36px;
    padding: 0 12px;

    transition: background-color 100ms `,`;

    input {
      background: transparent;
    }
  `])),j.motionEaseOut),block:P(B||(B=f()([`
    background-color: `,`;
    border: 1px solid transparent;

    &:hover {
      background-color: `,`;
    }
  `])),j.colorFillTertiary,j.colorFillQuaternary),textarea:P(I||(I=f()([`
    position: relative;

    max-width: 100%;
    padding: 8px 12px;

    transition: background-color 100ms `,`;

    textarea {
      background: transparent;
    }
  `])),j.motionEaseOut)}}),d=n(11527),O=["className","type"],C=["className","type"],m=(0,A.forwardRef)(function(y,P){var j=y.className,l=y.type,u=l===void 0?"ghost":l,K=H()(y,O),E=N(),S=E.styles,F=E.cx;return(0,d.jsx)(T.Z,R()({className:F(S.input,u==="block"&&S.block,j),ref:P},K))}),g=(0,A.memo)((0,A.forwardRef)(function(y,P){var j=y.className,l=y.type,u=l===void 0?"ghost":l,K=H()(y,C),E=N(),S=E.styles,F=E.cx;return(0,d.jsx)(T.Z.TextArea,R()({className:F(S.textarea,u==="block"&&S.block,j),ref:P},K))}))}}]);
