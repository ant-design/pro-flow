"use strict";(self.webpackChunk_ant_design_pro_flow=self.webpackChunk_ant_design_pro_flow||[]).push([[6317],{66317:function(se,R,d){d.d(R,{d:function(){return B}});var w=d(77117),A=d.n(w),$=d(95530),W=d.n($),j=d(80111),F=d(50959),_=d(66213),N=d(61122),L=["yjsDoc","flattenEdges","selectedKeys","onFlattenNodesChange","onEdgesChange","onFlattenEdgesChange","onNodesChange","onViewPortChange","onNodesTreeChange","onSelectionChange","onElementSelectChange","updateEdgesOnEdgeChange","updateEdgesOnConnection","internalUpdateEdges","internalUpdateNodes","internalUpdateSelection"],B=function(){var U=(0,N.AC)(),O=(0,_._K)(),f=U.getState(),q=f.yjsDoc,x=f.flattenEdges,ee=f.selectedKeys,v=f.onFlattenNodesChange,J=f.onEdgesChange,b=f.onFlattenEdgesChange,z=f.onNodesChange,te=f.onViewPortChange,E=f.onNodesTreeChange,ne=f.onSelectionChange,ae=f.onElementSelectChange,G=f.updateEdgesOnEdgeChange,oe=f.updateEdgesOnConnection,P=f.internalUpdateEdges,y=f.internalUpdateNodes,Z=f.internalUpdateSelection,H=W()(f,L),I=(0,j.Z)(function(){return U.getState().flattenNodes}),T=(0,j.Z)(function(){return U.getState().flattenEdges}),re=(0,j.Z)(function(){return U.getState().selectedKeys}),V=(0,F.useCallback)(function(Y){return console.log(O),O?O.screenToFlowPosition(Y):{x:0,y:0}},[O]);return(0,F.useMemo)(function(){return A()(A()({},H),{},{screenToFlowPosition:V,getFlattenNodes:I,getSelectedKeys:re,getFlattenEdges:T})},[H])}},61122:function(se,R,d){d.d(R,{zt:function(){return De},ze:function(){return Se},oR:function(){return Ue},AC:function(){return Oe}});var w=d(96458),A=d(92330),$=d(38980),W=d(13422),j=d(28152),F=d.n(j),_=d(90696),N=d.n(_),L=d(13762),B=d.n(L),k=d(41206),U=d.n(k),O=d(96345),f=d.n(O),q=d(15033),x=d.n(q),ee=d(21320),v=d.n(ee),J=d(15836),b=f()(function h(s){x()(this,h),v()(this,"type",void 0),v()(this,"name",void 0),v()(this,"timestamp",void 0),this.type=s.type,this.name=s.name,this.timestamp=s.timestamp}),z=function(h){B()(t,h);var s=U()(t);function t(a){var e;return x()(this,t),e=s.call(this,a),v()(N()(e),"_internalHistoryKey","__INTERNAL_HISTORY_MAP__"),v()(N()(e),"undoManager",void 0),v()(N()(e),"updateHistoryData",function(n){var o=e.getMap(e._internalHistoryKey);Object.entries(n).forEach(function(r){var l=F()(r,2),c=l[0],i=l[1];o.set(c,i)})}),v()(N()(e),"recordHistoryData",function(n,o){e.transact(function(){e.updateHistoryData(n)},new b(o))}),v()(N()(e),"getHistoryMap",function(){return e.getMap(e._internalHistoryKey)}),v()(N()(e),"getHistoryJSON",function(){var n=e.getMap(e._internalHistoryKey);return n.toJSON()}),v()(N()(e),"redo",function(){return e.undoManager.redo()}),v()(N()(e),"undo",function(){return e.undoManager.undo()}),e.undoManager=new J.H6(e.getHistoryMap(),{trackedOrigins:new Set([b])}),e}return f()(t)}(J.QW),te=d(77117),E=d.n(te),ne={reactflow:{},flattenNodes:{},flattenEdges:{},selectedKeys:[],yjsDoc:new z},ae=d(95530),G=d.n(ae),oe=d(3341),P=d.n(oe),y=d(64461),Z="$$",H="@@",I=function(s,t){return s+H+(t||"")},T=function(s,t,a,e){return I(s,a)+Z+I(t,e)},re=function(s){var t=s.split(Z),a=_slicedToArray(t,2),e=a[0],n=a[1];if(!e||!n)return{source:"",target:"",sourceHandle:"",targetHandle:""};var o=e.split(H),r=_slicedToArray(o,2),l=r[0],c=r[1],i=n.split(H),u=_slicedToArray(i,2),p=u[0],C=u[1];return{source:l,target:p,sourceHandle:c,targetHandle:C}},V=function(s,t){switch(t.type){case"addEdge":return(0,y.Uy)(s,function(a){a[t.edge.id]=t.edge});case"addEdges":return(0,y.Uy)(s,function(a){var e=t.edges;e&&Object.keys(e).forEach(function(n){a[n]||(a[n]=e[n])})});case"updateEdge":return(0,y.Uy)(s,function(a){var e=t.id,n=t.edge;a[e]=E()(E()({},a[e]),n)});case"deleteEdge":return(0,y.Uy)(s,function(a){delete a[t.id]});case"createEdgeFromConnection":return(0,y.Uy)(s,function(a){var e=t.connection,n=e.source,o=e.target,r=e.sourceHandle,l=e.targetHandle;if(!(!n||!o)){var c=T(n,o,r,l);a[c]={id:c,source:n,target:o,sourceHandle:r,targetHandle:l}}});default:return s}},Y=["type"],le=function(s,t){return{internalUpdateEdges:function(e,n){var o,r;s({flattenEdges:e},!1,n),(o=(r=t()).onFlattenEdgesChange)===null||o===void 0||o.call(r,e)},dispatchEdges:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},o=n.recordHistory,r=o===void 0?!0:o,l=e.type,c=G()(e,Y),i=V(t().flattenEdges,e);if(!P()(i,t().flattenEdges)){var u=t(),p=u.internalUpdateEdges,C=u.yjsDoc;p(i,{type:"dispatchFlattenEdges/".concat(l),payload:c}),r&&C.recordHistoryData({flattenEdges:i},{type:"edge",name:e.type,timestamp:Date.now()})}},addEdges:function(e,n){t().dispatchEdges({type:"addEdges",edges:e},n)},updateEdgesOnConnection:function(e){t().dispatchEdges({type:"createEdgeFromConnection",connection:e})},updateEdgesOnEdgeChange:function(e){e.forEach(function(n){switch(n.type){case"remove":t().dispatchEdges({type:"deleteEdge",id:n.id})}})}}},ie=d(62071),ce=function(s,t){switch(t.type){case"addNode":return(0,y.Uy)(s,function(a){!t.node||!t.node.id||(a[t.node.id]=t.node)});case"addNodes":return(0,y.Uy)(s,function(a){var e=t.nodes;e&&Object.keys(e).forEach(function(n){a[n]||(a[n]=e[n])})});case"deleteNode":return(0,y.Uy)(s,function(a){delete a[t.id]});case"updateNodePosition":return(0,y.Uy)(s,function(a){a[t.id]&&t.position&&(a[t.id].position=t.position)});case"updateNodeMeta":return(0,y.Uy)(s,function(a){if(a[t.id]){var e=a[t.id];e.data.meta[t.key]=t.value}});case"updateNodeState":return(0,y.Uy)(s,function(a){if(a[t.id]){var e=a[t.id];e.data.state[t.key]=t.value}});case"updateNodeContent":return(0,y.Uy)(s,function(a){var e=t.key,n=t.id,o=t.value;if(a[n]){var r=a[n];r.data.content?r.data.content[e]=o:r.data.content=v()({},e,o)}});case"updateNodeData":return(0,y.Uy)(s,function(a){var e=t.newData,n=t.id,o=t.deepReplace;if(a[n]){var r=a[n];o?r.data=E()(E()({},r.data),e):(0,ie.Z)(r.data,e)}});default:return s}},ue=["type"],fe=function(s,t){return{internalUpdateNodes:function(e,n){var o,r;P()(e,t().flattenNodes)||(s({flattenNodes:e},!1,n),(o=(r=t()).onFlattenNodesChange)===null||o===void 0||o.call(r,e))},dispatchNodes:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},o=n.recordHistory,r=o===void 0?!0:o,l=e.type,c=G()(e,ue),i=ce(t().flattenNodes,e);if(!P()(i,t().flattenNodes)){t().internalUpdateNodes(i,{type:"dispatchFlattenNodes/".concat(l),payload:c});var u=t(),p=u.yjsDoc;r&&p.recordHistoryData({flattenNodes:i},{type:"nodes",name:e.type,timestamp:Date.now()})}},updateNodeMeta:function(e,n,o,r){t().dispatchNodes({type:"updateNodeMeta",id:e,key:n,value:o},r)},updateNodeState:function(e,n,o,r){t().dispatchNodes({type:"updateNodeState",id:e,key:n,value:o},r)},updateNodeContent:function(e,n,o,r){t().dispatchNodes({type:"updateNodeContent",id:e,key:n,value:o},r)},updateNodeData:function(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3?arguments[3]:void 0;t().dispatchNodes({type:"updateNodeData",id:e,newData:n,deepReplace:o},r)},addNode:function(e){t().dispatchNodes({type:"addNode",node:e})},addNodes:function(e,n){t().dispatchNodes({type:"addNodes",nodes:e},n)},deleteNode:function(e){t().deselectElement(e),t().dispatchNodes({type:"deleteNode",id:e})}}},ge=d(38887),pe=d.n(ge),ye=d(13448),K=d.n(ye),ve=d(74815),de=d.n(ve),Ee=d(67855),M=d.n(Ee),he=d(67197),me=(0,he.kP)("0123456789abcdefghijklmnopqrstuvwxyz",16),Ne=function(s,t){return{internalUpdateSelection:function(e,n){var o,r;s({selectedKeys:e},!1,n),(o=(r=t()).onSelectionChange)===null||o===void 0||o.call(r,e)},onElementSelectChange:function(e,n){n?t().selectElement(e):t().deselectElement(e)},actionList:function(){var e=t(),n=e.yjsDoc;return{undo:n.undoManager.undoStack.length,redo:n.undoManager.redoStack.length}},selectElement:function(e){t().selectedKeys.includes(e)||t().internalUpdateSelection([].concat(M()(t().selectedKeys),[e]),{type:"selection/selectElement",payload:{id:e}})},selectElements:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;t().internalUpdateSelection(n?[].concat(M()(t().selectedKeys),M()(e)):e,{type:"selection/selectElements",payload:{ids:e}})},selectAll:function(){var e=t().reactflow.getNodes(),n=t().reactflow.getEdges(),o=[].concat(M()(e.map(function(r){return r.id})),M()(n.map(function(r){return r.id})));console.log(o),t().internalUpdateSelection(o,{type:"selection/selectAll",payload:{ids:o}})},deselectElement:function(e){t().internalUpdateSelection(t().selectedKeys.filter(function(n){return n!==e}),{type:"selection/deselectElement",payload:{id:e}})},deselectAll:function(){t().internalUpdateSelection([],{type:"selection/deselectAll",payload:{}})},deleteSelection:function(){var e=t(),n=e.selectedKeys,o=e.flattenEdges,r=e.flattenNodes,l=e.dispatchNodes,c=e.dispatchEdges;n.forEach(function(i){r[i]&&l({type:"deleteNode",id:i}),o[i]&&c({type:"deleteEdge",id:i})})},copySelection:function(){var a=de()(K()().mark(function n(){var o,r,l,c,i,u,p,C,g,m;return K()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(o=t(),r=o.selectedKeys,l=o.flattenEdges,c=o.flattenNodes,r.length!==0){D.next=3;break}return D.abrupt("return");case 3:return i=Object.values(c).filter(function(X){return r.includes(X.id)}),u=Object.values(l).filter(function(X){return r.includes(X.id)}),p={nodes:i,edges:u},C=new Blob([JSON.stringify(p)],{type:"text/html"}),g=new Blob([JSON.stringify(p)],{type:"text/plain"}),m=new ClipboardItem({"text/html":C,"text/plain":g}),D.next=11,navigator.clipboard.write([m]);case 11:return D.abrupt("return",p);case 12:case"end":return D.stop()}},n)}));function e(){return a.apply(this,arguments)}return e}(),paste:function(){var a=de()(K()().mark(function n(){var o;return K()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,navigator.clipboard.read();case 2:o=l.sent,o.forEach(function(c){var i=pe()(c.types),u;try{for(i.s();!(u=i.n()).done;){var p=u.value;if(p==="text/plain"){var C=c.getType(p);C.then(function(g){g.text().then(function(m){var S=void 0;try{S=JSON.parse(m)}catch(D){}S&&t().pasteIntoFlow(S)})})}}}catch(g){i.e(g)}finally{i.f()}});case 4:case"end":return l.stop()}},n)}));function e(){return a.apply(this,arguments)}return e}(),pasteIntoFlow:function(e){var n=t(),o=n.yjsDoc,r=n.addEdges,l=n.addNodes,c=n.deselectAll,i=n.selectElements,u={},p={};c(),e.nodes.forEach(function(g){var m=me();u[m]=E()(E()({},g),{},{id:m,position:{x:g.position.x+10,y:g.position.y+10}}),e.edges.forEach(function(S){S.source===g.id&&(S.source=m),S.target===g.id&&(S.target=m)})}),e.edges.forEach(function(g){var m=T(g.source,g.target,g.sourceHandle,g.targetHandle);p[m]=E()(E()({},g),{},{id:m})}),l(u,{recordHistory:!1}),r(p,{recordHistory:!1}),o.recordHistoryData({flattenNodes:t().flattenNodes,flattenEdges:t().flattenEdges},{type:"paste",name:"\u7C98\u8D34",timestamp:Date.now()});var C=Object.keys(u).concat(Object.keys(p));i(C)},undo:function(){var e=t(),n=e.yjsDoc,o=e.internalUpdateEdges,r=e.internalUpdateNodes,l=n.undo(),c=n.getHistoryJSON(),i=c.flattenNodes,u=c.flattenEdges;r(i||{},{type:"history/undo",payload:l}),o(u,{type:"history/undo",payload:l})},redo:function(){var e=t(),n=e.yjsDoc,o=e.internalUpdateEdges,r=e.internalUpdateNodes,l=n.redo(),c=n.getHistoryJSON(),i=c.flattenNodes,u=c.flattenEdges;r(i,{type:"history/redo",payload:l}),o(u,{type:"history/redo",payload:l})}}},Ce=function(s){return function(){return E()(E()(E()(E()({},ne),{},{yjsDoc:s},le.apply(void 0,arguments)),fe.apply(void 0,arguments)),Ne.apply(void 0,arguments))}},Se=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=new z;return(0,A.F)()((0,$.v)(s)(Ce(t),{name:"FLOW_EDITOR"}),w.X)},Q=(0,W.k)(),De=Q.Provider,Ue=Q.useStore,Oe=Q.useStoreApi}}]);
