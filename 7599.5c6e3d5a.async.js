"use strict";(self.webpackChunk_ant_design_pro_flow=self.webpackChunk_ant_design_pro_flow||[]).push([[7599],{70020:function(q,$,t){t.d($,{F:function(){return I}});var Z=t(26068),W=t.n(Z),H=t(48305),F=t.n(H),S=t(67825),T=t.n(S),x=t(17219),p=t(79810),D=t(50959),y=t(11527),L=["value","onChange","onValueChanging","onChangeEnd"],I=(0,D.memo)(function(N){var l=N.value,O=N.onChange,C=N.onValueChanging,m=N.onChangeEnd,g=T()(N,L),h=l||"",P=(0,D.useState)(h),K=F()(P,2),u=K[0],s=K[1],M=(0,D.useRef)(null),E=(0,D.useRef)(!1),j=(0,D.useRef)(!1),w=(0,D.useCallback)(function(){O==null||O(u)},[u]);return(0,D.useEffect)(function(){typeof l!="undefined"&&s(l)},[l]),(0,y.jsx)(p.I,W()(W()({ref:M},g),{},{value:u,onCompositionStart:function(){E.current=!0},onCompositionEnd:function(){E.current=!1},onFocus:function(){j.current=!0},onBlur:function(){j.current=!1,m==null||m(u)},onChange:function(R){s(R.target.value),C==null||C(R.target.value)},onPressEnter:function(R){!R.shiftKey&&!E.current&&(R.preventDefault(),w(),j.current=!1,m==null||m(u))},suffix:l===u?(0,y.jsx)("span",{}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(x.ZP,{type:"link",size:"small",onClick:function(){s(l)},style:{padding:0},children:"\u91CD\u7F6E"}),(0,y.jsx)(x.ZP,{type:"link",size:"small",style:{padding:0},onClick:function(){w()},children:"\u4FDD\u5B58 \u21B5"})]})}))})},48828:function(q,$,t){t.d($,{AC:function(){return L},iq:function(){return l},oR:function(){return y}});var Z=t(15558),W=t.n(Z),H=t(50959),F=t(71673),S=t(13422),T=t(29130),x=t(11527),p=function(C){var m=C.collapsedKeys,g=C.onCollapsedKeysChange;return(0,F.Ue)(function(h,P){return{collapsedKeys:m!=null?m:[],onCollapsedKeysChange:g,toggleCollapsedKey:function(u){var s,M,E=[];P().collapsedKeys.includes(u)?E=P().collapsedKeys.filter(function(j){return j!==u}):E=[].concat(W()(P().collapsedKeys),[u]),h({collapsedKeys:E}),(s=(M=P()).onCollapsedKeysChange)===null||s===void 0||s.call(M,E)}}})},D=(0,S.k)(),y=D.useStore,L=D.useStoreApi,I=D.Provider,N=(0,H.memo)(function(O){var C=O.collapsedKeys,m=L(),g=(0,T.N)(m);return g("collapsedKeys",C),null}),l=(0,H.memo)(function(O){var C=O.children,m=O.defaultCollapsedKeys,g=O.onCollapsedKeysChange,h=O.collapsedKeys;return(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)(I,{createStore:function(){return p({collapsedKeys:m,onCollapsedKeysChange:g})},children:[C,(0,x.jsx)(N,{collapsedKeys:h})]})})})},77599:function(q,$,t){var Z=t(26068),W=t.n(Z),H=t(67825),F=t.n(H),S=t(53649),T=t.n(S),x=t(68664),p=t(9751),D=t(48010),y=t(50959),L=t(36036),I=t(75364),N=t(48828),l=t(11527),O=["id","onTitleChange","onCollapsedKeysChange"],C,m,g=(0,D.kc)(function(u){var s=u.css,M=u.token,E=u.prefixCls;return{container:s(C||(C=T()([`
    will-change: transform;
    width: 100%;
    max-width: 600px;
    border: 1px solid `,`;
    border-radius: 12px;
    .`,`-card-head {
      padding-right: 16px;
    }

    .editor-field-item-container:not(:last-child) {
      margin-bottom: 24px;
    }
  `])),M.colorBorder,E),selected:s(m||(m=T()([`
    border-color: `,`;
    border-width: 2px;
    box-shadow: 0 9px 25px -6px rgba(0, 0, 0, 0.1);
  `])),M.colorPrimary)}}),h=(0,y.memo)(function(u){var s=u.active,M=u.collapsedKeys,E=u.onCollapsedKeysChange,j=u.onTitleChange,w=u.style,B=u.className,R=u.title,ee=u.children,Q=u.extra,X=g(),ne=X.styles,U=X.cx,k=(0,y.useRef)(null);return(0,l.jsx)(x.ZP,{getPopupContainer:function(){return k.current||document.body},children:(0,l.jsx)(N.iq,{collapsedKeys:M,onCollapsedKeysChange:E,children:(0,l.jsx)(p.Z,{ref:k,title:(0,l.jsx)(L.Z,{onChange:j,value:R||"\u57FA\u7840\u8282\u70B9"}),className:U(ne.container,s&&ne.selected,B),extra:Q,style:w,children:ee})})})}),P=(0,y.memo)(function(u){var s=u.id,M=u.onTitleChange,E=u.onCollapsedKeysChange,j=F()(u,O),w=(0,I.d)();return(0,l.jsx)(h,W()({onTitleChange:function(R){w.updateNodeMeta(s,"title",R),M==null||M(R)},onCollapsedKeysChange:function(R){w.updateNodeState(s,"collapsedKeys",R),E==null||E(R)}},j))}),K=P;K.Preview=h,$.Z=K},36036:function(q,$,t){var Z=t(48305),W=t.n(Z),H=t(52327),F=t(57578),S=t(50959),T=t(24819),x=t(70020),p=t(11527),D=(0,S.memo)(function(y){var L=y.value,I=y.onChange,N=(0,S.useState)(!1),l=W()(N,2),O=l[0],C=l[1];return O?(0,p.jsx)(x.F,{onChange:I,onChangeEnd:function(){C(!1)},value:L}):(0,p.jsxs)(T.D,{gap:8,align:"center",horizontal:!0,children:[(0,p.jsx)("span",{style:{lineHeight:1},children:L}),(0,p.jsx)(F.Z,{icon:(0,p.jsx)(H.Z,{}),onClick:function(){C(!O)},placement:"right",title:"Edit"})]})});$.Z=D},75364:function(q,$,t){t.d($,{d:function(){return y}});var Z=t(26068),W=t.n(Z),H=t(67825),F=t.n(H),S=t(80111),T=t(50959),x=t(40741),p=t(75656),D=["yjsDoc","flattenEdges","selectedKeys","onFlattenNodesChange","onEdgesChange","onFlattenEdgesChange","onNodesChange","onViewPortChange","onNodesTreeChange","onSelectionChange","onElementSelectChange","updateEdgesOnEdgeChange","updateEdgesOnConnection","internalUpdateEdges","internalUpdateNodes","internalUpdateSelection"],y=function(){var I=(0,p.AC)(),N=(0,x._K)(),l=I.getState(),O=l.yjsDoc,C=l.flattenEdges,m=l.selectedKeys,g=l.onFlattenNodesChange,h=l.onEdgesChange,P=l.onFlattenEdgesChange,K=l.onNodesChange,u=l.onViewPortChange,s=l.onNodesTreeChange,M=l.onSelectionChange,E=l.onElementSelectChange,j=l.updateEdgesOnEdgeChange,w=l.updateEdgesOnConnection,B=l.internalUpdateEdges,R=l.internalUpdateNodes,ee=l.internalUpdateSelection,Q=F()(l,D),X=(0,S.Z)(function(){return I.getState().flattenNodes}),ne=(0,S.Z)(function(){return I.getState().flattenEdges}),U=(0,S.Z)(function(){return I.getState().selectedKeys}),k=(0,T.useCallback)(function(oe){return N?N.screenToFlowPosition(oe):{x:0,y:0}},[N]);return(0,T.useMemo)(function(){return W()(W()({},Q),{},{screenToFlowPosition:k,getFlattenNodes:X,getSelectedKeys:U,getFlattenEdges:ne})},[Q])}},75656:function(q,$,t){t.d($,{zt:function(){return Oe},ze:function(){return De},oR:function(){return Pe},AC:function(){return Ne}});var Z=t(68319),W=t(60321),H=t(38980),F=t(13422),S=t(48305),T=t.n(S),x=t(62657),p=t.n(x),D=t(21742),y=t.n(D),L=t(83136),I=t.n(L),N=t(17069),l=t.n(N),O=t(25298),C=t.n(O),m=t(82092),g=t.n(m),h=t(15836),P=l()(function z(i){C()(this,z),g()(this,"type",void 0),g()(this,"name",void 0),g()(this,"timestamp",void 0),this.type=i.type,this.name=i.name,this.timestamp=i.timestamp}),K=function(z){y()(n,z);var i=I()(n);function n(a){var e;return C()(this,n),e=i.call(this,a),g()(p()(e),"_internalHistoryKey","__INTERNAL_HISTORY_MAP__"),g()(p()(e),"undoManager",void 0),g()(p()(e),"updateHistoryData",function(o){var r=e.getMap(e._internalHistoryKey);Object.entries(o).forEach(function(d){var c=T()(d,2),v=c[0],_=c[1];r.set(v,_)})}),g()(p()(e),"recordHistoryData",function(o,r){e.transact(function(){e.updateHistoryData(o)},new P(r))}),g()(p()(e),"getHistoryMap",function(){return e.getMap(e._internalHistoryKey)}),g()(p()(e),"getHistoryJSON",function(){var o=e.getMap(e._internalHistoryKey);return o.toJSON()}),g()(p()(e),"redo",function(){return e.undoManager.redo()}),g()(p()(e),"undo",function(){return e.undoManager.undo()}),e.undoManager=new h.H6(e.getHistoryMap(),{trackedOrigins:new Set([P])}),e}return l()(n)}(h.QW),u=t(26068),s=t.n(u),M={reactflow:{},flattenNodes:{},flattenEdges:{},selectedKeys:[],yjsDoc:new K},E=t(67825),j=t.n(E),w=t(3341),B=t.n(w),R="$$",ee="@@",Q=function(i,n){return i+ee+(n||"")},X=function(i,n,a,e){return Q(i,a)+R+Q(n,e)},ne=function(i){var n=i.split(R),a=_slicedToArray(n,2),e=a[0],o=a[1];if(!e||!o)return{source:"",target:"",sourceHandle:"",targetHandle:""};var r=e.split(ee),d=_slicedToArray(r,2),c=d[0],v=d[1],_=o.split(ee),f=_slicedToArray(_,2),b=f[0],V=f[1];return{source:c,target:b,sourceHandle:v,targetHandle:V}},U=t(64461),k=t(62071),oe=function(i,n){switch(n.type){case"addEdge":return(0,U.Uy)(i,function(a){a[n.edge.id]=n.edge});case"addEdges":return(0,U.Uy)(i,function(a){var e=n.edges;e&&Object.keys(e).forEach(function(o){a[o]||(a[o]=e[o])})});case"updateEdge":return(0,U.Uy)(i,function(a){var e=n.id,o=n.edge;console.log(a[e]),a[e]=s()(s()({},a[e]),o)});case"updateEdgeData":return(0,U.Uy)(i,function(a){var e=n.newData,o=n.id,r=n.deepReplace;if(a[o]=s()(s()({},a[o]),{},{data:e}),!!a[o]){var d=a[o];r?a[o]=s()(s()(s()({},a[o]),d),{},{data:s()(s()({},d.data),e)}):a[o]=s()(s()(s()({},a[o]),d),{},{data:(0,k.Z)(d.data,e)})}});case"deleteEdge":return(0,U.Uy)(i,function(a){delete a[n.id]});case"createEdgeFromConnection":return(0,U.Uy)(i,function(a){var e=n.edge;a[e.id]=e});default:return i}},le=["type"],ie=function(i,n){return{internalUpdateEdges:function(e,o){var r,d;i({flattenEdges:e},!1,o),(r=(d=n()).onFlattenEdgesChange)===null||r===void 0||r.call(d,e)},dispatchEdges:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},r=o.recordHistory,d=r===void 0?!0:r,c=e.type,v=j()(e,le),_=oe(n().flattenEdges,e);if(!B()(_,n().flattenEdges)){var f=n(),b=f.internalUpdateEdges,V=f.yjsDoc;b(_,{type:"dispatchFlattenEdges/".concat(c),payload:v}),d&&V.recordHistoryData({flattenEdges:_},{type:"edge",name:e.type,timestamp:Date.now()})}},addEdges:function(e,o){n().dispatchEdges({type:"addEdges",edges:e},o)},updateEdgesOnConnection:function(e){var o=e.source,r=e.target,d=e.sourceHandle,c=e.targetHandle;if(!(!o||!r)){var v=X(o,r,d,c),_={id:v,source:o,target:r,sourceHandle:d,targetHandle:c};return n().dispatchEdges({type:"addEdge",edge:_}),_}},updateEdgesOnEdgeChange:function(e){e.forEach(function(o){switch(o.type){case"remove":n().deselectElement(o.id),n().dispatchEdges({type:"deleteEdge",id:o.id})}})},deleteEdge:function(e){n().deselectElement(e),n().dispatchEdges({type:"deleteEdge",id:e})},deleteEdges:function(e){e.forEach(function(o){n().deselectElement(o),n().dispatchEdges({type:"deleteEdge",id:o})})},updateEdgeData:function(e,o){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=arguments.length>3?arguments[3]:void 0;n().dispatchEdges({type:"updateEdgeData",id:e,newData:o,deepReplace:r},d)},updateEdge:function(e,o,r){n().dispatchEdges({type:"updateEdge",id:e,edge:o},r)}}},ue=function(i,n){switch(n.type){case"addNode":return(0,U.Uy)(i,function(a){!n.node||!n.node.id||(a[n.node.id]=n.node)});case"addNodes":return(0,U.Uy)(i,function(a){var e=n.nodes;e&&Object.keys(e).forEach(function(o){a[o]||(a[o]=e[o])})});case"deleteNode":return(0,U.Uy)(i,function(a){delete a[n.id]});case"updateNodePosition":return(0,U.Uy)(i,function(a){a[n.id]&&n.position&&(a[n.id].position=n.position)});case"updateNodeMeta":return(0,U.Uy)(i,function(a){if(a[n.id]){var e=a[n.id];e.data.meta[n.key]=n.value}});case"updateNodeState":return(0,U.Uy)(i,function(a){if(a[n.id]){var e=a[n.id];e.data.state[n.key]=n.value}});case"updateNodeContent":return(0,U.Uy)(i,function(a){var e=n.key,o=n.id,r=n.value;if(a[o]){var d=a[o];d.data.content?d.data.content[e]=r:d.data.content=g()({},e,r)}});case"updateNodeData":return(0,U.Uy)(i,function(a){var e=n.newData,o=n.id,r=n.deepReplace;if(a[o]){var d=a[o];r?d.data=s()(s()({},d.data),e):(0,k.Z)(d.data,e)}});default:return i}},ce=["type"],_e=function(i,n){return{internalUpdateNodes:function(e,o){var r,d;B()(e,n().flattenNodes)||(i({flattenNodes:e},!1,o),(r=(d=n()).onFlattenNodesChange)===null||r===void 0||r.call(d,e))},dispatchNodes:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},r=o.recordHistory,d=r===void 0?!0:r,c=e.type,v=j()(e,ce),_=ue(n().flattenNodes,e);if(!B()(_,n().flattenNodes)){n().internalUpdateNodes(_,{type:"dispatchFlattenNodes/".concat(c),payload:v});var f=n(),b=f.yjsDoc;d&&b.recordHistoryData({flattenNodes:_},{type:"nodes",name:e.type,timestamp:Date.now()})}},updateNodeMeta:function(e,o,r,d){n().dispatchNodes({type:"updateNodeMeta",id:e,key:o,value:r},d)},updateNodeState:function(e,o,r,d){n().dispatchNodes({type:"updateNodeState",id:e,key:o,value:r},d)},updateNodeContent:function(e,o,r,d){n().dispatchNodes({type:"updateNodeContent",id:e,key:o,value:r},d)},updateNodeData:function(e,o){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=arguments.length>3?arguments[3]:void 0;n().dispatchNodes({type:"updateNodeData",id:e,newData:o,deepReplace:r},d)},addNode:function(e){n().dispatchNodes({type:"addNode",node:e})},addNodes:function(e,o){n().dispatchNodes({type:"addNodes",nodes:e},o)},deleteNode:function(e){n().deselectElement(e),n().dispatchNodes({type:"deleteNode",id:e})},deleteNodes:function(e){e.forEach(function(o){n().deselectElement(o),n().dispatchNodes({type:"deleteNode",id:o})})}}},pe=t(335),fe=t.n(pe),ge=t(90228),ae=t.n(ge),Ee=t(87999),se=t.n(Ee),ve=t(15558),te=t.n(ve),me=t(67197),he=(0,me.kP)("0123456789abcdefghijklmnopqrstuvwxyz",16),ye=function(i,n){return{internalUpdateSelection:function(e,o){var r,d;i({selectedKeys:e},!1,o),(r=(d=n()).onSelectionChange)===null||r===void 0||r.call(d,e)},onElementSelectChange:function(e,o){o?n().selectElement(e):n().deselectElement(e)},actionList:function(){var e=n(),o=e.yjsDoc;return{undo:o.undoManager.undoStack.length,redo:o.undoManager.redoStack.length}},selectElement:function(e){n().selectedKeys.includes(e)||n().internalUpdateSelection([].concat(te()(n().selectedKeys),[e]),{type:"selection/selectElement",payload:{id:e}})},selectElements:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n().internalUpdateSelection(o?[].concat(te()(n().selectedKeys),te()(e)):e,{type:"selection/selectElements",payload:{ids:e}})},selectAll:function(){var e=n().reactflow.getNodes(),o=n().reactflow.getEdges(),r=[].concat(te()(e.map(function(d){return d.id})),te()(o.map(function(d){return d.id})));n().internalUpdateSelection(r,{type:"selection/selectAll",payload:{ids:r}})},deselectElement:function(e){n().internalUpdateSelection(n().selectedKeys.filter(function(o){return o!==e}),{type:"selection/deselectElement",payload:{id:e}})},deselectAll:function(){n().internalUpdateSelection([],{type:"selection/deselectAll",payload:{}})},deleteSelection:function(){var e=n(),o=e.selectedKeys,r=e.flattenEdges,d=e.flattenNodes,c=e.dispatchNodes,v=e.dispatchEdges,_=e.deselectAll;_(),o.forEach(function(f){d[f]&&c({type:"deleteNode",id:f}),r[f]&&v({type:"deleteEdge",id:f})})},copySelection:function(){var a=se()(ae()().mark(function o(){var r,d,c,v,_,f,b,V,A,J;return ae()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(r=n(),d=r.selectedKeys,c=r.flattenEdges,v=r.flattenNodes,d.length!==0){Y.next=3;break}return Y.abrupt("return");case 3:return _=Object.values(v).filter(function(de){return d.includes(de.id)}),f=Object.values(c).filter(function(de){return d.includes(de.id)}),b={nodes:_,edges:f},V=new Blob([JSON.stringify(b)],{type:"text/html"}),A=new Blob([JSON.stringify(b)],{type:"text/plain"}),J=new ClipboardItem({"text/html":V,"text/plain":A}),Y.next=11,navigator.clipboard.write([J]);case 11:return Y.abrupt("return",b);case 12:case"end":return Y.stop()}},o)}));function e(){return a.apply(this,arguments)}return e}(),paste:function(){var a=se()(ae()().mark(function o(){var r;return ae()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,navigator.clipboard.read();case 2:r=c.sent,r.forEach(function(v){var _=fe()(v.types),f;try{for(_.s();!(f=_.n()).done;){var b=f.value;if(b==="text/plain"){var V=v.getType(b);V.then(function(A){A.text().then(function(J){var G=void 0;try{G=JSON.parse(J)}catch(Y){}G&&n().pasteIntoFlow(G)})})}}}catch(A){_.e(A)}finally{_.f()}});case 4:case"end":return c.stop()}},o)}));function e(){return a.apply(this,arguments)}return e}(),pasteIntoFlow:function(e){var o=n(),r=o.yjsDoc,d=o.addEdges,c=o.addNodes,v=o.deselectAll,_=o.selectElements,f={},b={};v(),e.nodes.forEach(function(A){var J=he();f[J]=s()(s()({},A),{},{id:J,position:{x:A.position.x+10,y:A.position.y+10}}),e.edges.forEach(function(G){G.source===A.id&&(G.source=J),G.target===A.id&&(G.target=J)})}),e.edges.forEach(function(A){var J=X(A.source,A.target,A.sourceHandle,A.targetHandle);b[J]=s()(s()({},A),{},{id:J})}),c(f,{recordHistory:!1}),d(b,{recordHistory:!1}),r.recordHistoryData({flattenNodes:n().flattenNodes,flattenEdges:n().flattenEdges},{type:"paste",name:"\u7C98\u8D34",timestamp:Date.now()});var V=Object.keys(f).concat(Object.keys(b));_(V)},undo:function(){var e=n(),o=e.yjsDoc,r=e.internalUpdateEdges,d=e.internalUpdateNodes,c=o.undo(),v=o.getHistoryJSON(),_=v.flattenNodes,f=v.flattenEdges;d(_||{},{type:"history/undo",payload:c}),r(f||{},{type:"history/undo",payload:c})},redo:function(){var e=n(),o=e.yjsDoc,r=e.internalUpdateEdges,d=e.internalUpdateNodes,c=o.redo(),v=o.getHistoryJSON(),_=v.flattenNodes,f=v.flattenEdges;d(_,{type:"history/redo",payload:c}),r(f,{type:"history/redo",payload:c})}}},Ce=function(i){return function(){return s()(s()(s()(s()({},M),{},{yjsDoc:i},ie.apply(void 0,arguments)),_e.apply(void 0,arguments)),ye.apply(void 0,arguments))}},De=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=new K;return(0,W.F)()((0,H.v)(i)(Ce(n),{name:"FLOW_EDITOR"}),Z.X)},re=(0,F.k)(),Oe=re.Provider,Pe=re.useStore,Ne=re.useStoreApi},79810:function(q,$,t){t.d($,{I:function(){return m},K:function(){return g}});var Z=t(26068),W=t.n(Z),H=t(67825),F=t.n(H),S=t(56795),T=t(50959),x=t(53649),p=t.n(x),D=t(48010),y,L,I,N=(0,D.kc)(function(h){var P=h.css,K=h.token;return{input:P(y||(y=p()([`
    position: relative;

    max-width: 100%;
    height: 36px;
    padding: 0 12px;

    transition: background-color 100ms `,`;

    input {
      background: transparent;
    }
  `])),K.motionEaseOut),block:P(L||(L=p()([`
    background-color: `,`;
    border: 1px solid transparent;

    &:hover {
      background-color: `,`;
    }
  `])),K.colorFillTertiary,K.colorFillQuaternary),textarea:P(I||(I=p()([`
    position: relative;

    max-width: 100%;
    padding: 8px 12px;

    transition: background-color 100ms `,`;

    textarea {
      background: transparent;
    }
  `])),K.motionEaseOut)}}),l=t(11527),O=["className","type"],C=["className","type"],m=(0,T.forwardRef)(function(h,P){var K=h.className,u=h.type,s=u===void 0?"ghost":u,M=F()(h,O),E=N(),j=E.styles,w=E.cx;return(0,l.jsx)(S.Z,W()({className:w(j.input,s==="block"&&j.block,K),ref:P},M))}),g=(0,T.memo)((0,T.forwardRef)(function(h,P){var K=h.className,u=h.type,s=u===void 0?"ghost":u,M=F()(h,C),E=N(),j=E.styles,w=E.cx;return(0,l.jsx)(S.Z.TextArea,W()({className:w(j.textarea,s==="block"&&j.block,K),ref:P},M))}))}}]);
