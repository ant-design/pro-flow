"use strict";(self.webpackChunk_ant_design_pro_flow=self.webpackChunk_ant_design_pro_flow||[]).push([[5710],{75710:function(se,_,d){d.d(_,{d:function(){return B}});var w=d(77117),A=d.n(w),$=d(95530),R=d.n($),j=d(80111),F=d(50959),W=d(8033),N=d(22975),L=["yjsDoc","flattenEdges","selectedKeys","onFlattenNodesChange","onEdgesChange","onFlattenEdgesChange","onNodesChange","onViewPortChange","onNodesTreeChange","onSelectionChange","onElementSelectChange","updateEdgesOnEdgeChange","updateEdgesOnConnection","internalUpdateEdges","internalUpdateNodes","internalUpdateSelection"],B=function(){var U=(0,N.AC)(),O=(0,W._K)(),f=U.getState(),q=f.yjsDoc,x=f.flattenEdges,ee=f.selectedKeys,y=f.onFlattenNodesChange,J=f.onEdgesChange,b=f.onFlattenEdgesChange,z=f.onNodesChange,te=f.onViewPortChange,m=f.onNodesTreeChange,ne=f.onSelectionChange,oe=f.onElementSelectChange,G=f.updateEdgesOnEdgeChange,ae=f.updateEdgesOnConnection,P=f.internalUpdateEdges,v=f.internalUpdateNodes,V=f.internalUpdateSelection,H=R()(f,L),I=(0,j.Z)(function(){return U.getState().flattenNodes}),T=(0,j.Z)(function(){return U.getState().flattenEdges}),re=(0,j.Z)(function(){return U.getState().selectedKeys}),Y=(0,F.useCallback)(function(Z){return console.log(O),O?O.screenToFlowPosition(Z):{x:0,y:0}},[O]);return(0,F.useMemo)(function(){return A()(A()({},H),{},{screenToFlowPosition:Y,getFlattenNodes:I,getSelectedKeys:re,getFlattenEdges:T})},[H])}},22975:function(se,_,d){d.d(_,{zt:function(){return Se},ze:function(){return Ce},oR:function(){return De},AC:function(){return Ue}});var w=d(53606),A=d(35667),$=d(38980),R=d(13422),j=d(28152),F=d.n(j),W=d(90696),N=d.n(W),L=d(13762),B=d.n(L),k=d(41206),U=d.n(k),O=d(96345),f=d.n(O),q=d(15033),x=d.n(q),ee=d(21320),y=d.n(ee),J=d(15836),b=f()(function E(s){x()(this,E),y()(this,"type",void 0),y()(this,"name",void 0),y()(this,"timestamp",void 0),this.type=s.type,this.name=s.name,this.timestamp=s.timestamp}),z=function(E){B()(t,E);var s=U()(t);function t(o){var e;return x()(this,t),e=s.call(this,o),y()(N()(e),"_internalHistoryKey","__INTERNAL_HISTORY_MAP__"),y()(N()(e),"undoManager",void 0),y()(N()(e),"updateHistoryData",function(n){var a=e.getMap(e._internalHistoryKey);Object.entries(n).forEach(function(r){var l=F()(r,2),c=l[0],i=l[1];a.set(c,i)})}),y()(N()(e),"recordHistoryData",function(n,a){e.transact(function(){e.updateHistoryData(n)},new b(a))}),y()(N()(e),"getHistoryMap",function(){return e.getMap(e._internalHistoryKey)}),y()(N()(e),"getHistoryJSON",function(){var n=e.getMap(e._internalHistoryKey);return n.toJSON()}),y()(N()(e),"redo",function(){return e.undoManager.redo()}),y()(N()(e),"undo",function(){return e.undoManager.undo()}),e.undoManager=new J.H6(e.getHistoryMap(),{trackedOrigins:new Set([b])}),e}return f()(t)}(J.QW),te=d(77117),m=d.n(te),ne={reactflow:{},flattenNodes:{},flattenEdges:{},selectedKeys:[],yjsDoc:new z},oe=d(95530),G=d.n(oe),ae=d(3341),P=d.n(ae),v=d(64461),V="$$",H="@@",I=function(s,t){return s+H+(t||"")},T=function(s,t,o,e){return I(s,o)+V+I(t,e)},re=function(s){var t=s.split(V),o=_slicedToArray(t,2),e=o[0],n=o[1];if(!e||!n)return{source:"",target:"",sourceHandle:"",targetHandle:""};var a=e.split(H),r=_slicedToArray(a,2),l=r[0],c=r[1],i=n.split(H),u=_slicedToArray(i,2),p=u[0],C=u[1];return{source:l,target:p,sourceHandle:c,targetHandle:C}},Y=function(s,t){switch(t.type){case"addEdge":return(0,v.Uy)(s,function(o){o[t.edge.id]=t.edge});case"addEdges":return(0,v.Uy)(s,function(o){var e=t.edges;e&&Object.keys(e).forEach(function(n){o[n]||(o[n]=e[n])})});case"updateEdge":return(0,v.Uy)(s,function(o){var e=t.id,n=t.edge;o[e]=m()(m()({},o[e]),n)});case"deleteEdge":return(0,v.Uy)(s,function(o){delete o[t.id]});case"createEdgeFromConnection":return(0,v.Uy)(s,function(o){var e=t.connection,n=e.source,a=e.target,r=e.sourceHandle,l=e.targetHandle;if(!(!n||!a)){var c=T(n,a,r,l);o[c]={id:c,source:n,target:a,sourceHandle:r,targetHandle:l}}});default:return s}},Z=["type"],le=function(s,t){return{internalUpdateEdges:function(e,n){var a,r;s({flattenEdges:e},!1,n),(a=(r=t()).onFlattenEdgesChange)===null||a===void 0||a.call(r,e)},dispatchEdges:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},a=n.recordHistory,r=a===void 0?!0:a,l=e.type,c=G()(e,Z),i=Y(t().flattenEdges,e);if(!P()(i,t().flattenEdges)){var u=t(),p=u.internalUpdateEdges,C=u.yjsDoc;p(i,{type:"dispatchFlattenEdges/".concat(l),payload:c}),r&&C.recordHistoryData({flattenEdges:i},{type:"edge",name:e.type,timestamp:Date.now()})}},addEdges:function(e,n){t().dispatchEdges({type:"addEdges",edges:e},n)},updateEdgesOnConnection:function(e){t().dispatchEdges({type:"createEdgeFromConnection",connection:e})},updateEdgesOnEdgeChange:function(e){e.forEach(function(n){switch(n.type){case"remove":t().dispatchEdges({type:"deleteEdge",id:n.id})}})}}},ie=function(s,t){switch(t.type){case"addNode":return(0,v.Uy)(s,function(o){!t.node||!t.node.id||(o[t.node.id]=t.node)});case"addNodes":return(0,v.Uy)(s,function(o){var e=t.nodes;e&&Object.keys(e).forEach(function(n){o[n]||(o[n]=e[n])})});case"deleteNode":return(0,v.Uy)(s,function(o){delete o[t.id]});case"updateNodePosition":return(0,v.Uy)(s,function(o){o[t.id]&&t.position&&(o[t.id].position=t.position)});case"updateNodeMeta":return(0,v.Uy)(s,function(o){if(o[t.id]){var e=o[t.id];e.data.meta[t.key]=t.value}});case"updateNodeState":return(0,v.Uy)(s,function(o){if(o[t.id]){var e=o[t.id];e.data.state[t.key]=t.value}});case"updateNodeContent":return(0,v.Uy)(s,function(o){var e=t.key,n=t.id,a=t.value;if(o[n]){var r=o[n];r.data.content?r.data.content[e]=a:r.data.content=y()({},e,a)}});default:return s}},ce=["type"],ue=function(s,t){return{internalUpdateNodes:function(e,n){var a,r;P()(e,t().flattenNodes)||(s({flattenNodes:e},!1,n),(a=(r=t()).onFlattenNodesChange)===null||a===void 0||a.call(r,e))},dispatchNodes:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},a=n.recordHistory,r=a===void 0?!0:a,l=e.type,c=G()(e,ce),i=ie(t().flattenNodes,e);if(!P()(i,t().flattenNodes)){t().internalUpdateNodes(i,{type:"dispatchFlattenNodes/".concat(l),payload:c});var u=t(),p=u.yjsDoc;r&&p.recordHistoryData({flattenNodes:i},{type:"nodes",name:e.type,timestamp:Date.now()})}},updateNodeMeta:function(e,n,a,r){t().dispatchNodes({type:"updateNodeMeta",id:e,key:n,value:a},r)},updateNodeState:function(e,n,a,r){t().dispatchNodes({type:"updateNodeState",id:e,key:n,value:a},r)},updateNodeContent:function(e,n,a,r){t().dispatchNodes({type:"updateNodeContent",id:e,key:n,value:a},r)},addNode:function(e){t().dispatchNodes({type:"addNode",node:e})},addNodes:function(e,n){t().dispatchNodes({type:"addNodes",nodes:e},n)},deleteNode:function(e){t().deselectElement(e),t().dispatchNodes({type:"deleteNode",id:e})}}},fe=d(38887),ge=d.n(fe),pe=d(13448),K=d.n(pe),ye=d(74815),de=d.n(ye),ve=d(67855),M=d.n(ve),Ee=d(67197),he=(0,Ee.kP)("0123456789abcdefghijklmnopqrstuvwxyz",16),me=function(s,t){return{internalUpdateSelection:function(e,n){var a,r;s({selectedKeys:e},!1,n),(a=(r=t()).onSelectionChange)===null||a===void 0||a.call(r,e)},onElementSelectChange:function(e,n){n?t().selectElement(e):t().deselectElement(e)},actionList:function(){var e=t(),n=e.yjsDoc;return{undo:n.undoManager.undoStack.length,redo:n.undoManager.redoStack.length}},selectElement:function(e){t().selectedKeys.includes(e)||t().internalUpdateSelection([].concat(M()(t().selectedKeys),[e]),{type:"selection/selectElement",payload:{id:e}})},selectElements:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;t().internalUpdateSelection(n?[].concat(M()(t().selectedKeys),M()(e)):e,{type:"selection/selectElements",payload:{ids:e}})},selectAll:function(){var e=t().reactflow.getNodes(),n=t().reactflow.getEdges(),a=[].concat(M()(e.map(function(r){return r.id})),M()(n.map(function(r){return r.id})));console.log(a),t().internalUpdateSelection(a,{type:"selection/selectAll",payload:{ids:a}})},deselectElement:function(e){t().internalUpdateSelection(t().selectedKeys.filter(function(n){return n!==e}),{type:"selection/deselectElement",payload:{id:e}})},deselectAll:function(){t().internalUpdateSelection([],{type:"selection/deselectAll",payload:{}})},deleteSelection:function(){var e=t(),n=e.selectedKeys,a=e.flattenEdges,r=e.flattenNodes,l=e.dispatchNodes,c=e.dispatchEdges;n.forEach(function(i){r[i]&&l({type:"deleteNode",id:i}),a[i]&&c({type:"deleteEdge",id:i})})},copySelection:function(){var o=de()(K()().mark(function n(){var a,r,l,c,i,u,p,C,g,h;return K()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(a=t(),r=a.selectedKeys,l=a.flattenEdges,c=a.flattenNodes,r.length!==0){D.next=3;break}return D.abrupt("return");case 3:return i=Object.values(c).filter(function(X){return r.includes(X.id)}),u=Object.values(l).filter(function(X){return r.includes(X.id)}),p={nodes:i,edges:u},C=new Blob([JSON.stringify(p)],{type:"text/html"}),g=new Blob([JSON.stringify(p)],{type:"text/plain"}),h=new ClipboardItem({"text/html":C,"text/plain":g}),D.next=11,navigator.clipboard.write([h]);case 11:return D.abrupt("return",p);case 12:case"end":return D.stop()}},n)}));function e(){return o.apply(this,arguments)}return e}(),paste:function(){var o=de()(K()().mark(function n(){var a;return K()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,navigator.clipboard.read();case 2:a=l.sent,a.forEach(function(c){var i=ge()(c.types),u;try{for(i.s();!(u=i.n()).done;){var p=u.value;if(p==="text/plain"){var C=c.getType(p);C.then(function(g){g.text().then(function(h){var S=void 0;try{S=JSON.parse(h)}catch(D){}S&&t().pasteIntoFlow(S)})})}}}catch(g){i.e(g)}finally{i.f()}});case 4:case"end":return l.stop()}},n)}));function e(){return o.apply(this,arguments)}return e}(),pasteIntoFlow:function(e){var n=t(),a=n.yjsDoc,r=n.addEdges,l=n.addNodes,c=n.deselectAll,i=n.selectElements,u={},p={};c(),e.nodes.forEach(function(g){var h=he();u[h]=m()(m()({},g),{},{id:h,position:{x:g.position.x+10,y:g.position.y+10}}),e.edges.forEach(function(S){S.source===g.id&&(S.source=h),S.target===g.id&&(S.target=h)})}),e.edges.forEach(function(g){var h=T(g.source,g.target,g.sourceHandle,g.targetHandle);p[h]=m()(m()({},g),{},{id:h})}),l(u,{recordHistory:!1}),r(p,{recordHistory:!1}),a.recordHistoryData({flattenNodes:t().flattenNodes,flattenEdges:t().flattenEdges},{type:"paste",name:"\u7C98\u8D34",timestamp:Date.now()});var C=Object.keys(u).concat(Object.keys(p));i(C)},undo:function(){var e=t(),n=e.yjsDoc,a=e.internalUpdateEdges,r=e.internalUpdateNodes,l=n.undo(),c=n.getHistoryJSON(),i=c.flattenNodes,u=c.flattenEdges;r(i||{},{type:"history/undo",payload:l}),a(u,{type:"history/undo",payload:l})},redo:function(){var e=t(),n=e.yjsDoc,a=e.internalUpdateEdges,r=e.internalUpdateNodes,l=n.redo(),c=n.getHistoryJSON(),i=c.flattenNodes,u=c.flattenEdges;r(i,{type:"history/redo",payload:l}),a(u,{type:"history/redo",payload:l})}}},Ne=function(s){return function(){return m()(m()(m()(m()({},ne),{},{yjsDoc:s},le.apply(void 0,arguments)),ue.apply(void 0,arguments)),me.apply(void 0,arguments))}},Ce=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=new z;return(0,A.F)()((0,$.v)(s)(Ne(t),{name:"FLOW_EDITOR"}),w.X)},Q=(0,R.k)(),Se=Q.Provider,De=Q.useStore,Ue=Q.useStoreApi}}]);
