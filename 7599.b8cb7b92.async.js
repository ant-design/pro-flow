"use strict";(self.webpackChunk_ant_design_pro_flow=self.webpackChunk_ant_design_pro_flow||[]).push([[7599],{70020:function(q,$,n){n.d($,{F:function(){return I}});var Z=n(26068),W=n.n(Z),H=n(48305),F=n.n(H),T=n(67825),A=n.n(T),x=n(86865),p=n(79810),C=n(50959),h=n(11527),L=["value","onChange","onValueChanging","onChangeEnd"],I=(0,C.memo)(function(M){var l=M.value,D=M.onChange,y=M.onValueChanging,E=M.onChangeEnd,f=A()(M,L),m=l||"",O=(0,C.useState)(m),K=F()(O,2),u=K[0],s=K[1],N=(0,C.useRef)(null),g=(0,C.useRef)(!1),j=(0,C.useRef)(!1),w=(0,C.useCallback)(function(){D==null||D(u)},[u]);return(0,C.useEffect)(function(){typeof l!="undefined"&&s(l)},[l]),(0,h.jsx)(p.I,W()(W()({ref:N},f),{},{value:u,onCompositionStart:function(){g.current=!0},onCompositionEnd:function(){g.current=!1},onFocus:function(){j.current=!0},onBlur:function(){j.current=!1,E==null||E(u)},onChange:function(R){s(R.target.value),y==null||y(R.target.value)},onPressEnter:function(R){!R.shiftKey&&!g.current&&(R.preventDefault(),w(),j.current=!1,E==null||E(u))},suffix:l===u?(0,h.jsx)("span",{}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(x.ZP,{type:"link",size:"small",onClick:function(){s(l)},style:{padding:0},children:"\u91CD\u7F6E"}),(0,h.jsx)(x.ZP,{type:"link",size:"small",style:{padding:0},onClick:function(){w()},children:"\u4FDD\u5B58 \u21B5"})]})}))})},48828:function(q,$,n){n.d($,{AC:function(){return L},iq:function(){return l},oR:function(){return h}});var Z=n(15558),W=n.n(Z),H=n(50959),F=n(54011),T=n(13422),A=n(29130),x=n(11527),p=function(y){var E=y.collapsedKeys,f=y.onCollapsedKeysChange;return(0,F.Ue)(function(m,O){return{collapsedKeys:E!=null?E:[],onCollapsedKeysChange:f,toggleCollapsedKey:function(u){var s,N,g=[];O().collapsedKeys.includes(u)?g=O().collapsedKeys.filter(function(j){return j!==u}):g=[].concat(W()(O().collapsedKeys),[u]),m({collapsedKeys:g}),(s=(N=O()).onCollapsedKeysChange)===null||s===void 0||s.call(N,g)}}})},C=(0,T.k)(),h=C.useStore,L=C.useStoreApi,I=C.Provider,M=(0,H.memo)(function(D){var y=D.collapsedKeys,E=L(),f=(0,A.N)(E);return f("collapsedKeys",y),null}),l=(0,H.memo)(function(D){var y=D.children,E=D.defaultCollapsedKeys,f=D.onCollapsedKeysChange,m=D.collapsedKeys;return(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)(I,{createStore:function(){return p({collapsedKeys:E,onCollapsedKeysChange:f})},children:[y,(0,x.jsx)(M,{collapsedKeys:m})]})})})},77599:function(q,$,n){var Z=n(26068),W=n.n(Z),H=n(67825),F=n.n(H),T=n(53649),A=n.n(T),x=n(49084),p=n(16965),C=n(95654),h=n(50959),L=n(36036),I=n(75364),M=n(48828),l=n(11527),D=["id","onTitleChange","onCollapsedKeysChange"],y,E,f=(0,C.kc)(function(u){var s=u.css,N=u.token,g=u.prefixCls;return{container:s(y||(y=A()([`
    will-change: transform;
    width: 100%;
    max-width: 600px;
    border: 1px solid `,`;
    border-radius: 12px;
    .`,`-card-head {
      padding-right: 16px;
    }

    .editor-field-item-container:not(:last-child) {
      margin-bottom: 24px;
    }
  `])),N.colorBorder,g),selected:s(E||(E=A()([`
    border-color: `,`;
    border-width: 2px;
    box-shadow: 0 9px 25px -6px rgba(0, 0, 0, 0.1);
  `])),N.colorPrimary)}}),m=(0,h.memo)(function(u){var s=u.active,N=u.collapsedKeys,g=u.onCollapsedKeysChange,j=u.onTitleChange,w=u.style,B=u.className,R=u.title,ee=u.children,Q=u.extra,X=f(),ne=X.styles,U=X.cx,k=(0,h.useRef)(null);return(0,l.jsx)(x.ZP,{getPopupContainer:function(){return k.current||document.body},children:(0,l.jsx)(M.iq,{collapsedKeys:N,onCollapsedKeysChange:g,children:(0,l.jsx)(p.Z,{ref:k,title:(0,l.jsx)(L.Z,{onChange:j,value:R||"\u57FA\u7840\u8282\u70B9"}),className:U(ne.container,s&&ne.selected,B),extra:Q,style:w,children:ee})})})}),O=(0,h.memo)(function(u){var s=u.id,N=u.onTitleChange,g=u.onCollapsedKeysChange,j=F()(u,D),w=(0,I.d)();return(0,l.jsx)(m,W()({onTitleChange:function(R){w.updateNodeMeta(s,"title",R),N==null||N(R)},onCollapsedKeysChange:function(R){w.updateNodeState(s,"collapsedKeys",R),g==null||g(R)}},j))}),K=O;K.Preview=m,$.Z=K},36036:function(q,$,n){var Z=n(48305),W=n.n(Z),H=n(52327),F=n(20466),T=n(50959),A=n(24819),x=n(70020),p=n(11527),C=(0,T.memo)(function(h){var L=h.value,I=h.onChange,M=(0,T.useState)(!1),l=W()(M,2),D=l[0],y=l[1];return D?(0,p.jsx)(x.F,{onChange:I,onChangeEnd:function(){y(!1)},value:L}):(0,p.jsxs)(A.D,{gap:8,align:"center",horizontal:!0,children:[(0,p.jsx)("span",{style:{lineHeight:1},children:L}),(0,p.jsx)(F.Z,{icon:(0,p.jsx)(H.Z,{}),onClick:function(){y(!D)},placement:"right",title:"Edit"})]})});$.Z=C},75364:function(q,$,n){n.d($,{d:function(){return h}});var Z=n(26068),W=n.n(Z),H=n(67825),F=n.n(H),T=n(80111),A=n(50959),x=n(54733),p=n(75656),C=["yjsDoc","flattenEdges","selectedKeys","onFlattenNodesChange","onEdgesChange","onFlattenEdgesChange","onNodesChange","onViewPortChange","onNodesTreeChange","onSelectionChange","onElementSelectChange","updateEdgesOnEdgeChange","updateEdgesOnConnection","internalUpdateEdges","internalUpdateNodes","internalUpdateSelection"],h=function(){var I=(0,p.AC)(),M=(0,x._K)(),l=I.getState(),D=l.yjsDoc,y=l.flattenEdges,E=l.selectedKeys,f=l.onFlattenNodesChange,m=l.onEdgesChange,O=l.onFlattenEdgesChange,K=l.onNodesChange,u=l.onViewPortChange,s=l.onNodesTreeChange,N=l.onSelectionChange,g=l.onElementSelectChange,j=l.updateEdgesOnEdgeChange,w=l.updateEdgesOnConnection,B=l.internalUpdateEdges,R=l.internalUpdateNodes,ee=l.internalUpdateSelection,Q=F()(l,C),X=(0,T.Z)(function(){return I.getState().flattenNodes}),ne=(0,T.Z)(function(){return I.getState().flattenEdges}),U=(0,T.Z)(function(){return I.getState().selectedKeys}),k=(0,A.useCallback)(function(oe){return M?M.screenToFlowPosition(oe):{x:0,y:0}},[M]);return(0,A.useMemo)(function(){return W()(W()({},Q),{},{screenToFlowPosition:k,getFlattenNodes:X,getSelectedKeys:U,getFlattenEdges:ne})},[Q])}},75656:function(q,$,n){n.d($,{zt:function(){return Oe},ze:function(){return De},oR:function(){return Pe},AC:function(){return Me}});var Z=n(41048),W=n(59245),H=n(38980),F=n(13422),T=n(48305),A=n.n(T),x=n(62657),p=n.n(x),C=n(21742),h=n.n(C),L=n(83136),I=n.n(L),M=n(17069),l=n.n(M),D=n(25298),y=n.n(D),E=n(82092),f=n.n(E),m=n(15836),O=l()(function z(i){y()(this,z),f()(this,"type",void 0),f()(this,"name",void 0),f()(this,"timestamp",void 0),this.type=i.type,this.name=i.name,this.timestamp=i.timestamp}),K=function(z){h()(t,z);var i=I()(t);function t(a){var e;return y()(this,t),e=i.call(this,a),f()(p()(e),"_internalHistoryKey","__INTERNAL_HISTORY_MAP__"),f()(p()(e),"undoManager",void 0),f()(p()(e),"updateHistoryData",function(o){var r=e.getMap(e._internalHistoryKey);Object.entries(o).forEach(function(d){var _=A()(d,2),v=_[0],c=_[1];r.set(v,c)})}),f()(p()(e),"recordHistoryData",function(o,r){e.transact(function(){e.updateHistoryData(o)},new O(r))}),f()(p()(e),"getHistoryMap",function(){return e.getMap(e._internalHistoryKey)}),f()(p()(e),"getHistoryJSON",function(){var o=e.getMap(e._internalHistoryKey);return o.toJSON()}),f()(p()(e),"redo",function(){return e.undoManager.redo()}),f()(p()(e),"undo",function(){return e.undoManager.undo()}),e.undoManager=new m.H6(e.getHistoryMap(),{trackedOrigins:new Set([O])}),e}return l()(t)}(m.QW),u=n(26068),s=n.n(u),N={reactflow:{},flattenNodes:{},flattenEdges:{},selectedKeys:[],yjsDoc:new K},g=n(67825),j=n.n(g),w=n(3341),B=n.n(w),R="$$",ee="@@",Q=function(i,t){return i+ee+(t||"")},X=function(i,t,a,e){return Q(i,a)+R+Q(t,e)},ne=function(i){var t=i.split(R),a=_slicedToArray(t,2),e=a[0],o=a[1];if(!e||!o)return{source:"",target:"",sourceHandle:"",targetHandle:""};var r=e.split(ee),d=_slicedToArray(r,2),_=d[0],v=d[1],c=o.split(ee),P=_slicedToArray(c,2),b=P[0],V=P[1];return{source:_,target:b,sourceHandle:v,targetHandle:V}},U=n(64461),k=n(62071),oe=function(i,t){switch(t.type){case"addEdge":return(0,U.Uy)(i,function(a){a[t.edge.id]=t.edge});case"addEdges":return(0,U.Uy)(i,function(a){var e=t.edges;e&&Object.keys(e).forEach(function(o){a[o]||(a[o]=e[o])})});case"updateEdge":return(0,U.Uy)(i,function(a){var e=t.id,o=t.edge;console.log(a[e]),a[e]=s()(s()({},a[e]),o)});case"updateEdgeData":return(0,U.Uy)(i,function(a){var e=t.newData,o=t.id,r=t.deepReplace;if(a[o]=s()(s()({},a[o]),{},{data:e}),!!a[o]){var d=a[o];r?a[o]=s()(s()(s()({},a[o]),d),{},{data:s()(s()({},d.data),e)}):a[o]=s()(s()(s()({},a[o]),d),{},{data:(0,k.Z)(d.data,e)})}});case"deleteEdge":return(0,U.Uy)(i,function(a){delete a[t.id]});case"createEdgeFromConnection":return(0,U.Uy)(i,function(a){var e=t.edge;a[e.id]=e});default:return i}},le=["type"],ie=function(i,t){return{internalUpdateEdges:function(e,o){var r,d;i({flattenEdges:e},!1,o),(r=(d=t()).onFlattenEdgesChange)===null||r===void 0||r.call(d,e)},dispatchEdges:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},r=o.recordHistory,d=r===void 0?!0:r,_=e.type,v=j()(e,le),c=oe(t().flattenEdges,e);if(!B()(c,t().flattenEdges)){var P=t(),b=P.internalUpdateEdges,V=P.yjsDoc;b(c,{type:"dispatchFlattenEdges/".concat(_),payload:v}),d&&V.recordHistoryData({flattenEdges:c},{type:"edge",name:e.type,timestamp:Date.now()})}},addEdges:function(e,o){t().dispatchEdges({type:"addEdges",edges:e},o)},updateEdgesOnConnection:function(e){var o=e.source,r=e.target,d=e.sourceHandle,_=e.targetHandle;if(!(!o||!r)){var v=X(o,r,d,_),c={id:v,source:o,target:r,sourceHandle:d,targetHandle:_};return t().dispatchEdges({type:"addEdge",edge:c}),c}},updateEdgesOnEdgeChange:function(e){e.forEach(function(o){switch(o.type){case"remove":t().dispatchEdges({type:"deleteEdge",id:o.id})}})},deleteEdge:function(e){t().deselectElement(e),t().dispatchEdges({type:"deleteEdge",id:e})},updateEdgeData:function(e,o){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=arguments.length>3?arguments[3]:void 0;t().dispatchEdges({type:"updateEdgeData",id:e,newData:o,deepReplace:r},d)},updateEdge:function(e,o,r){t().dispatchEdges({type:"updateEdge",id:e,edge:o},r)}}},ue=function(i,t){switch(t.type){case"addNode":return(0,U.Uy)(i,function(a){!t.node||!t.node.id||(a[t.node.id]=t.node)});case"addNodes":return(0,U.Uy)(i,function(a){var e=t.nodes;e&&Object.keys(e).forEach(function(o){a[o]||(a[o]=e[o])})});case"deleteNode":return(0,U.Uy)(i,function(a){delete a[t.id]});case"updateNodePosition":return(0,U.Uy)(i,function(a){a[t.id]&&t.position&&(a[t.id].position=t.position)});case"updateNodeMeta":return(0,U.Uy)(i,function(a){if(a[t.id]){var e=a[t.id];e.data.meta[t.key]=t.value}});case"updateNodeState":return(0,U.Uy)(i,function(a){if(a[t.id]){var e=a[t.id];e.data.state[t.key]=t.value}});case"updateNodeContent":return(0,U.Uy)(i,function(a){var e=t.key,o=t.id,r=t.value;if(a[o]){var d=a[o];d.data.content?d.data.content[e]=r:d.data.content=f()({},e,r)}});case"updateNodeData":return(0,U.Uy)(i,function(a){var e=t.newData,o=t.id,r=t.deepReplace;if(a[o]){var d=a[o];r?d.data=s()(s()({},d.data),e):(0,k.Z)(d.data,e)}});default:return i}},ce=["type"],_e=function(i,t){return{internalUpdateNodes:function(e,o){var r,d;B()(e,t().flattenNodes)||(i({flattenNodes:e},!1,o),(r=(d=t()).onFlattenNodesChange)===null||r===void 0||r.call(d,e))},dispatchNodes:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},r=o.recordHistory,d=r===void 0?!0:r,_=e.type,v=j()(e,ce),c=ue(t().flattenNodes,e);if(!B()(c,t().flattenNodes)){t().internalUpdateNodes(c,{type:"dispatchFlattenNodes/".concat(_),payload:v});var P=t(),b=P.yjsDoc;d&&b.recordHistoryData({flattenNodes:c},{type:"nodes",name:e.type,timestamp:Date.now()})}},updateNodeMeta:function(e,o,r,d){t().dispatchNodes({type:"updateNodeMeta",id:e,key:o,value:r},d)},updateNodeState:function(e,o,r,d){t().dispatchNodes({type:"updateNodeState",id:e,key:o,value:r},d)},updateNodeContent:function(e,o,r,d){t().dispatchNodes({type:"updateNodeContent",id:e,key:o,value:r},d)},updateNodeData:function(e,o){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=arguments.length>3?arguments[3]:void 0;t().dispatchNodes({type:"updateNodeData",id:e,newData:o,deepReplace:r},d)},addNode:function(e){t().dispatchNodes({type:"addNode",node:e})},addNodes:function(e,o){t().dispatchNodes({type:"addNodes",nodes:e},o)},deleteNode:function(e){t().deselectElement(e),t().dispatchNodes({type:"deleteNode",id:e})}}},pe=n(335),fe=n.n(pe),ge=n(90228),ae=n.n(ge),ve=n(87999),se=n.n(ve),Ee=n(15558),te=n.n(Ee),me=n(67197),he=(0,me.kP)("0123456789abcdefghijklmnopqrstuvwxyz",16),ye=function(i,t){return{internalUpdateSelection:function(e,o){var r,d;i({selectedKeys:e},!1,o),(r=(d=t()).onSelectionChange)===null||r===void 0||r.call(d,e)},onElementSelectChange:function(e,o){o?t().selectElement(e):t().deselectElement(e)},actionList:function(){var e=t(),o=e.yjsDoc;return{undo:o.undoManager.undoStack.length,redo:o.undoManager.redoStack.length}},selectElement:function(e){t().selectedKeys.includes(e)||t().internalUpdateSelection([].concat(te()(t().selectedKeys),[e]),{type:"selection/selectElement",payload:{id:e}})},selectElements:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;t().internalUpdateSelection(o?[].concat(te()(t().selectedKeys),te()(e)):e,{type:"selection/selectElements",payload:{ids:e}})},selectAll:function(){var e=t().reactflow.getNodes(),o=t().reactflow.getEdges(),r=[].concat(te()(e.map(function(d){return d.id})),te()(o.map(function(d){return d.id})));t().internalUpdateSelection(r,{type:"selection/selectAll",payload:{ids:r}})},deselectElement:function(e){t().internalUpdateSelection(t().selectedKeys.filter(function(o){return o!==e}),{type:"selection/deselectElement",payload:{id:e}})},deselectAll:function(){t().internalUpdateSelection([],{type:"selection/deselectAll",payload:{}})},deleteSelection:function(){var e=t(),o=e.selectedKeys,r=e.flattenEdges,d=e.flattenNodes,_=e.dispatchNodes,v=e.dispatchEdges;o.forEach(function(c){d[c]&&_({type:"deleteNode",id:c}),r[c]&&v({type:"deleteEdge",id:c})})},copySelection:function(){var a=se()(ae()().mark(function o(){var r,d,_,v,c,P,b,V,S,J;return ae()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(r=t(),d=r.selectedKeys,_=r.flattenEdges,v=r.flattenNodes,d.length!==0){Y.next=3;break}return Y.abrupt("return");case 3:return c=Object.values(v).filter(function(de){return d.includes(de.id)}),P=Object.values(_).filter(function(de){return d.includes(de.id)}),b={nodes:c,edges:P},V=new Blob([JSON.stringify(b)],{type:"text/html"}),S=new Blob([JSON.stringify(b)],{type:"text/plain"}),J=new ClipboardItem({"text/html":V,"text/plain":S}),Y.next=11,navigator.clipboard.write([J]);case 11:return Y.abrupt("return",b);case 12:case"end":return Y.stop()}},o)}));function e(){return a.apply(this,arguments)}return e}(),paste:function(){var a=se()(ae()().mark(function o(){var r;return ae()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,navigator.clipboard.read();case 2:r=_.sent,r.forEach(function(v){var c=fe()(v.types),P;try{for(c.s();!(P=c.n()).done;){var b=P.value;if(b==="text/plain"){var V=v.getType(b);V.then(function(S){S.text().then(function(J){var G=void 0;try{G=JSON.parse(J)}catch(Y){}G&&t().pasteIntoFlow(G)})})}}}catch(S){c.e(S)}finally{c.f()}});case 4:case"end":return _.stop()}},o)}));function e(){return a.apply(this,arguments)}return e}(),pasteIntoFlow:function(e){var o=t(),r=o.yjsDoc,d=o.addEdges,_=o.addNodes,v=o.deselectAll,c=o.selectElements,P={},b={};v(),e.nodes.forEach(function(S){var J=he();P[J]=s()(s()({},S),{},{id:J,position:{x:S.position.x+10,y:S.position.y+10}}),e.edges.forEach(function(G){G.source===S.id&&(G.source=J),G.target===S.id&&(G.target=J)})}),e.edges.forEach(function(S){var J=X(S.source,S.target,S.sourceHandle,S.targetHandle);b[J]=s()(s()({},S),{},{id:J})}),_(P,{recordHistory:!1}),d(b,{recordHistory:!1}),r.recordHistoryData({flattenNodes:t().flattenNodes,flattenEdges:t().flattenEdges},{type:"paste",name:"\u7C98\u8D34",timestamp:Date.now()});var V=Object.keys(P).concat(Object.keys(b));c(V)},undo:function(){var e=t(),o=e.yjsDoc,r=e.internalUpdateEdges,d=e.internalUpdateNodes,_=o.undo(),v=o.getHistoryJSON(),c=v.flattenNodes,P=v.flattenEdges;d(c||{},{type:"history/undo",payload:_}),r(P||{},{type:"history/undo",payload:_})},redo:function(){var e=t(),o=e.yjsDoc,r=e.internalUpdateEdges,d=e.internalUpdateNodes,_=o.redo(),v=o.getHistoryJSON(),c=v.flattenNodes,P=v.flattenEdges;d(c,{type:"history/redo",payload:_}),r(P,{type:"history/redo",payload:_})}}},Ce=function(i){return function(){return s()(s()(s()(s()({},N),{},{yjsDoc:i},ie.apply(void 0,arguments)),_e.apply(void 0,arguments)),ye.apply(void 0,arguments))}},De=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=new K;return(0,W.F)()((0,H.v)(i)(Ce(t),{name:"FLOW_EDITOR"}),Z.X)},re=(0,F.k)(),Oe=re.Provider,Pe=re.useStore,Me=re.useStoreApi},79810:function(q,$,n){n.d($,{I:function(){return E},K:function(){return f}});var Z=n(26068),W=n.n(Z),H=n(67825),F=n.n(H),T=n(86674),A=n(50959),x=n(53649),p=n.n(x),C=n(95654),h,L,I,M=(0,C.kc)(function(m){var O=m.css,K=m.token;return{input:O(h||(h=p()([`
    position: relative;

    max-width: 100%;
    height: 36px;
    padding: 0 12px;

    transition: background-color 100ms `,`;

    input {
      background: transparent;
    }
  `])),K.motionEaseOut),block:O(L||(L=p()([`
    background-color: `,`;
    border: 1px solid transparent;

    &:hover {
      background-color: `,`;
    }
  `])),K.colorFillTertiary,K.colorFillQuaternary),textarea:O(I||(I=p()([`
    position: relative;

    max-width: 100%;
    padding: 8px 12px;

    transition: background-color 100ms `,`;

    textarea {
      background: transparent;
    }
  `])),K.motionEaseOut)}}),l=n(11527),D=["className","type"],y=["className","type"],E=(0,A.forwardRef)(function(m,O){var K=m.className,u=m.type,s=u===void 0?"ghost":u,N=F()(m,D),g=M(),j=g.styles,w=g.cx;return(0,l.jsx)(T.Z,W()({className:w(j.input,s==="block"&&j.block,K),ref:O},N))}),f=(0,A.memo)((0,A.forwardRef)(function(m,O){var K=m.className,u=m.type,s=u===void 0?"ghost":u,N=F()(m,y),g=M(),j=g.styles,w=g.cx;return(0,l.jsx)(T.Z.TextArea,W()({className:w(j.textarea,s==="block"&&j.block,K),ref:O},N))}))}}]);
