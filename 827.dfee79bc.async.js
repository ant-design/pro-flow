!(function(){var Ic=Object.defineProperty,Ac=Object.defineProperties;var Tc=Object.getOwnPropertyDescriptors;var Ws=Object.getOwnPropertySymbols;var Uc=Object.prototype.hasOwnProperty,vc=Object.prototype.propertyIsEnumerable;var Ks=(y,A,D)=>A in y?Ic(y,A,{enumerable:!0,configurable:!0,writable:!0,value:D}):y[A]=D,mn=(y,A)=>{for(var D in A||(A={}))Uc.call(A,D)&&Ks(y,D,A[D]);if(Ws)for(var D of Ws(A))vc.call(A,D)&&Ks(y,D,A[D]);return y},sr=(y,A)=>Ac(y,Tc(A));(self.webpackChunk_ant_design_pro_flow=self.webpackChunk_ant_design_pro_flow||[]).push([[827],{58991:function(y,A,D){"use strict";D.d(A,{Z:function(){return T}});var U=D(28957),B=D(50959),k={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"filled"},F=k,C=D(89011),x=function(q,dt){return B.createElement(C.Z,(0,U.Z)({},q,{ref:dt,icon:F}))},T=B.forwardRef(x)},80111:function(y,A,D){"use strict";var U=D(50959),B=D(93915),k=D(85303);function F(C){k.Z&&((0,B.mf)(C)||console.error("useMemoizedFn expected parameter is a function, got ".concat(typeof C)));var x=(0,U.useRef)(C);x.current=(0,U.useMemo)(function(){return C},[C]);var T=(0,U.useRef)();return T.current||(T.current=function(){for(var J=[],q=0;q<arguments.length;q++)J[q]=arguments[q];return x.current.apply(this,J)}),T.current}A.Z=F},37870:function(y,A,D){"use strict";D.d(A,{N:function(){return k}});var U=D(50689),B=D(50959),k=function(C){return function(x,T){var J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[T],q=arguments.length>3?arguments[3]:void 0,dt=q!=null?q:C.setState;(0,B.useEffect)(function(){typeof T!="undefined"&&dt((0,U.Z)({},x,T),!1,{type:"\u{1F4AD} useStoreUpdater / ".concat(x),payload:T})},J)}}},58182:function(y,A,D){"use strict";D.d(A,{v:function(){return B}});var U=D(88950),B=function(F){return F?U.mW:function(C){return C}}},30006:function(y,A,D){var U=D(25705);function B(k){if(Array.isArray(k))return U(k)}y.exports=B,y.exports.__esModule=!0,y.exports.default=y.exports},68608:function(y){function A(D){if(D===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}y.exports=A,y.exports.__esModule=!0,y.exports.default=y.exports},21140:function(y){function A(D,U){if(!(D instanceof U))throw new TypeError("Cannot call a class as a function")}y.exports=A,y.exports.__esModule=!0,y.exports.default=y.exports},63466:function(y,A,D){var U=D(26982);function B(F,C){for(var x=0;x<C.length;x++){var T=C[x];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(F,U(T.key),T)}}function k(F,C,x){return C&&B(F.prototype,C),x&&B(F,x),Object.defineProperty(F,"prototype",{writable:!1}),F}y.exports=k,y.exports.__esModule=!0,y.exports.default=y.exports},54689:function(y,A,D){var U=D(41442);function B(k,F){var C=typeof Symbol!="undefined"&&k[Symbol.iterator]||k["@@iterator"];if(!C){if(Array.isArray(k)||(C=U(k))||F&&k&&typeof k.length=="number"){C&&(k=C);var x=0,T=function(){};return{s:T,n:function(){return x>=k.length?{done:!0}:{done:!1,value:k[x++]}},e:function(it){throw it},f:T}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var J=!0,q=!1,dt;return{s:function(){C=C.call(k)},n:function(){var it=C.next();return J=it.done,it},e:function(it){q=!0,dt=it},f:function(){try{!J&&C.return!=null&&C.return()}finally{if(q)throw dt}}}}y.exports=B,y.exports.__esModule=!0,y.exports.default=y.exports},38888:function(y,A,D){var U=D(44908),B=D(14614),k=D(91621);function F(C){var x=B();return function(){var J=U(C),q;if(x){var dt=U(this).constructor;q=Reflect.construct(J,arguments,dt)}else q=J.apply(this,arguments);return k(this,q)}}y.exports=F,y.exports.__esModule=!0,y.exports.default=y.exports},44908:function(y){function A(D){return y.exports=A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(B){return B.__proto__||Object.getPrototypeOf(B)},y.exports.__esModule=!0,y.exports.default=y.exports,A(D)}y.exports=A,y.exports.__esModule=!0,y.exports.default=y.exports},58853:function(y,A,D){var U=D(49154);function B(k,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function");k.prototype=Object.create(F&&F.prototype,{constructor:{value:k,writable:!0,configurable:!0}}),Object.defineProperty(k,"prototype",{writable:!1}),F&&U(k,F)}y.exports=B,y.exports.__esModule=!0,y.exports.default=y.exports},14614:function(y){function A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(D){return!1}}y.exports=A,y.exports.__esModule=!0,y.exports.default=y.exports},16660:function(y){function A(D){if(typeof Symbol!="undefined"&&D[Symbol.iterator]!=null||D["@@iterator"]!=null)return Array.from(D)}y.exports=A,y.exports.__esModule=!0,y.exports.default=y.exports},95848:function(y){function A(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}y.exports=A,y.exports.__esModule=!0,y.exports.default=y.exports},91621:function(y,A,D){var U=D(37635).default,B=D(68608);function k(F,C){if(C&&(U(C)==="object"||typeof C=="function"))return C;if(C!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return B(F)}y.exports=k,y.exports.__esModule=!0,y.exports.default=y.exports},49154:function(y){function A(D,U){return y.exports=A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(k,F){return k.__proto__=F,k},y.exports.__esModule=!0,y.exports.default=y.exports,A(D,U)}y.exports=A,y.exports.__esModule=!0,y.exports.default=y.exports},93525:function(y,A,D){var U=D(30006),B=D(16660),k=D(41442),F=D(95848);function C(x){return U(x)||B(x)||k(x)||F()}y.exports=C,y.exports.__esModule=!0,y.exports.default=y.exports},16391:function(y,A,D){"use strict";D.d(A,{Uy:function(){return Yt}});var U=Symbol.for("immer-nothing"),B=Symbol.for("immer-draftable"),k=Symbol.for("immer-state"),F=[];function C(l,...h){throw new Error(`[Immer] minified error nr: ${l}. Full error at: https://bit.ly/3cXEKWf`)}var x=Object.getPrototypeOf;function T(l){return!!l&&!!l[k]}function J(l){var h;return l?dt(l)||Array.isArray(l)||!!l[B]||!!((h=l.constructor)!=null&&h[B])||ee(l)||ne(l):!1}var q=Object.prototype.constructor.toString();function dt(l){if(!l||typeof l!="object")return!1;const h=x(l);if(h===null)return!0;const w=Object.hasOwnProperty.call(h,"constructor")&&h.constructor;return w===Object?!0:typeof w=="function"&&Function.toString.call(w)===q}function lt(l){return T(l)||C(15,l),l[k].base_}function it(l,h){St(l)===0?Object.entries(l).forEach(([w,m])=>{h(w,m,l)}):l.forEach((w,m)=>h(m,w,l))}function St(l){const h=l[k];return h?h.type_:Array.isArray(l)?1:ee(l)?2:ne(l)?3:0}function Wt(l,h){return St(l)===2?l.has(h):Object.prototype.hasOwnProperty.call(l,h)}function kt(l,h){return St(l)===2?l.get(h):l[h]}function Ve(l,h,w){const m=St(l);m===2?l.set(h,w):m===3?l.add(w):l[h]=w}function bn(l,h){return l===h?l!==0||1/l===1/h:l!==l&&h!==h}function ee(l){return l instanceof Map}function ne(l){return l instanceof Set}function rt(l){return l.copy_||l.base_}function Se(l,h){if(ee(l))return new Map(l);if(ne(l))return new Set(l);if(Array.isArray(l))return Array.prototype.slice.call(l);if(!h&&dt(l))return x(l)?mn({},l):Object.assign(Object.create(null),l);const w=Object.getOwnPropertyDescriptors(l);delete w[k];let m=Reflect.ownKeys(w);for(let I=0;I<m.length;I++){const R=m[I],L=w[R];L.writable===!1&&(L.writable=!0,L.configurable=!0),(L.get||L.set)&&(w[R]={configurable:!0,writable:!0,enumerable:L.enumerable,value:l[R]})}return Object.create(x(l),w)}function Ft(l,h=!1){return ke(l)||T(l)||!J(l)||(St(l)>1&&(l.set=l.add=l.clear=l.delete=ir),Object.freeze(l),h&&it(l,(w,m)=>Ft(m,!0),!0)),l}function ir(){C(2)}function ke(l){return Object.isFrozen(l)}var Fe={};function Pt(l){const h=Fe[l];return h||C(0,l),h}function Ee(l,h){Fe[l]||(Fe[l]=h)}var gt;function De(){return gt}function re(l,h){return{drafts_:[],parent_:l,immer_:h,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Sn(l,h){h&&(Pt("Patches"),l.patches_=[],l.inversePatches_=[],l.patchListener_=h)}function Pe(l){ze(l),l.drafts_.forEach(or),l.drafts_=null}function ze(l){l===gt&&(gt=l.parent_)}function kn(l){return gt=re(gt,l)}function or(l){const h=l[k];h.type_===0||h.type_===1?h.revoke_():h.revoked_=!0}function En(l,h){h.unfinalizedDrafts_=h.drafts_.length;const w=h.drafts_[0];return l!==void 0&&l!==w?(w[k].modified_&&(Pe(h),C(4)),J(l)&&(l=Ce(h,l),h.parent_||Et(h,l)),h.patches_&&Pt("Patches").generateReplacementPatches_(w[k].base_,l,h.patches_,h.inversePatches_)):l=Ce(h,w,[]),Pe(h),h.patches_&&h.patchListener_(h.patches_,h.inversePatches_),l!==U?l:void 0}function Ce(l,h,w){if(ke(h))return h;const m=h[k];if(!m)return it(h,(I,R)=>Ie(l,m,h,I,R,w),!0),h;if(m.scope_!==l)return h;if(!m.modified_)return Et(l,m.base_,!0),m.base_;if(!m.finalized_){m.finalized_=!0,m.scope_.unfinalizedDrafts_--;const I=m.copy_;let R=I,L=!1;m.type_===3&&(R=new Set(I),I.clear(),L=!0),it(R,(O,b)=>Ie(l,m,I,O,b,w,L)),Et(l,I,!1),w&&l.patches_&&Pt("Patches").generatePatches_(m,w,l.patches_,l.inversePatches_)}return m.copy_}function Ie(l,h,w,m,I,R,L){if(T(I)){const O=R&&h&&h.type_!==3&&!Wt(h.assigned_,m)?R.concat(m):void 0,b=Ce(l,I,O);if(Ve(w,m,b),T(b))l.canAutoFreeze_=!1;else return}else L&&w.add(I);if(J(I)&&!ke(I)){if(!l.immer_.autoFreeze_&&l.unfinalizedDrafts_<1)return;Ce(l,I),(!h||!h.scope_.parent_)&&Et(l,I)}}function Et(l,h,w=!1){!l.parent_&&l.immer_.autoFreeze_&&l.canAutoFreeze_&&Ft(h,w)}function cr(l,h){const w=Array.isArray(l),m={type_:w?1:0,scope_:h?h.scope_:De(),modified_:!1,finalized_:!1,assigned_:{},parent_:h,base_:l,draft_:null,copy_:null,revoke_:null,isManual_:!1};let I=m,R=je;w&&(I=[m],R=se);const{revoke:L,proxy:O}=Proxy.revocable(I,R);return m.draft_=O,m.revoke_=L,O}var je={get(l,h){if(h===k)return l;const w=rt(l);if(!Wt(w,h))return Dn(l,w,h);const m=w[h];return l.finalized_||!J(m)?m:m===He(l.base_,h)?(Ge(l),l.copy_[h]=Kt(m,l)):m},has(l,h){return h in rt(l)},ownKeys(l){return Reflect.ownKeys(rt(l))},set(l,h,w){const m=Ae(rt(l),h);if(m!=null&&m.set)return m.set.call(l.draft_,w),!0;if(!l.modified_){const I=He(rt(l),h),R=I==null?void 0:I[k];if(R&&R.base_===w)return l.copy_[h]=w,l.assigned_[h]=!1,!0;if(bn(w,I)&&(w!==void 0||Wt(l.base_,h)))return!0;Ge(l),Ut(l)}return l.copy_[h]===w&&(w!==void 0||h in l.copy_)||Number.isNaN(w)&&Number.isNaN(l.copy_[h])||(l.copy_[h]=w,l.assigned_[h]=!0),!0},deleteProperty(l,h){return He(l.base_,h)!==void 0||h in l.base_?(l.assigned_[h]=!1,Ge(l),Ut(l)):delete l.assigned_[h],l.copy_&&delete l.copy_[h],!0},getOwnPropertyDescriptor(l,h){const w=rt(l),m=Reflect.getOwnPropertyDescriptor(w,h);return m&&{writable:!0,configurable:l.type_!==1||h!=="length",enumerable:m.enumerable,value:w[h]}},defineProperty(){C(11)},getPrototypeOf(l){return x(l.base_)},setPrototypeOf(){C(12)}},se={};it(je,(l,h)=>{se[l]=function(){return arguments[0]=arguments[0][0],h.apply(this,arguments)}}),se.deleteProperty=function(l,h){return se.set.call(this,l,h,void 0)},se.set=function(l,h,w){return je.set.call(this,l[0],h,w,l[0])};function He(l,h){const w=l[k];return(w?rt(w):l)[h]}function Dn(l,h,w){var I;const m=Ae(h,w);return m?"value"in m?m.value:(I=m.get)==null?void 0:I.call(l.draft_):void 0}function Ae(l,h){if(!(h in l))return;let w=x(l);for(;w;){const m=Object.getOwnPropertyDescriptor(w,h);if(m)return m;w=x(w)}}function Ut(l){l.modified_||(l.modified_=!0,l.parent_&&Ut(l.parent_))}function Ge(l){l.copy_||(l.copy_=Se(l.base_,l.scope_.immer_.useStrictShallowCopy_))}var Cn=class{constructor(l){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(h,w,m)=>{if(typeof h=="function"&&typeof w!="function"){const R=w;w=h;const L=this;return function(b=R,...E){return L.produce(b,P=>w.call(this,P,...E))}}typeof w!="function"&&C(6),m!==void 0&&typeof m!="function"&&C(7);let I;if(J(h)){const R=kn(this),L=Kt(h,void 0);let O=!0;try{I=w(L),O=!1}finally{O?Pe(R):ze(R)}return Sn(R,m),En(I,R)}else if(!h||typeof h!="object"){if(I=w(h),I===void 0&&(I=h),I===U&&(I=void 0),this.autoFreeze_&&Ft(I,!0),m){const R=[],L=[];Pt("Patches").generateReplacementPatches_(h,I,R,L),m(R,L)}return I}else C(1,h)},this.produceWithPatches=(h,w)=>{if(typeof h=="function")return(L,...O)=>this.produceWithPatches(L,b=>h(b,...O));let m,I;return[this.produce(h,w,(L,O)=>{m=L,I=O}),m,I]},typeof(l==null?void 0:l.autoFreeze)=="boolean"&&this.setAutoFreeze(l.autoFreeze),typeof(l==null?void 0:l.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(l.useStrictShallowCopy)}createDraft(l){J(l)||C(8),T(l)&&(l=In(l));const h=kn(this),w=Kt(l,void 0);return w[k].isManual_=!0,ze(h),w}finishDraft(l,h){const w=l&&l[k];(!w||!w.isManual_)&&C(9);const{scope_:m}=w;return Sn(m,h),En(void 0,m)}setAutoFreeze(l){this.autoFreeze_=l}setUseStrictShallowCopy(l){this.useStrictShallowCopy_=l}applyPatches(l,h){let w;for(w=h.length-1;w>=0;w--){const I=h[w];if(I.path.length===0&&I.op==="replace"){l=I.value;break}}w>-1&&(h=h.slice(w+1));const m=Pt("Patches").applyPatches_;return T(l)?m(l,h):this.produce(l,I=>m(I,h))}};function Kt(l,h){const w=ee(l)?Pt("MapSet").proxyMap_(l,h):ne(l)?Pt("MapSet").proxySet_(l,h):cr(l,h);return(h?h.scope_:De()).drafts_.push(w),w}function In(l){return T(l)||C(10,l),Je(l)}function Je(l){if(!J(l)||ke(l))return l;const h=l[k];let w;if(h){if(!h.modified_)return h.base_;h.finalized_=!0,w=Se(l,h.scope_.immer_.useStrictShallowCopy_)}else w=Se(l,!0);return it(w,(m,I)=>{Ve(w,m,Je(I))}),h&&(h.finalized_=!1),w}function An(){const h="replace",w="add",m="remove";function I(N,$,W,X){switch(N.type_){case 0:case 2:return L(N,$,W,X);case 1:return R(N,$,W,X);case 3:return O(N,$,W,X)}}function R(N,$,W,X){let{base_:st,assigned_:K}=N,Z=N.copy_;Z.length<st.length&&([st,Z]=[Z,st],[W,X]=[X,W]);for(let V=0;V<st.length;V++)if(K[V]&&Z[V]!==st[V]){const z=$.concat([V]);W.push({op:h,path:z,value:ct(Z[V])}),X.push({op:h,path:z,value:ct(st[V])})}for(let V=st.length;V<Z.length;V++){const z=$.concat([V]);W.push({op:w,path:z,value:ct(Z[V])})}for(let V=Z.length-1;st.length<=V;--V){const z=$.concat([V]);X.push({op:m,path:z})}}function L(N,$,W,X){const{base_:st,copy_:K}=N;it(N.assigned_,(Z,V)=>{const z=kt(st,Z),pt=kt(K,Z),yt=V?Wt(st,Z)?h:w:m;if(z===pt&&yt===h)return;const ut=$.concat(Z);W.push(yt===m?{op:yt,path:ut}:{op:yt,path:ut,value:pt}),X.push(yt===w?{op:m,path:ut}:yt===m?{op:w,path:ut,value:ct(z)}:{op:h,path:ut,value:ct(z)})})}function O(N,$,W,X){let{base_:st,copy_:K}=N,Z=0;st.forEach(V=>{if(!K.has(V)){const z=$.concat([Z]);W.push({op:m,path:z,value:V}),X.unshift({op:w,path:z,value:V})}Z++}),Z=0,K.forEach(V=>{if(!st.has(V)){const z=$.concat([Z]);W.push({op:w,path:z,value:V}),X.unshift({op:m,path:z,value:V})}Z++})}function b(N,$,W,X){W.push({op:h,path:[],value:$===U?void 0:$}),X.push({op:h,path:[],value:N})}function E(N,$){return $.forEach(W=>{const{path:X,op:st}=W;let K=N;for(let pt=0;pt<X.length-1;pt++){const yt=St(K);let ut=X[pt];typeof ut!="string"&&typeof ut!="number"&&(ut=""+ut),(yt===0||yt===1)&&(ut==="__proto__"||ut==="constructor")&&C(16+3),typeof K=="function"&&ut==="prototype"&&C(16+3),K=kt(K,ut),typeof K!="object"&&C(16+2,X.join("/"))}const Z=St(K),V=P(W.value),z=X[X.length-1];switch(st){case h:switch(Z){case 2:return K.set(z,V);case 3:C(16);default:return K[z]=V}case w:switch(Z){case 1:return z==="-"?K.push(V):K.splice(z,0,V);case 2:return K.set(z,V);case 3:return K.add(V);default:return K[z]=V}case m:switch(Z){case 1:return K.splice(z,1);case 2:return K.delete(z);case 3:return K.delete(W.value);default:return delete K[z]}default:C(16+1,st)}}),N}function P(N){if(!J(N))return N;if(Array.isArray(N))return N.map(P);if(ee(N))return new Map(Array.from(N.entries()).map(([W,X])=>[W,P(X)]));if(ne(N))return new Set(Array.from(N).map(P));const $=Object.create(x(N));for(const W in N)$[W]=P(N[W]);return Wt(N,B)&&($[B]=N[B]),$}function ct(N){return T(N)?P(N):N}Ee("Patches",{applyPatches_:E,generatePatches_:I,generateReplacementPatches_:b})}function Ys(){class l extends Map{constructor(b,E){super(),this[k]={type_:2,parent_:E,scope_:E?E.scope_:De(),modified_:!1,finalized_:!1,copy_:void 0,assigned_:void 0,base_:b,draft_:this,isManual_:!1,revoked_:!1}}get size(){return rt(this[k]).size}has(b){return rt(this[k]).has(b)}set(b,E){const P=this[k];return L(P),(!rt(P).has(b)||rt(P).get(b)!==E)&&(w(P),Ut(P),P.assigned_.set(b,!0),P.copy_.set(b,E),P.assigned_.set(b,!0)),this}delete(b){if(!this.has(b))return!1;const E=this[k];return L(E),w(E),Ut(E),E.base_.has(b)?E.assigned_.set(b,!1):E.assigned_.delete(b),E.copy_.delete(b),!0}clear(){const b=this[k];L(b),rt(b).size&&(w(b),Ut(b),b.assigned_=new Map,it(b.base_,E=>{b.assigned_.set(E,!1)}),b.copy_.clear())}forEach(b,E){const P=this[k];rt(P).forEach((ct,N,$)=>{b.call(E,this.get(N),N,this)})}get(b){const E=this[k];L(E);const P=rt(E).get(b);if(E.finalized_||!J(P)||P!==E.base_.get(b))return P;const ct=Kt(P,E);return w(E),E.copy_.set(b,ct),ct}keys(){return rt(this[k]).keys()}values(){const b=this.keys();return{[Symbol.iterator]:()=>this.values(),next:()=>{const E=b.next();return E.done?E:{done:!1,value:this.get(E.value)}}}}entries(){const b=this.keys();return{[Symbol.iterator]:()=>this.entries(),next:()=>{const E=b.next();if(E.done)return E;const P=this.get(E.value);return{done:!1,value:[E.value,P]}}}}[Symbol.iterator](){return this.entries()}}function h(O,b){return new l(O,b)}function w(O){O.copy_||(O.assigned_=new Map,O.copy_=new Map(O.base_))}class m extends Set{constructor(b,E){super(),this[k]={type_:3,parent_:E,scope_:E?E.scope_:De(),modified_:!1,finalized_:!1,copy_:void 0,base_:b,draft_:this,drafts_:new Map,revoked_:!1,isManual_:!1}}get size(){return rt(this[k]).size}has(b){const E=this[k];return L(E),E.copy_?!!(E.copy_.has(b)||E.drafts_.has(b)&&E.copy_.has(E.drafts_.get(b))):E.base_.has(b)}add(b){const E=this[k];return L(E),this.has(b)||(R(E),Ut(E),E.copy_.add(b)),this}delete(b){if(!this.has(b))return!1;const E=this[k];return L(E),R(E),Ut(E),E.copy_.delete(b)||(E.drafts_.has(b)?E.copy_.delete(E.drafts_.get(b)):!1)}clear(){const b=this[k];L(b),rt(b).size&&(R(b),Ut(b),b.copy_.clear())}values(){const b=this[k];return L(b),R(b),b.copy_.values()}entries(){const b=this[k];return L(b),R(b),b.copy_.entries()}keys(){return this.values()}[Symbol.iterator](){return this.values()}forEach(b,E){const P=this.values();let ct=P.next();for(;!ct.done;)b.call(E,ct.value,ct.value,this),ct=P.next()}}function I(O,b){return new m(O,b)}function R(O){O.copy_||(O.copy_=new Set,O.base_.forEach(b=>{if(J(b)){const E=Kt(b,O);O.drafts_.set(b,E),O.copy_.add(E)}else O.copy_.add(b)}))}function L(O){O.revoked_&&C(3,JSON.stringify(rt(O)))}Ee("MapSet",{proxyMap_:h,proxySet_:I})}var at=new Cn,Yt=at.produce,Xs=at.produceWithPatches.bind(at),lr=at.setAutoFreeze.bind(at),Zs=at.setUseStrictShallowCopy.bind(at),Te=at.applyPatches.bind(at),qs=at.createDraft.bind(at),Qs=at.finishDraft.bind(at);function ti(l){return l}function ei(l){return l}},67197:function(y,A,D){"use strict";D.d(A,{kP:function(){return k}});let U=C=>crypto.getRandomValues(new Uint8Array(C)),B=(C,x,T)=>{let J=(2<<Math.log(C.length-1)/Math.LN2)-1,q=-~(1.6*J*x/C.length);return(dt=x)=>{let lt="";for(;;){let it=T(q),St=q;for(;St--;)if(lt+=C[it[St]&J]||"",lt.length===dt)return lt}}},k=(C,x=21)=>B(C,x,U),F=(C=21)=>crypto.getRandomValues(new Uint8Array(C)).reduce((x,T)=>(T&=63,T<36?x+=T.toString(36):T<62?x+=(T-26).toString(36).toUpperCase():T>62?x+="-":x+="_",x),"")},79536:function(y,A,D){"use strict";D.d(A,{QW:function(){return Xt},H6:function(){return xo}});const U=()=>new Map,B=e=>{const t=U();return e.forEach((n,r)=>{t.set(r,n)}),t},k=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},F=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},C=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},x=(e,t)=>{for(const[n,r]of e)if(!t(r,n))return!1;return!0},T=()=>new Set,J=e=>Array.from(e),q=e=>e.values().next().value||void 0,dt=e=>new Set(e),lt=e=>e[e.length-1],it=()=>[],St=e=>e.slice(),Wt=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},kt=Array.from,Ve=(e,t)=>{for(let n=0;n<e.length;n++)if(!t(e[n],n,e))return!1;return!0},bn=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1},ee=(e,t)=>e.length===t.length&&Ve(e,(n,r)=>n===t[r]),ne=e=>Se(e,[],(t,n)=>t.concat(n)),rt=(e,t)=>{const n=new Array(e);for(let r=0;r<e;r++)n[r]=t(r,n);return n},Se=(e,t,n)=>e.reduce(n,t),Ft=Array.isArray,ir=e=>kt(set.from(e)),ke=(e,t)=>{const n=set.create(),r=[];for(let s=0;s<e.length;s++){const i=e[s],o=t(i);n.has(o)||(n.add(o),r.push(i))}return r},Fe=(e,t)=>{const n=Array(e.length);for(let r=0;r<e.length;r++)n[r]=t(e[r],r,e);return n};class Pt{constructor(){this._observers=map.create()}on(t,n){return map.setIfUndefined(this._observers,t,set.create).add(n),n}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return array.from((this._observers.get(t)||map.create()).values()).forEach(r=>r(...n))}destroy(){this._observers=map.create()}}class Ee{constructor(){this._observers=U()}on(t,n){k(this._observers,t,T).add(n)}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return kt((this._observers.get(t)||U()).values()).forEach(r=>r(...n))}destroy(){this._observers=U()}}const gt=Math.floor,De=Math.ceil,re=Math.abs,Sn=Math.imul,Pe=Math.round,ze=Math.log10,kn=Math.log2,or=Math.log,En=Math.sqrt,Ce=(e,t)=>e+t,Ie=(e,t)=>e<t?e:t,Et=(e,t)=>e>t?e:t,cr=Number.isNaN,je=Math.pow,se=e=>Math.pow(10,e),He=Math.sign,Dn=e=>e!==0?e<0:1/e<0,Ae=String.fromCharCode,Ut=String.fromCodePoint,Ge=Ae(65535),Cn=e=>e.toLowerCase(),Kt=/^\s*/g,In=e=>e.replace(Kt,""),Je=/([A-Z])/g,An=(e,t)=>In(e.replace(Je,n=>`${t}${Cn(n)}`)),Ys=e=>unescape(encodeURIComponent(e)).length,at=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},Yt=typeof TextEncoder!="undefined"?new TextEncoder:null,lr=Yt?e=>Yt.encode(e):at,Zs=e=>{let t=e.length,n="",r=0;for(;t>0;){const s=t<1e4?t:1e4,i=e.subarray(r,r+s);r+=s,n+=String.fromCodePoint.apply(null,i),t-=s}return decodeURIComponent(escape(n))};let Te=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Te&&Te.decode(new Uint8Array).length===1&&(Te=null);const qs=e=>Te.decode(e),Qs=null,ti=(e,t,n,r="")=>e.slice(0,t)+r+e.slice(t+n),ei=(e,t)=>array.unfold(t,()=>e).join(""),l=e=>e===void 0?null:e;class h{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let w=new h,m=!0;try{typeof localStorage!="undefined"&&(w=localStorage,m=!1)}catch(e){}const I=w,R=e=>m||addEventListener("storage",e),L=e=>m||removeEventListener("storage",e),O=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&O(e,t,n+1)}},b=()=>{},E=e=>e(),P=e=>e,ct=(e,t)=>e===t,N=(e,t)=>e===t||e!=null&&t!=null&&e.constructor===t.constructor&&(array.isArray(e)&&array.equalFlat(e,t)||typeof e=="object"&&object.equalFlat(e,t)),$=(e,t)=>{if(e==null||t==null)return ct(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!$(e.get(n),t.get(n)))return!1;break}case Object:if(object.length(e)!==object.length(t))return!1;for(const n in e)if(!object.hasProperty(e,n)||!$(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!$(e[n],t[n]))return!1;break;default:return!1}return!0},W=(e,t)=>t.includes(e),X=Ft,st=e=>e&&e.constructor===String,K=e=>e!=null&&e.constructor===Number,Z=(e,t)=>e&&e.constructor===t,V=e=>t=>t&&t.constructor===e;var z=D(14224);const pt=typeof z!="undefined"&&z.release&&/node|io\.js/.test(z.release.name),yt=typeof window!="undefined"&&typeof document!="undefined"&&!pt,ut=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1;let vt;const ni=[],Tn=()=>{if(vt===void 0)if(pt){vt=U();const e=z.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&vt.set(t,""),t=r):t!==null?(vt.set(t,r),t=null):ni.push(r)}t!==null&&vt.set(t,"")}else typeof location=="object"?(vt=U(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");vt.set(`--${An(t,"-")}`,n),vt.set(`-${An(t,"-")}`,n)}})):vt=U();return vt},Un=e=>Tn().has(e),xc=(e,t)=>Tn().get(e)||t,$e=e=>l(pt?{NODE_ENV:"production",PUBLIC_PATH:"/pro-flow/"}[e.toUpperCase()]:I.getItem(e)),Oc=e=>Tn().get("--"+e)||$e(e),Bc=(e=>Un("--"+e)||$e(e)!==null)("production"),ar=pt&&W({NODE_ENV:"production",PUBLIC_PATH:"/pro-flow/"}.FORCE_COLOR,["true","1","2"]),ri=!Un("no-colors")&&(!pt||z.stdout.isTTY||ar)&&(!pt||Un("color")||ar||$e("COLORTERM")!==null||($e("TERM")||"").includes("color"));var ur=D(36379).Buffer;const hr=e=>new Uint8Array(e),dr=(e,t,n)=>new Uint8Array(e,t,n),Nc=e=>new Uint8Array(e),si=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=Ae(e[n]);return btoa(t)},ii=e=>ur.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),oi=e=>{const t=atob(e),n=hr(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},ci=e=>{const t=ur.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},li=yt?si:ii,ai=yt?oi:ci,Lc=e=>li(e).replaceAll("+","-").replaceAll("/","_").replaceAll("=",""),Rc=e=>ai(e.replaceAll("-","+").replaceAll("_","/")),Vc=e=>array.map(e,t=>t.toString(16).padStart(2,"0")).join(""),Fc=e=>{const t=e.length,n=new Uint8Array(math.ceil(t/2));for(let r=0;r<t;r+=2)n[n.length-r/2-1]=Number.parseInt(e.slice(t-r-2,t-r),16);return n},Pc=e=>{const t=hr(e.byteLength);return t.set(e),t},zc=e=>{const t=encoding.createEncoder();return encoding.writeAny(t,e),encoding.toUint8Array(t)},jc=e=>decoding.readAny(decoding.createDecoder(e)),Hc=(e,t)=>{if(t===0)return e;e=new Uint8Array(e),e[0]<<=t;for(let n=1;n<e.length;n++)e[n-1]|=e[n]>>>8-t,e[n]<<=t;return e},fr=1,gr=2,vn=4,xn=8,Gc=16,ui=32,pr=64,We=128,Jc=256,$c=512,Wc=1024,Kc=2048,Yc=4096,Xc=8192,Zc=16384,qc=32768,Qc=65536,hi=1<<17,di=1<<18,fi=1<<19,gi=1<<20,pi=1<<21,wi=1<<22,_i=1<<23,yi=1<<24,mi=1<<25,bi=1<<26,Si=1<<27,ki=1<<28,Ei=1<<29,Di=1<<30,tl=null,el=0,nl=1,rl=3,sl=7,il=15,Ci=31,wr=63,Ue=127,ol=255,cl=511,ll=1023,al=2047,ul=4095,hl=8191,dl=16383,fl=32767,gl=65535,pl=hi-1,wl=di-1,_l=fi-1,yl=gi-1,ml=pi-1,bl=wi-1,Sl=_i-1,kl=yi-1,El=mi-1,Dl=bi-1,Cl=Si-1,Il=ki-1,Al=Ei-1,Tl=Di-1,_r=2147483647,Ii=4294967295,Ul=Number.MAX_SAFE_INTEGER,vl=Number.MIN_SAFE_INTEGER,xl=null,Ol=_r,Ml=Ii,Ai=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&gt(e)===e),Bl=Number.isNaN,Nl=Number.parseInt,Ll=e=>{e&=binary.BITS32;let t=0;for(;e;)e&=e-1,t++;return t};class ie{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ke=()=>new ie,Rl=e=>{const t=Ke();return e(t),mt(t)},Ti=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Vl=e=>e.cpos>0||e.bufs.length>0,mt=e=>{const t=new Uint8Array(Ti(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(dr(e.cbuf.buffer,0,e.cpos),n),t},Ui=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(dr(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Et(n,t)*2),e.cpos=0)},Y=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},On=(e,t,n)=>{let r=null;for(let s=0;s<e.bufs.length&&r===null;s++){const i=e.bufs[s];t<i.length?r=i:t-=i.length}r===null&&(r=e.cbuf),r[t]=n},Mn=Y,Fl=null,Pl=(e,t)=>{Y(e,t&binary.BITS8),Y(e,t>>>8&binary.BITS8)},zl=(e,t,n)=>{On(e,t,n&binary.BITS8),On(e,t+1,n>>>8&binary.BITS8)},jl=(e,t)=>{for(let n=0;n<4;n++)Y(e,t&binary.BITS8),t>>>=8},Hl=(e,t)=>{for(let n=3;n>=0;n--)Y(e,t>>>8*n&binary.BITS8)},Gl=(e,t,n)=>{for(let r=0;r<4;r++)On(e,t+r,n&binary.BITS8),n>>>=8},j=(e,t)=>{for(;t>Ue;)Y(e,We|Ue&t),t=gt(t/128);Y(e,Ue&t)},ve=(e,t)=>{const n=Dn(t);for(n&&(t=-t),Y(e,(t>wr?We:0)|(n?pr:0)|wr&t),t=gt(t/64);t>0;)Y(e,(t>Ue?We:0)|Ue&t),t=gt(t/128)},Bn=new Uint8Array(3e4),vi=Bn.length/3,xi=(e,t)=>{if(t.length<vi){const n=Yt.encodeInto(t,Bn).written||0;j(e,n);for(let r=0;r<n;r++)Y(e,Bn[r])}else wt(e,lr(t))},Oi=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;j(e,r);for(let s=0;s<r;s++)Y(e,n.codePointAt(s))},oe=Yt&&Yt.encodeInto?xi:Oi,Jl=(e,t)=>Mi(e,string.encodeUtf8(t)),Mi=(e,t)=>{for(let n=0;n<t.length;n++){const r=t[n];(r===0||r===1)&&Y(e,1),Y(e,t[n])}Y(e,0)},$l=(e,t)=>Ye(e,mt(t)),Ye=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=Ie(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Et(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},wt=(e,t)=>{j(e,t.byteLength),Ye(e,t)},Xe=(e,t)=>{Ui(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Bi=(e,t)=>Xe(e,4).setFloat32(0,t,!1),Ni=(e,t)=>Xe(e,8).setFloat64(0,t,!1),Li=(e,t)=>Xe(e,8).setBigInt64(0,t,!1),Wl=(e,t)=>Xe(e,8).setBigUint64(0,t,!1),yr=new DataView(new ArrayBuffer(4)),Ri=e=>(yr.setFloat32(0,e),yr.getFloat32(0)===e),xe=(e,t)=>{switch(typeof t){case"string":Y(e,119),oe(e,t);break;case"number":Ai(t)&&re(t)<=_r?(Y(e,125),ve(e,t)):Ri(t)?(Y(e,124),Bi(e,t)):(Y(e,123),Ni(e,t));break;case"bigint":Y(e,122),Li(e,t);break;case"object":if(t===null)Y(e,126);else if(Ft(t)){Y(e,117),j(e,t.length);for(let n=0;n<t.length;n++)xe(e,t[n])}else if(t instanceof Uint8Array)Y(e,116),wt(e,t);else{Y(e,118);const n=Object.keys(t);j(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];oe(e,s),xe(e,t[s])}}break;case"boolean":Y(e,t?120:121);break;default:Y(e,127)}};class mr extends ie{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&j(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}class Kl extends null{constructor(t){super(),this.s=t}write(t){ve(this,t-this.s),this.s=t}}class Yl extends null{constructor(t){super(),this.s=t,this.count=0}write(t){this.s===t&&this.count>0?this.count++:(this.count>0&&j(this,this.count-1),this.count=1,ve(this,t-this.s),this.s=t)}}const Ze=e=>{e.count>0&&(ve(e.encoder,e.count===1?e.s:-e.s),e.count>1&&j(e.encoder,e.count-2))};class qe{constructor(){this.encoder=new ie,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Ze(this),this.count=1,this.s=t)}toUint8Array(){return Ze(this),mt(this.encoder)}}class Xl{constructor(){this.encoder=new ie,this.s=0,this.count=0}write(t){this.s+this.count===t?this.count++:(Ze(this),this.count=1,this.s=t)}toUint8Array(){return Ze(this),mt(this.encoder)}}const br=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);ve(e.encoder,t),e.count>1&&j(e.encoder,e.count-2)}};class Nn{constructor(){this.encoder=new ie,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(br(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return br(this),mt(this.encoder)}}class Vi{constructor(){this.sarr=[],this.s="",this.lensE=new qe}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new ie;return this.sarr.push(this.s),this.s="",oe(t,this.sarr.join("")),Ye(t,this.lensE.toUint8Array()),mt(t)}}const Zl=crypto.subtle,Fi=crypto.getRandomValues.bind(crypto),Pi=Math.random,Sr=()=>Fi(new Uint32Array(1))[0],ql=()=>{const e=getRandomValues(new Uint32Array(8));return(e[0]&binary.BITS21)*(binary.BITS32+1)+(e[1]>>>0)},Ql=e=>e[math.floor(Pi()*e.length)],zi=[1e7]+-1e3+-4e3+-8e3+-1e11,ji=()=>zi.replace(/[018]/g,e=>(e^Sr()&15>>e/4).toString(16)),Qe=e=>new Promise(e),ta=e=>new Promise(e),ea=Promise.all.bind(Promise),na=e=>Promise.reject(e),ra=e=>Promise.resolve(e),sa=e=>Promise.resolve(e),ia=(e,t,n=10)=>Qe((r,s)=>{const i=time.getUnixTime(),o=e>0,a=setInterval(()=>{t()?(clearInterval(a),r()):o&&time.getUnixTime()-i>e&&(clearInterval(a),s(new Error("Timeout")))},n)}),oa=e=>Qe((t,n)=>setTimeout(t,e)),ca=e=>e instanceof Promise||e&&e.then&&e.catch&&e.finally,ce=e=>new Error(e),xt=()=>{throw ce("Method unimplemented")},Nt=()=>{throw ce("Unexpected case")};class kr{constructor(t,n){this.left=t,this.right=n}}const Lt=(e,t)=>new kr(e,t),la=(e,t)=>new kr(t,e),aa=(e,t)=>e.forEach(n=>t(n.left,n.right)),ua=(e,t)=>e.map(n=>t(n.left,n.right)),Dt=typeof document!="undefined"?document:{},Er=e=>Dt.createElement(e),Hi=()=>Dt.createDocumentFragment(),ha=e=>Dt.createTextNode(e),Gi=typeof DOMParser!="undefined"?new DOMParser:null,da=(e,t,n)=>e.dispatchEvent(new CustomEvent(t,n)),Ji=(e,t)=>(pair.forEach(t,(n,r)=>{r===!1?e.removeAttribute(n):r===!0?e.setAttribute(n,""):e.setAttribute(n,r)}),e),fa=(e,t)=>(t.forEach((n,r)=>{e.setAttribute(r,n)}),e),Dr=e=>{const t=Hi();for(let n=0;n<e.length;n++)Ir(t,e[n]);return t},$i=(e,t)=>(Ir(e,Dr(t)),e),ga=e=>e.remove(),Wi=(e,t,n)=>e.addEventListener(t,n),Ki=(e,t,n)=>e.removeEventListener(t,n),pa=(e,t)=>(pair.forEach(t,(n,r)=>Wi(e,n,r)),e),wa=(e,t)=>(pair.forEach(t,(n,r)=>Ki(e,n,r)),e),_a=(e,t=[],n=[])=>$i(Ji(Er(e),t),n),ya=(e,t)=>{const n=Er("canvas");return n.height=t,n.width=e,n},ma=null,Yi=e=>`${e.left}:${e.right};`,ba=e=>e.map(Yi).join(""),Xi=e=>F(e,(t,n)=>`${n}:${t};`).join(""),Sa=(e,t)=>e.querySelector(t),ka=(e,t)=>e.querySelectorAll(t),Ea=e=>Dt.getElementById(e),Cr=e=>Gi.parseFromString(`<html><body>${e}</body></html>`,"text/html").body,Da=e=>Dr(Cr(e).childNodes),Ca=e=>Cr(e).firstElementChild,Ia=(e,t)=>e.replaceWith(t),Aa=(e,t,n)=>e.insertBefore(t,n),Ir=(e,t)=>e.appendChild(t),Ta=Dt.ELEMENT_NODE,Ua=Dt.TEXT_NODE,va=Dt.CDATA_SECTION_NODE,xa=Dt.COMMENT_NODE,Oa=Dt.DOCUMENT_NODE,Ma=Dt.DOCUMENT_TYPE_NODE,Ba=Dt.DOCUMENT_FRAGMENT_NODE,Na=(e,t)=>e.nodeType===t,La=(e,t)=>{let n=t.parentNode;for(;n&&n!==e;)n=n.parentNode;return n===e},Rt=Symbol,Ra=e=>typeof e=="symbol",Va=()=>new Date,Ar=Date.now,Fa=e=>{if(e<6e4){const i=metric.prefix(e,-1);return math.round(i.n*100)/100+i.prefix+"s"}e=math.floor(e/1e3);const t=e%60,n=math.floor(e/60)%60,r=math.floor(e/3600)%24,s=math.floor(e/86400);return s>0?s+"d"+(r>0||n>30?" "+(n>30?r+1:r)+"h":""):r>0?r+"h"+(n>0||t>30?" "+(t>30?n+1:n)+"min":""):n+"min"+(t>0?" "+t+"s":"")},Tr=Rt(),Ur=Rt(),vr=Rt(),Zi=Rt(),xr=Rt(),Or=Rt(),Mr=Rt(),Ln=Rt(),Br=Rt(),qi=e=>{const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];s.constructor===String||s.constructor===Number?t.push(s):s.constructor===Object&&n.push(JSON.stringify(s))}return n},Nr=[xr,Mr,Ln,vr];let Rn=0,Lr=Ar();const Pa=(e,t)=>{const n=Nr[Rn],r=env.getVariable("log"),s=r!==null&&(r==="*"||r==="true"||new RegExp(r,"gi").test(t));return Rn=(Rn+1)%Nr.length,t+=": ",s?(...i)=>{const o=time.getUnixTime(),c=o-Lr;Lr=o,e(n,t,Br,...i.map(a=>typeof a=="string"||typeof a=="symbol"?a:JSON.stringify(a)),n," +"+c+"ms")}:func.nop},Rr={[Tr]:Lt("font-weight","bold"),[Ur]:Lt("font-weight","normal"),[vr]:Lt("color","blue"),[xr]:Lt("color","green"),[Zi]:Lt("color","grey"),[Or]:Lt("color","red"),[Mr]:Lt("color","purple"),[Ln]:Lt("color","orange"),[Br]:Lt("color","black")},tn=ri?e=>{const t=[],n=[],r=U();let s=[],i=0;for(;i<e.length;i++){const o=e[i],c=Rr[o];if(c!==void 0)r.set(c.left,c.right);else if(o.constructor===String||o.constructor===Number){const a=Xi(r);i>0||a.length>0?(t.push("%c"+o),n.push(a)):t.push(o)}else break}for(i>0&&(s=n,s.unshift(t.join("")));i<e.length;i++){const o=e[i];o instanceof Symbol||s.push(o)}return s}:qi,Vr=(...e)=>{console.log(...tn(e)),Ot.forEach(t=>t.print(e))},ja=(...e)=>{console.warn(...tn(e)),e.unshift(common.ORANGE),Ot.forEach(t=>t.print(e))},Ha=e=>{console.error(e),Ot.forEach(t=>t.printError(e))},Fr=(e,t)=>{env.isBrowser&&console.log("%c                      ",`font-size: ${t}px; background-size: contain; background-repeat: no-repeat; background-image: url(${e})`),Ot.forEach(n=>n.printImg(e,t))},Ga=(e,t)=>Fr(`data:image/gif;base64,${e}`,t),Ja=(...e)=>{console.group(...tn(e)),Ot.forEach(t=>t.group(e))},$a=(...e)=>{console.groupCollapsed(...tn(e)),Ot.forEach(t=>t.groupCollapsed(e))},Wa=()=>{console.groupEnd(),Ot.forEach(e=>e.groupEnd())},Ka=e=>Ot.forEach(t=>t.printDom(e())),Ya=(e,t)=>Fr(e.toDataURL(),t),Ot=T(),Pr=e=>{const t=[],n=new Map;let r=0;for(;r<e.length;r++){const s=e[r],i=Rr[s];if(i!==void 0)n.set(i.left,i.right);else if(s.constructor===String||s.constructor===Number){const o=dom.element("span",[pair.create("style",dom.mapToStyleString(n))],[dom.text(s.toString())]);o.innerHTML===""&&(o.innerHTML="&nbsp;"),t.push(o)}else break}for(;r<e.length;r++){let s=e[r];s instanceof Symbol||(s.constructor!==String&&s.constructor!==Number&&(s=" "+json.stringify(s)+" "),t.push(dom.element("span",[],[dom.text(s)])))}return t},zr="font-family:monospace;border-bottom:1px solid #e2e2e2;padding:2px;";class Qi{constructor(t){this.dom=t,this.ccontainer=this.dom,this.depth=0,Ot.add(this)}group(t,n=!1){eventloop.enqueue(()=>{const r=dom.element("span",[pair.create("hidden",n),pair.create("style","color:grey;font-size:120%;")],[dom.text("\u25BC")]),s=dom.element("span",[pair.create("hidden",!n),pair.create("style","color:grey;font-size:125%;")],[dom.text("\u25B6")]),i=dom.element("div",[pair.create("style",`${zr};padding-left:${this.depth*10}px`)],[r,s,dom.text(" ")].concat(Pr(t))),o=dom.element("div",[pair.create("hidden",n)]),c=dom.element("div",[],[i,o]);dom.append(this.ccontainer,[c]),this.ccontainer=o,this.depth++,dom.addEventListener(i,"click",a=>{o.toggleAttribute("hidden"),r.toggleAttribute("hidden"),s.toggleAttribute("hidden")})})}groupCollapsed(t){this.group(t,!0)}groupEnd(){eventloop.enqueue(()=>{this.depth>0&&(this.depth--,this.ccontainer=this.ccontainer.parentElement.parentElement)})}print(t){eventloop.enqueue(()=>{dom.append(this.ccontainer,[dom.element("div",[pair.create("style",`${zr};padding-left:${this.depth*10}px`)],Pr(t))])})}printError(t){this.print([common.RED,common.BOLD,t.toString()])}printImg(t,n){eventloop.enqueue(()=>{dom.append(this.ccontainer,[dom.element("img",[pair.create("src",t),pair.create("height",`${math.round(n*1.5)}px`)])])})}printDom(t){eventloop.enqueue(()=>{dom.append(this.ccontainer,[t])})}destroy(){eventloop.enqueue(()=>{Ot.delete(this)})}}const Xa=e=>new Qi(e),Za=e=>common.createModuleLogger(Vr,e),qa=(e,t)=>({[Symbol.iterator](){return this},next(){const n=e.next();return{value:n.done?void 0:t(n.value),done:n.done}}}),jr=e=>({[Symbol.iterator](){return this},next:e}),to=(e,t)=>jr(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Vn=(e,t)=>jr(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}}),Qa=()=>Object.create(null),eo=Object.assign,no=Object.keys,ro=(e,t)=>{for(const n in e)t(e[n],n)},tu=(e,t)=>{const n=[];for(const r in e)n.push(t(e[r],r));return n},Hr=e=>no(e).length,eu=(e,t)=>{for(const n in e)if(t(e[n],n))return!0;return!1},so=e=>{for(const t in e)return!1;return!0},io=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},oo=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),co=(e,t)=>e===t||Hr(e)===Hr(t)&&io(e,(n,r)=>(n!==void 0||oo(t,r))&&t[r]===n);class nu extends null{constructor(t,n){super(),this.doc=t,this.awareness=n}}class Fn{constructor(t,n){this.clock=t,this.len=n}}class le{constructor(){this.clients=new Map}}const ae=(e,t,n)=>t.clients.forEach((r,s)=>{const i=e.doc.store.clients.get(s);for(let o=0;o<r.length;o++){const c=r[o];ls(e,i,c.clock,c.len,n)}}),lo=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=gt((n+r)/2),i=e[s],o=i.clock;if(o<=t){if(t<o+i.len)return s;n=s+1}else r=s-1}return null},ue=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&lo(n,t.clock)!==null},Pn=e=>{e.clients.forEach(t=>{t.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<t.length;n++){const s=t[r-1],i=t[n];s.clock+s.len>=i.clock?s.len=Et(s.len,i.clock+i.len-s.clock):(r<n&&(t[r]=i),r++)}t.length=r})},he=e=>{const t=new le;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){const i=r.slice();for(let o=n+1;o<e.length;o++)Wt(i,e[o].clients.get(s)||[]);t.clients.set(s,i)}});return Pn(t),t},Oe=(e,t,n,r)=>{k(e.clients,t,()=>[]).push(new Fn(n,r))},zn=()=>new le,Gr=e=>{const t=zn();return e.clients.forEach((n,r)=>{const s=[];for(let i=0;i<n.length;i++){const o=n[i];if(o.deleted){const c=o.id.clock;let a=o.length;if(i+1<n.length)for(let d=n[i+1];i+1<n.length&&d.deleted;d=n[++i+1])a+=d.length;s.push(new Fn(c,a))}}s.length>0&&t.clients.set(r,s)}),t},Mt=(e,t)=>{j(e.restEncoder,t.clients.size),kt(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),j(e.restEncoder,n);const s=r.length;j(e.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Vt=e=>{const t=new le,n=decoding.readVarUint(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const s=decoding.readVarUint(e.restDecoder),i=decoding.readVarUint(e.restDecoder);if(i>0){const o=map.setIfUndefined(t.clients,s,()=>[]);for(let c=0;c<i;c++)o.push(new Fn(e.readDsClock(),e.readDsLen()))}}return t},Jr=(e,t,n)=>{const r=new le,s=decoding.readVarUint(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();const o=decoding.readVarUint(e.restDecoder),c=decoding.readVarUint(e.restDecoder),a=n.clients.get(o)||[],d=tt(n,o);for(let u=0;u<c;u++){const g=e.readDsClock(),p=g+e.readDsLen();if(g<d){d<p&&Oe(r,o,d,p-d);let _=It(a,g),S=a[_];for(!S.deleted&&S.id.clock<g&&(a.splice(_+1,0,yn(t,S,g-S.id.clock)),_++);_<a.length&&(S=a[_++],S.id.clock<p);)S.deleted||(p<S.id.clock+S.length&&a.splice(_,0,yn(t,S,p-S.id.clock)),S.delete(t))}else Oe(r,o,g,p-g)}}if(r.clients.size>0){const i=new Bt;return encoding.writeVarUint(i.restEncoder,0),Mt(i,r),i.toUint8Array()}return null},ao=(e,t)=>{if(e.clients.size!==t.clients.size)return!1;for(const[n,r]of e.clients.entries()){const s=t.clients.get(n);if(s===void 0||r.length!==s.length)return!1;for(let i=0;i<r.length;i++){const o=r[i],c=s[i];if(o.clock!==c.clock||o.len!==c.len)return!1}}return!0},$r=Sr;class Xt extends Ee{constructor({guid:t=ji(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:c=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=$r(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new is,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Qe(d=>{this.on("load",()=>{this.isLoaded=!0,d(this)})});const a=()=>Qe(d=>{const u=g=>{(g===void 0||g===!0)&&(this.off("sync",u),d())};this.on("sync",u)});this.on("sync",d=>{d===!1&&this.isSynced&&(this.whenSynced=a()),this.isSynced=d===void 0||d===!0,this.isLoaded||this.emit("load",[])}),this.whenSynced=a()}load(){const t=this._item;t!==null&&!this.shouldLoad&&G(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(kt(this.subdocs).map(t=>t.guid))}transact(t,n=null){return G(this,t,n)}get(t,n=ot){const r=k(this.share,t,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==ot&&s!==n)if(s===ot){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Ht)}getText(t=""){return this.get(t,we)}getMap(t=""){return this.get(t,Qt)}getXmlFragment(t=""){return this.get(t,te)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){kt(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Xt(sr(mn({guid:this.guid},n.opts),{shouldLoad:!1})),n.doc._item=t,G(t.parent.doc,r=>{const s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,n){super.on(t,n)}off(t,n){super.off(t,n)}}class en{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return decoding.readVarUint(this.restDecoder)}readDsLen(){return decoding.readVarUint(this.restDecoder)}}class Ct extends null{readLeftID(){return v(decoding.readVarUint(this.restDecoder),decoding.readVarUint(this.restDecoder))}readRightID(){return v(decoding.readVarUint(this.restDecoder),decoding.readVarUint(this.restDecoder))}readClient(){return decoding.readVarUint(this.restDecoder)}readInfo(){return decoding.readUint8(this.restDecoder)}readString(){return decoding.readVarString(this.restDecoder)}readParentInfo(){return decoding.readVarUint(this.restDecoder)===1}readTypeRef(){return decoding.readVarUint(this.restDecoder)}readLen(){return decoding.readVarUint(this.restDecoder)}readAny(){return decoding.readAny(this.restDecoder)}readBuf(){return buffer.copyUint8Array(decoding.readVarUint8Array(this.restDecoder))}readJSON(){return JSON.parse(decoding.readVarString(this.restDecoder))}readKey(){return decoding.readVarString(this.restDecoder)}}class uo{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=decoding.readVarUint(this.restDecoder),this.dsCurrVal}readDsLen(){const t=decoding.readVarUint(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class bt extends null{constructor(t){super(t),this.keys=[],decoding.readVarUint(t),this.keyClockDecoder=new decoding.IntDiffOptRleDecoder(decoding.readVarUint8Array(t)),this.clientDecoder=new decoding.UintOptRleDecoder(decoding.readVarUint8Array(t)),this.leftClockDecoder=new decoding.IntDiffOptRleDecoder(decoding.readVarUint8Array(t)),this.rightClockDecoder=new decoding.IntDiffOptRleDecoder(decoding.readVarUint8Array(t)),this.infoDecoder=new decoding.RleDecoder(decoding.readVarUint8Array(t),decoding.readUint8),this.stringDecoder=new decoding.StringDecoder(decoding.readVarUint8Array(t)),this.parentInfoDecoder=new decoding.RleDecoder(decoding.readVarUint8Array(t),decoding.readUint8),this.typeRefDecoder=new decoding.UintOptRleDecoder(decoding.readVarUint8Array(t)),this.lenDecoder=new decoding.UintOptRleDecoder(decoding.readVarUint8Array(t))}readLeftID(){return new fe(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new fe(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return decoding.readAny(this.restDecoder)}readBuf(){return decoding.readVarUint8Array(this.restDecoder)}readJSON(){return decoding.readAny(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class de{constructor(){this.restEncoder=Ke()}toUint8Array(){return mt(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){j(this.restEncoder,t)}writeDsLen(t){j(this.restEncoder,t)}}class Zt extends de{writeLeftID(t){j(this.restEncoder,t.client),j(this.restEncoder,t.clock)}writeRightID(t){j(this.restEncoder,t.client),j(this.restEncoder,t.clock)}writeClient(t){j(this.restEncoder,t)}writeInfo(t){Mn(this.restEncoder,t)}writeString(t){oe(this.restEncoder,t)}writeParentInfo(t){j(this.restEncoder,t?1:0)}writeTypeRef(t){j(this.restEncoder,t)}writeLen(t){j(this.restEncoder,t)}writeAny(t){xe(this.restEncoder,t)}writeBuf(t){wt(this.restEncoder,t)}writeJSON(t){oe(this.restEncoder,JSON.stringify(t))}writeKey(t){oe(this.restEncoder,t)}}class nn{constructor(){this.restEncoder=Ke(),this.dsCurrVal=0}toUint8Array(){return mt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,j(this.restEncoder,n)}writeDsLen(t){t===0&&Nt(),j(this.restEncoder,t-1),this.dsCurrVal+=t}}class Bt extends nn{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Nn,this.clientEncoder=new qe,this.leftClockEncoder=new Nn,this.rightClockEncoder=new Nn,this.infoEncoder=new mr(Mn),this.stringEncoder=new Vi,this.parentInfoEncoder=new mr(Mn),this.typeRefEncoder=new qe,this.lenEncoder=new qe}toUint8Array(){const t=Ke();return j(t,0),wt(t,this.keyClockEncoder.toUint8Array()),wt(t,this.clientEncoder.toUint8Array()),wt(t,this.leftClockEncoder.toUint8Array()),wt(t,this.rightClockEncoder.toUint8Array()),wt(t,mt(this.infoEncoder)),wt(t,this.stringEncoder.toUint8Array()),wt(t,mt(this.parentInfoEncoder)),wt(t,this.typeRefEncoder.toUint8Array()),wt(t,this.lenEncoder.toUint8Array()),Ye(t,mt(this.restEncoder)),mt(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){xe(this.restEncoder,t)}writeBuf(t){wt(this.restEncoder,t)}writeJSON(t){xe(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const ho=(e,t,n,r)=>{r=Et(r,t[0].id.clock);const s=It(t,r);j(e.restEncoder,t.length-s),e.writeClient(n),j(e.restEncoder,r);const i=t[s];i.write(e,r-i.id.clock);for(let o=s+1;o<t.length;o++)t[o].write(e,0)},jn=(e,t,n)=>{const r=new Map;n.forEach((s,i)=>{tt(t,i)>s&&r.set(i,s)}),Me(t).forEach((s,i)=>{n.has(i)||r.set(i,0)}),j(e.restEncoder,r.size),kt(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{ho(e,t.clients.get(s),s,i)})},fo=(e,t)=>{const n=map.create(),r=decoding.readVarUint(e.restDecoder);for(let s=0;s<r;s++){const i=decoding.readVarUint(e.restDecoder),o=new Array(i),c=e.readClient();let a=decoding.readVarUint(e.restDecoder);n.set(c,{i:0,refs:o});for(let d=0;d<i;d++){const u=e.readInfo();switch(binary.BITS5&u){case 0:{const g=e.readLen();o[d]=new _t(v(c,a),g),a+=g;break}case 10:{const g=decoding.readVarUint(e.restDecoder);o[d]=new ft(v(c,a),g),a+=g;break}default:{const g=(u&(binary.BIT7|binary.BIT8))===0,p=new H(v(c,a),null,(u&binary.BIT8)===binary.BIT8?e.readLeftID():null,null,(u&binary.BIT7)===binary.BIT7?e.readRightID():null,g?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,g&&(u&binary.BIT6)===binary.BIT6?e.readString():null,js(e,u));o[d]=p,a+=p.length}}}}return n},go=(e,t,n)=>{const r=[];let s=array.from(n.keys()).sort((_,S)=>_-S);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let _=n.get(s[s.length-1]);for(;_.refs.length===_.i;)if(s.pop(),s.length>0)_=n.get(s[s.length-1]);else return null;return _};let o=i();if(o===null&&r.length===0)return null;const c=new is,a=new Map,d=(_,S)=>{const M=a.get(_);(M==null||M>S)&&a.set(_,S)};let u=o.refs[o.i++];const g=new Map,p=()=>{for(const _ of r){const S=_.id.client,M=n.get(S);M?(M.i--,c.clients.set(S,M.refs.slice(M.i)),n.delete(S),M.i=0,M.refs=[]):c.clients.set(S,[_]),s=s.filter(Q=>Q!==S)}r.length=0};for(;;){if(u.constructor!==ft){const S=map.setIfUndefined(g,u.id.client,()=>tt(t,u.id.client))-u.id.clock;if(S<0)r.push(u),d(u.id.client,u.id.clock-1),p();else{const M=u.getMissing(e,t);if(M!==null){r.push(u);const Q=n.get(M)||{refs:[],i:0};if(Q.refs.length===Q.i)d(M,tt(t,M)),p();else{u=Q.refs[Q.i++];continue}}else(S===0||S<u.length)&&(u.integrate(e,S),g.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=i(),o===null)break;u=o.refs[o.i++]}}if(c.clients.size>0){const _=new Bt;return jn(_,c,new Map),encoding.writeVarUint(_.restEncoder,0),{missing:a,update:_.toUint8Array()}}return null},po=(e,t)=>jn(e,t.doc.store,t.beforeState),Wr=(e,t,n,r=new bt(e))=>G(t,s=>{s.local=!1;let i=!1;const o=s.doc,c=o.store,a=fo(r,o),d=go(s,c,a),u=c.pendingStructs;if(u){for(const[p,_]of u.missing)if(_<tt(c,p)){i=!0;break}if(d){for(const[p,_]of d.missing){const S=u.missing.get(p);(S==null||S>_)&&u.missing.set(p,_)}u.update=ln([u.update,d.update])}}else c.pendingStructs=d;const g=Jr(r,s,c);if(c.pendingDs){const p=new bt(decoding.createDecoder(c.pendingDs));decoding.readVarUint(p.restDecoder);const _=Jr(p,s,c);g&&_?c.pendingDs=ln([g,_]):c.pendingDs=g||_}else c.pendingDs=g;if(i){const p=c.pendingStructs.update;c.pendingStructs=null,Hn(s.doc,p)}},n,!1),ru=(e,t,n)=>Wr(e,t,n,new Ct(e)),Hn=(e,t,n,r=bt)=>{const s=decoding.createDecoder(t);Wr(s,e,n,new r(s))},su=(e,t,n)=>Hn(e,t,n,Ct),wo=(e,t,n=new Map)=>{jn(e,t.store,n),Mt(e,Gr(t.store))},_o=(e,t=new Uint8Array([0]),n=new Bt)=>{const r=Yr(t);wo(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(ws(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Zt)return No(s.map((i,o)=>o===0?i:Fo(i)));if(n.constructor===Bt)return ln(s)}return s[0]},iu=(e,t)=>_o(e,t,new Zt),Kr=e=>{const t=new Map,n=decoding.readVarUint(e.restDecoder);for(let r=0;r<n;r++){const s=decoding.readVarUint(e.restDecoder),i=decoding.readVarUint(e.restDecoder);t.set(s,i)}return t},Yr=e=>Kr(new en(decoding.createDecoder(e))),Gn=(e,t)=>(encoding.writeVarUint(e.restEncoder,t.size),array.from(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{encoding.writeVarUint(e.restEncoder,n),encoding.writeVarUint(e.restEncoder,r)}),e),yo=(e,t)=>Gn(e,Me(t.store)),mo=(e,t=new nn)=>(e instanceof Map?Gn(t,e):yo(t,e),t.toUint8Array()),ou=e=>mo(e,new de);class bo{constructor(){this.l=[]}}const Xr=()=>new bo,Zr=(e,t)=>e.l.push(t),qr=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Qr=(e,t,n)=>O(e.l,[t,n]);class fe{constructor(t,n){this.client=t,this.clock=n}}const ge=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,v=(e,t)=>new fe(e,t),ts=(e,t)=>{encoding.writeVarUint(e,t.client),encoding.writeVarUint(e,t.clock)},es=e=>v(decoding.readVarUint(e),decoding.readVarUint(e)),ns=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Nt()},rn=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1},cu=e=>{const t=[];let n=e._start;for(;n;)t.push(n),n=n.right;console.log("Children: ",t),console.log("Children content: ",t.filter(r=>!r.deleted).map(r=>r.content))};class lu{constructor(t,n=t.getMap("users")){const r=new Map;this.yusers=n,this.doc=t,this.clients=new Map,this.dss=r;const s=(i,o)=>{const c=i.get("ds"),a=i.get("ids"),d=u=>this.clients.set(u,o);c.observe(u=>{u.changes.added.forEach(g=>{g.content.getContent().forEach(p=>{p instanceof Uint8Array&&this.dss.set(o,he([this.dss.get(o)||zn(),Vt(new en(decoding.createDecoder(p)))]))})})}),this.dss.set(o,he(c.map(u=>Vt(new en(decoding.createDecoder(u)))))),a.observe(u=>u.changes.added.forEach(g=>g.content.getContent().forEach(d))),a.forEach(d)};n.observe(i=>{i.keysChanged.forEach(o=>s(n.get(o),o))}),n.forEach(s)}setUserMapping(t,n,r,{filter:s=()=>!0}={}){const i=this.yusers;let o=i.get(r);o||(o=new Qt,o.set("ids",new Ht),o.set("ds",new Ht),i.set(r,o)),o.get("ids").push([n]),i.observe(c=>{setTimeout(()=>{const a=i.get(r);if(a!==o){o=a,this.clients.forEach((g,p)=>{r===g&&o.get("ids").push([p])});const d=new de,u=this.dss.get(r);u&&(Mt(d,u),o.get("ds").push([d.toUint8Array()]))}},0)}),t.on("afterTransaction",c=>{setTimeout(()=>{const a=o.get("ds"),d=c.deleteSet;if(c.local&&d.clients.size>0&&s(c,d)){const u=new de;Mt(u,d),a.push([u.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(const[n,r]of this.dss.entries())if(ue(r,t))return n;return null}}class Jn{constructor(t,n,r,s=0){this.type=t,this.tname=n,this.item=r,this.assoc=s}}const au=e=>{const t={};return e.type&&(t.type=e.type),e.tname&&(t.tname=e.tname),e.item&&(t.item=e.item),e.assoc!=null&&(t.assoc=e.assoc),t},uu=e=>new Jn(e.type==null?null:v(e.type.client,e.type.clock),e.tname||null,e.item==null?null:v(e.item.client,e.item.clock),e.assoc==null?0:e.assoc);class So{constructor(t,n,r=0){this.type=t,this.index=n,this.assoc=r}}const ko=(e,t,n=0)=>new So(e,t,n),sn=(e,t,n)=>{let r=null,s=null;return e._item===null?s=ns(e):r=v(e._item.id.client,e._item.id.clock),new Jn(r,s,t,n)},hu=(e,t,n=0)=>{let r=e._start;if(n<0){if(t===0)return sn(e,null,n);t--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return sn(e,v(r.id.client,r.id.clock+t),n);t-=r.length}if(r.right===null&&n<0)return sn(e,r.lastId,n);r=r.right}return sn(e,null,n)},Eo=(e,t)=>{const{type:n,tname:r,item:s,assoc:i}=t;if(s!==null)encoding.writeVarUint(e,0),ts(e,s);else if(r!==null)encoding.writeUint8(e,1),encoding.writeVarString(e,r);else if(n!==null)encoding.writeUint8(e,2),ts(e,n);else throw error.unexpectedCase();return encoding.writeVarInt(e,i),e},du=e=>{const t=encoding.createEncoder();return Eo(t,e),encoding.toUint8Array(t)},Do=e=>{let t=null,n=null,r=null;switch(decoding.readVarUint(e)){case 0:r=es(e);break;case 1:n=decoding.readVarString(e);break;case 2:t=es(e)}const s=decoding.hasContent(e)?decoding.readVarInt(e):0;return new Jn(t,n,r,s)},fu=e=>Do(decoding.createDecoder(e)),gu=(e,t)=>{const n=t.store,r=e.item,s=e.type,i=e.tname,o=e.assoc;let c=null,a=0;if(r!==null){if(tt(n,r.client)<=r.clock)return null;const d=nr(n,r),u=d.item;if(!(u instanceof H))return null;if(c=u.parent,c._item===null||!c._item.deleted){a=u.deleted||!u.countable?0:d.diff+(o>=0?0:1);let g=u.left;for(;g!==null;)!g.deleted&&g.countable&&(a+=g.length),g=g.left}}else{if(i!==null)c=t.get(i);else if(s!==null){if(tt(n,s.client)<=s.clock)return null;const{item:d}=nr(n,s);if(d instanceof H&&d.content instanceof Tt)c=d.content.type;else return null}else throw error.unexpectedCase();o>=0?a=c._length:a=0}return ko(c,a,e.assoc)},pu=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&ge(e.item,t.item)&&ge(e.type,t.type)&&e.assoc===t.assoc;class rs{constructor(t,n){this.ds=t,this.sv=n}}const wu=(e,t)=>{const n=e.ds.clients,r=t.ds.clients,s=e.sv,i=t.sv;if(s.size!==i.size||n.size!==r.size)return!1;for(const[o,c]of s.entries())if(i.get(o)!==c)return!1;for(const[o,c]of n.entries()){const a=r.get(o)||[];if(c.length!==a.length)return!1;for(let d=0;d<c.length;d++){const u=c[d],g=a[d];if(u.clock!==g.clock||u.len!==g.len)return!1}}return!0},Co=(e,t=new nn)=>(Mt(t,e.ds),Gn(t,e.sv),t.toUint8Array()),_u=e=>Co(e,new de),Io=(e,t=new uo(decoding.createDecoder(e)))=>new rs(Vt(t),Kr(t)),yu=e=>Io(e,new en(decoding.createDecoder(e))),ss=(e,t)=>new rs(e,t),mu=ss(zn(),new Map),bu=e=>ss(Gr(e.store),Me(e.store)),qt=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!ue(t.ds,e.id),$n=(e,t)=>{const n=k(e.meta,$n,T),r=e.doc.store;n.has(t)||(t.sv.forEach((s,i)=>{s<tt(r,i)&&ht(e,v(i,s))}),ae(e,t.ds,s=>{}),n.add(t))},Su=(e,t,n=new Xt)=>{if(e.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");const{sv:r,ds:s}=t,i=new Bt;return e.transact(o=>{let c=0;r.forEach(a=>{a>0&&c++}),encoding.writeVarUint(i.restEncoder,c);for(const[a,d]of r){if(d===0)continue;d<tt(e.store,a)&&ht(o,v(a,d));const u=e.store.clients.get(a)||[],g=It(u,d-1);encoding.writeVarUint(i.restEncoder,g+1),i.writeClient(a),encoding.writeVarUint(i.restEncoder,0);for(let p=0;p<=g;p++)u[p].write(i,0)}Mt(i,s)}),Hn(n,i.toUint8Array(),"snapshot"),n},Ao=(e,t,n=bt)=>{const r=new n(decoding.createDecoder(t)),s=new zt(r,!1);for(let o=s.curr;o!==null;o=s.next())if((e.sv.get(o.id.client)||0)<o.id.clock+o.length)return!1;const i=he([e.ds,Vt(r)]);return ao(e.ds,i)},ku=(e,t)=>Ao(e,t,Ct);class is{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Me=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},tt=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},os=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Nt()}n.push(t)},It=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let o=gt(t/(i+s.length-1)*r);for(;n<=r;){if(s=e[o],i=s.id.clock,i<=t){if(t<i+s.length)return o;n=o+1}else r=o-1;o=gt((n+r)/2)}throw Nt()},on=(e,t)=>{const n=e.clients.get(t.client);return n[It(n,t.clock)]},Wn=(e,t,n)=>{const r=It(t,n),s=t[r];return s.id.clock<n&&s instanceof H?(t.splice(r+1,0,yn(e,s,n-s.id.clock)),r+1):r},ht=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Wn(e,n,t.clock)]},cs=(e,t,n)=>{const r=t.clients.get(n.client),s=It(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==_t&&r.splice(s+1,0,yn(e,i,n.clock-i.id.clock+1)),i},To=(e,t,n)=>{const r=e.clients.get(t.id.client);r[It(r,t.id.clock)]=n},ls=(e,t,n,r,s)=>{if(r===0)return;const i=n+r;let o=Wn(e,t,n),c;do c=t[o++],i<c.id.clock+c.length&&Wn(e,t,i),s(c);while(o<t.length&&t[o].id.clock<i)};class Uo{constructor(t,n,r){this.doc=t,this.deleteSet=new le,this.beforeState=Me(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const as=(e,t)=>t.deleteSet.clients.size===0&&!C(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Pn(t.deleteSet),po(e,t),Mt(e,t.deleteSet),!0),us=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&k(e.changed,t,T).add(n)},cn=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof H&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=t-s;return i&&e.splice(t+1-i,i),i},hs=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const i=t.clients.get(r);for(let o=s.length-1;o>=0;o--){const c=s[o],a=c.clock+c.len;for(let d=It(i,c.clock),u=i[d];d<i.length&&u.id.clock<a;u=i[++d]){const g=i[d];if(c.clock+c.len<=g.id.clock)break;g instanceof H&&g.deleted&&!g.keep&&n(g)&&g.gc(t,!1)}}}},ds=(e,t)=>{e.clients.forEach((n,r)=>{const s=t.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],c=Ie(s.length-1,1+It(s,o.clock+o.len-1));for(let a=c,d=s[a];a>0&&d.id.clock>=o.clock;d=s[a])a-=1+cn(s,a)}})},Du=(e,t,n)=>{hs(e,t,n),ds(e,t)},fs=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{Pn(i),n.afterState=Me(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const c=[];n.changed.forEach((a,d)=>c.push(()=>{(d._item===null||!d._item.deleted)&&d._callObserver(n,a)})),c.push(()=>{n.changedParentTypes.forEach((a,d)=>{d._dEH.l.length>0&&(d._item===null||!d._item.deleted)&&(a=a.filter(u=>u.target._item===null||!u.target._item.deleted),a.forEach(u=>{u.currentTarget=d,u._path=null}),a.sort((u,g)=>u.path.length-g.path.length),Qr(d._dEH,a,n))})}),c.push(()=>r.emit("afterTransaction",[n,r])),O(c,[]),n._needFormattingCleanup&&qo(n)}finally{r.gc&&hs(i,s,r.gcFilter),ds(i,s),n.afterState.forEach((u,g)=>{const p=n.beforeState.get(g)||0;if(p!==u){const _=s.clients.get(g),S=Et(It(_,p),1);for(let M=_.length-1;M>=S;)M-=1+cn(_,M)}});for(let u=o.length-1;u>=0;u--){const{client:g,clock:p}=o[u].id,_=s.clients.get(g),S=It(_,p);S+1<_.length&&cn(_,S+1)>1||S>0&&cn(_,S)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Vr(Ln,Tr,"[yjs] ",Ur,Or,"Changed the client-id because another client seems to be using it."),r.clientID=$r()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Zt;as(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Bt;as(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:c,subdocsLoaded:a,subdocsRemoved:d}=n;(c.size>0||d.size>0||a.size>0)&&(c.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),d.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:a,added:c,removed:d},r,n]),d.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):fs(e,t+1)}}},G=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let i=!1,o=null;e._transaction===null&&(i=!0,e._transaction=new Uo(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){const c=e._transaction===s[0];e._transaction=null,c&&fs(s,0)}}return o};class vo{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}}const gs=(e,t,n)=>{ae(e,n.deletions,r=>{r instanceof H&&t.scope.some(s=>rn(s,r))&&rr(r,!1)})},ps=(e,t,n)=>{let r=null,s=null;const i=e.doc,o=e.scope;if(G(i,c=>{for(;t.length>0&&r===null;){const a=i.store,d=t.pop(),u=new Set,g=[];let p=!1;ae(c,d.insertions,_=>{if(_ instanceof H){if(_.redone!==null){let{item:S,diff:M}=nr(a,_.id);M>0&&(S=ht(c,v(S.id.client,S.id.clock+M))),_=S}!_.deleted&&o.some(S=>rn(S,_))&&g.push(_)}}),ae(c,d.deletions,_=>{_ instanceof H&&o.some(S=>rn(S,_))&&!ue(d.insertions,_.id)&&u.add(_)}),u.forEach(_=>{p=zs(c,_,u,d.insertions,e.ignoreRemoteMapChanges,e)!==null||p});for(let _=g.length-1;_>=0;_--){const S=g[_];e.deleteFilter(S)&&(S.delete(c),p=!0)}r=p?d:null}c.changed.forEach((a,d)=>{a.has(null)&&d._searchMarker&&(d._searchMarker.length=0)}),s=c},e),r!=null){const c=s.changedParentTypes;e.emit("stack-item-popped",[{stackItem:r,type:n,changedParentTypes:c},e])}return r};class xo extends Ee{constructor(t,{captureTimeout:n=500,captureTransaction:r=a=>!0,deleteFilter:s=()=>!0,trackedOrigins:i=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:c=Ft(t)?t[0].doc:t.doc}={}){super(),this.scope=[],this.addToScope(t),this.deleteFilter=s,i.add(this),this.trackedOrigins=i,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=c,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=n,this.afterTransactionHandler=a=>{if(!this.captureTransaction(a)||!this.scope.some(Q=>a.changedParentTypes.has(Q))||!this.trackedOrigins.has(a.origin)&&(!a.origin||!this.trackedOrigins.has(a.origin.constructor)))return;const d=this.undoing,u=this.redoing,g=d?this.redoStack:this.undoStack;d?this.stopCapturing():u||this.clear(!1,!0);const p=new le;a.afterState.forEach((Q,et)=>{const Js=a.beforeState.get(et)||0,$s=Q-Js;$s>0&&Oe(p,et,Js,$s)});const _=Ar();let S=!1;if(this.lastChange>0&&_-this.lastChange<this.captureTimeout&&g.length>0&&!d&&!u){const Q=g[g.length-1];Q.deletions=he([Q.deletions,a.deleteSet]),Q.insertions=he([Q.insertions,p])}else g.push(new vo(a.deleteSet,p)),S=!0;!d&&!u&&(this.lastChange=_),ae(a,a.deleteSet,Q=>{Q instanceof H&&this.scope.some(et=>rn(et,Q))&&rr(Q,!0)});const M=[{stackItem:g[g.length-1],origin:a.origin,type:d?"redo":"undo",changedParentTypes:a.changedParentTypes},this];S?this.emit("stack-item-added",M):this.emit("stack-item-updated",M)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=Ft(t)?t:[t],t.forEach(n=>{this.scope.every(r=>r!==n)&&this.scope.push(n)})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{t&&(this.undoStack.forEach(s=>gs(r,this,s)),this.undoStack=[]),n&&(this.redoStack.forEach(s=>gs(r,this,s)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=ps(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=ps(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*Oo(e){const t=decoding.readVarUint(e.restDecoder);for(let n=0;n<t;n++){const r=decoding.readVarUint(e.restDecoder),s=e.readClient();let i=decoding.readVarUint(e.restDecoder);for(let o=0;o<r;o++){const c=e.readInfo();if(c===10){const a=decoding.readVarUint(e.restDecoder);yield new ft(v(s,i),a),i+=a}else if(binary.BITS5&c){const a=(c&(binary.BIT7|binary.BIT8))===0,d=new H(v(s,i),null,(c&binary.BIT8)===binary.BIT8?e.readLeftID():null,null,(c&binary.BIT7)===binary.BIT7?e.readRightID():null,a?e.readParentInfo()?e.readString():e.readLeftID():null,a&&(c&binary.BIT6)===binary.BIT6?e.readString():null,js(e,c));yield d,i+=d.length}else{const a=e.readLen();yield new _t(v(s,i),a),i+=a}}}}class zt{constructor(t,n){this.gen=Oo(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ft);return this.curr}}const Cu=e=>Mo(e,Ct),Mo=(e,t=bt)=>{const n=[],r=new t(decoding.createDecoder(e)),s=new zt(r,!1);for(let o=s.curr;o!==null;o=s.next())n.push(o);logging.print("Structs: ",n);const i=Vt(r);logging.print("DeleteSet: ",i)},Iu=e=>Bo(e,Ct),Bo=(e,t=bt)=>{const n=[],r=new t(decoding.createDecoder(e)),s=new zt(r,!1);for(let i=s.curr;i!==null;i=s.next())n.push(i);return{structs:n,ds:Vt(r)}};class Kn{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const No=e=>ln(e,Ct,Zt),Lo=(e,t=nn,n=bt)=>{const r=new t,s=new zt(new n(decoding.createDecoder(e)),!1);let i=s.curr;if(i!==null){let o=0,c=i.id.client,a=i.id.clock!==0,d=a?0:i.id.clock+i.length;for(;i!==null;i=s.next())c!==i.id.client&&(d!==0&&(o++,encoding.writeVarUint(r.restEncoder,c),encoding.writeVarUint(r.restEncoder,d)),c=i.id.client,d=0,a=i.id.clock!==0),i.constructor===ft&&(a=!0),a||(d=i.id.clock+i.length);d!==0&&(o++,encoding.writeVarUint(r.restEncoder,c),encoding.writeVarUint(r.restEncoder,d));const u=encoding.createEncoder();return encoding.writeVarUint(u,o),encoding.writeBinaryEncoder(u,r.restEncoder),r.restEncoder=u,r.toUint8Array()}else return encoding.writeVarUint(r.restEncoder,0),r.toUint8Array()},Au=e=>Lo(e,de,Ct),Ro=(e,t=bt)=>{const n=new Map,r=new Map,s=new zt(new t(decoding.createDecoder(e)),!1);let i=s.curr;if(i!==null){let o=i.id.client,c=i.id.clock;for(n.set(o,c);i!==null;i=s.next())o!==i.id.client&&(r.set(o,c),n.set(i.id.client,i.id.clock),o=i.id.client),c=i.id.clock+i.length;r.set(o,c)}return{from:n,to:r}},Tu=e=>Ro(e,Ct),Vo=(e,t)=>{if(e.constructor===_t){const{client:n,clock:r}=e.id;return new _t(v(n,r+t),e.length-t)}else if(e.constructor===ft){const{client:n,clock:r}=e.id;return new ft(v(n,r+t),e.length-t)}else{const n=e,{client:r,clock:s}=n.id;return new H(v(r,s+t),null,v(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},ln=(e,t=bt,n=Bt)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(decoding.createDecoder(u)));let s=r.map(u=>new zt(u,!0)),i=null;const o=new n,c=new Kn(o);for(;s=s.filter(p=>p.curr!==null),s.sort((p,_)=>{if(p.curr.id.client===_.curr.id.client){const S=p.curr.id.clock-_.curr.id.clock;return S===0?p.curr.constructor===_.curr.constructor?0:p.curr.constructor===ft?1:-1:S}else return _.curr.id.client-p.curr.id.client}),s.length!==0;){const u=s[0],g=u.curr.id.client;if(i!==null){let p=u.curr,_=!1;for(;p!==null&&p.id.clock+p.length<=i.struct.id.clock+i.struct.length&&p.id.client>=i.struct.id.client;)p=u.next(),_=!0;if(p===null||p.id.client!==g||_&&p.id.clock>i.struct.id.clock+i.struct.length)continue;if(g!==i.struct.id.client)jt(c,i.struct,i.offset),i={struct:p,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<p.id.clock)if(i.struct.constructor===ft)i.struct.length=p.id.clock+p.length-i.struct.id.clock;else{jt(c,i.struct,i.offset);const S=p.id.clock-i.struct.id.clock-i.struct.length;i={struct:new ft(v(g,i.struct.id.clock+i.struct.length),S),offset:0}}else{const S=i.struct.id.clock+i.struct.length-p.id.clock;S>0&&(i.struct.constructor===ft?i.struct.length-=S:p=Vo(p,S)),i.struct.mergeWith(p)||(jt(c,i.struct,i.offset),i={struct:p,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let p=u.curr;p!==null&&p.id.client===g&&p.id.clock===i.struct.id.clock+i.struct.length&&p.constructor!==ft;p=u.next())jt(c,i.struct,i.offset),i={struct:p,offset:0}}i!==null&&(jt(c,i.struct,i.offset),i=null),Yn(c);const a=r.map(u=>Vt(u)),d=he(a);return Mt(o,d),o.toUint8Array()},ws=(e,t,n=bt,r=Bt)=>{const s=Yr(t),i=new r,o=new Kn(i),c=new n(decoding.createDecoder(e)),a=new zt(c,!1);for(;a.curr;){const u=a.curr,g=u.id.client,p=s.get(g)||0;if(a.curr.constructor===ft){a.next();continue}if(u.id.clock+u.length>p)for(jt(o,u,math.max(p-u.id.clock,0)),a.next();a.curr&&a.curr.id.client===g;)jt(o,a.curr,0),a.next();else for(;a.curr&&a.curr.id.client===g&&a.curr.id.clock+a.curr.length<=p;)a.next()}Yn(o);const d=Vt(c);return Mt(i,d),i.toUint8Array()},Uu=(e,t)=>ws(e,t,Ct,Zt),_s=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:encoding.toUint8Array(e.encoder.restEncoder)}),e.encoder.restEncoder=encoding.createEncoder(),e.written=0)},jt=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&_s(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),encoding.writeVarUint(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Yn=e=>{_s(e);const t=e.encoder.restEncoder;encoding.writeVarUint(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];encoding.writeVarUint(t,r.written),encoding.writeUint8Array(t,r.restEncoder)}},an=(e,t,n,r)=>{const s=new n(decoding.createDecoder(e)),i=new zt(s,!1),o=new r,c=new Kn(o);for(let d=i.curr;d!==null;d=i.next())jt(c,t(d),0);Yn(c);const a=Vt(s);return Mt(o,a),o.toUint8Array()},ys=({formatting:e=!0,subdocs:t=!0,yxml:n=!0}={})=>{let r=0;const s=map.create(),i=map.create(),o=map.create(),c=map.create();return c.set(null,null),a=>{switch(a.constructor){case _t:case ft:return a;case H:{const d=a,u=d.content;switch(u.constructor){case me:break;case Tt:{if(n){const g=u.type;g instanceof _e&&(g.nodeName=map.setIfUndefined(i,g.nodeName,()=>"node-"+r)),g instanceof Le&&(g.hookName=map.setIfUndefined(i,g.hookName,()=>"hook-"+r))}break}case $t:{const g=u;g.arr=g.arr.map(()=>r);break}case ye:{const g=u;g.content=new Uint8Array([r]);break}case be:{const g=u;t&&(g.opts={},g.doc.guid=r+"");break}case Jt:{const g=u;g.embed={};break}case nt:{const g=u;e&&(g.key=map.setIfUndefined(o,g.key,()=>r+""),g.value=map.setIfUndefined(c,g.value,()=>({i:r})));break}case Re:{const g=u;g.arr=g.arr.map(()=>r);break}case At:{const g=u;g.str=string.repeat(r%10+"",g.str.length);break}default:error.unexpectedCase()}return d.parentSub&&(d.parentSub=map.setIfUndefined(s,d.parentSub,()=>r+"")),r++,a}default:error.unexpectedCase()}}},vu=(e,t)=>an(e,ys(t),Ct,Zt),xu=(e,t)=>an(e,ys(t),bt,Bt),Ou=e=>an(e,f.id,Ct,Bt),Fo=e=>an(e,f.id,bt,Zt),ms="You must not compute changes after the event-handler fired.";class un{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Po(this.currentTarget,this.target))}deletes(t){return ue(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw ce(ms);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,c;if(this.adds(i)){let a=i.left;for(;a!==null&&this.adds(a);)a=a.left;if(this.deletes(i))if(a!==null&&this.deletes(a))o="delete",c=lt(a.content.getContent());else return;else a!==null&&this.deletes(a)?(o="update",c=lt(a.content.getContent())):(o="add",c=void 0)}else if(this.deletes(i))o="delete",c=lt(i.content.getContent());else return;t.set(s,{action:o,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw ce(ms);const n=this.target,r=T(),s=T(),i=[];if(t={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null;const a=()=>{c&&i.push(c)};for(let d=n._start;d!==null;d=d.right)d.deleted?this.deletes(d)&&!this.adds(d)&&((c===null||c.delete===void 0)&&(a(),c={delete:0}),c.delete+=d.length,s.add(d)):this.adds(d)?((c===null||c.insert===void 0)&&(a(),c={insert:[]}),c.insert=c.insert.concat(d.content.getContent()),r.add(d)):((c===null||c.retain===void 0)&&(a(),c={retain:0}),c.retain+=d.length);c!==null&&c.retain===void 0&&a()}this._changes=t}return t}}const Po=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}t=t._item.parent}return n},bs=80;let Xn=0;class zo{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Xn++}}const jo=e=>{e.timestamp=Xn++},Ss=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Xn++},Ho=(e,t,n)=>{if(e.length>=bs){const r=e.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return Ss(r,t,n),r}else{const r=new zo(t,n);return e.push(r),r}},hn=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((i,o)=>re(t-i.index)<re(t-o.index)?i:o);let r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,jo(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&re(n.index-s)<r.parent.length/bs?(Ss(n,r,s),n):Ho(e._searchMarker,r,s)},Be=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){e.splice(r,1);continue}s.p=i,i.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=Et(t,s.index+n))}},Mu=e=>{let t=e._start;const n=[];for(;t;)n.push(t),t=t.right;return n},dn=(e,t,n)=>{const r=e,s=t.changedParentTypes;for(;k(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Qr(r._eH,n,t)};class ot{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Xr(),this._dEH=Xr(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw xt()}clone(){throw xt()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Zr(this._eH,t)}observeDeep(t){Zr(this._dEH,t)}unobserve(t){qr(this._eH,t)}unobserveDeep(t){qr(this._dEH,t)}toJSON(){}}const ks=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let i=e._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=t)t-=o.length;else{for(let c=t;c<o.length&&r>0;c++)s.push(o[c]),r--;t=0}}i=i.right}return s},Es=e=>{const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},Bu=(e,t)=>{const n=[];let r=e._start;for(;r!==null;){if(r.countable&&qt(r,t)){const s=r.content.getContent();for(let i=0;i<s.length;i++)n.push(s[i])}r=r.right}return n},Ne=(e,t)=>{let n=0,r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)t(s[i],n++,e)}r=r.right}},Ds=(e,t)=>{const n=[];return Ne(e,(r,s)=>{n.push(t(r,s,e))}),n},Go=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Cs=(e,t)=>{const n=hn(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},fn=(e,t,n,r)=>{let s=n;const i=e.doc,o=i.clientID,c=i.store,a=n===null?t._start:n.right;let d=[];const u=()=>{d.length>0&&(s=new H(v(o,tt(c,o)),s,s&&s.lastId,a,a&&a.id,t,null,new $t(d)),s.integrate(e,0),d=[])};r.forEach(g=>{if(g===null)d.push(g);else switch(g.constructor){case Number:case Object:case Boolean:case Array:case String:d.push(g);break;default:switch(u(),g.constructor){case Uint8Array:case ArrayBuffer:s=new H(v(o,tt(c,o)),s,s&&s.lastId,a,a&&a.id,t,null,new ye(new Uint8Array(g))),s.integrate(e,0);break;case Xt:s=new H(v(o,tt(c,o)),s,s&&s.lastId,a,a&&a.id,t,null,new be(g)),s.integrate(e,0);break;default:if(g instanceof ot)s=new H(v(o,tt(c,o)),s,s&&s.lastId,a,a&&a.id,t,null,new Tt(g)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Is=ce("Length exceeded!"),As=(e,t,n,r)=>{if(n>t._length)throw Is;if(n===0)return t._searchMarker&&Be(t._searchMarker,n,r.length),fn(e,t,null,r);const s=n,i=hn(t,n);let o=t._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&ht(e,v(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Be(t._searchMarker,s,r.length),fn(e,t,o,r)},Jo=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return fn(e,t,s,n)},Ts=(e,t,n,r)=>{if(r===0)return;const s=n,i=r,o=hn(t,n);let c=t._start;for(o!==null&&(c=o.p,n-=o.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&ht(e,v(c.id.client,c.id.clock+n)),n-=c.length);for(;r>0&&c!==null;)c.deleted||(r<c.length&&ht(e,v(c.id.client,c.id.clock+r)),c.delete(e),r-=c.length),c=c.right;if(r>0)throw Is;t._searchMarker&&Be(t._searchMarker,s,-i+r)},gn=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Zn=(e,t,n,r)=>{const s=t._map.get(n)||null,i=e.doc,o=i.clientID;let c;if(r==null)c=new $t([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:c=new $t([r]);break;case Uint8Array:c=new ye(r);break;case Xt:c=new be(r);break;default:if(r instanceof ot)c=new Tt(r);else throw new Error("Unexpected content type")}new H(v(o,tt(i.store,o)),s,s&&s.lastId,null,null,t,n,c).integrate(e,0)},qn=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Us=e=>{const t={};return e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},vs=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted},Nu=(e,t,n)=>{let r=e._map.get(t)||null;for(;r!==null&&(!n.sv.has(r.id.client)||r.id.clock>=(n.sv.get(r.id.client)||0));)r=r.left;return r!==null&&qt(r,n)?r.content.getContent()[r.length-1]:void 0},pn=e=>to(e.entries(),t=>!t[1].deleted);class $o extends un{constructor(t,n){super(t,n),this._transaction=n}}class Ht extends ot{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Ht;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ht}clone(){const t=new Ht;return t.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),dn(this,t,new $o(this,t))}insert(t,n){this.doc!==null?G(this.doc,r=>{As(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?G(this.doc,n=>{Jo(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?G(this.doc,r=>{Ts(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Cs(this,t)}toArray(){return Es(this)}slice(t=0,n=this.length){return ks(this,t,n)}toJSON(){return this.map(t=>t instanceof ot?t.toJSON():t)}map(t){return Ds(this,t)}forEach(t){Ne(this,t)}[Symbol.iterator](){return Go(this)}_write(t){t.writeTypeRef(wc)}}const Wo=e=>new Ht;class Ko extends un{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Qt extends ot{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Qt}clone(){const t=new Qt;return this.forEach((n,r)=>{t.set(r,n instanceof ot?n.clone():n)}),t}_callObserver(t,n){dn(this,t,new Ko(this,t,n))}toJSON(){const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[r]=s instanceof ot?s.toJSON():s}}),t}get size(){return[...pn(this._map)].length}keys(){return Vn(pn(this._map),t=>t[0])}values(){return Vn(pn(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Vn(pn(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?G(this.doc,n=>{gn(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?G(this.doc,r=>{Zn(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return qn(this,t)}has(t){return vs(this,t)}clear(){this.doc!==null?G(this.doc,t=>{this.forEach(function(n,r,s){gn(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(_c)}}const Yo=e=>new Qt,Gt=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&co(e,t);class Qn{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Nt(),this.right.content.constructor){case nt:this.right.deleted||pe(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const xs=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case nt:t.right.deleted||pe(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&ht(e,v(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},wn=(e,t,n)=>{const r=new Map,s=hn(t,n);if(s){const i=new Qn(s.p.left,s.p,s.index,r);return xs(e,i,n-s.index)}else{const i=new Qn(null,t._start,0,r);return xs(e,i,n)}},Os=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===nt&&Gt(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,i=s.clientID;r.forEach((o,c)=>{const a=n.left,d=n.right,u=new H(v(i,tt(s.store,i)),a,a&&a.lastId,d,d&&d.id,t,null,new nt(c,o));u.integrate(e,0),n.right=u,n.forward()})},pe=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Ms=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===nt&&Gt(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},Bs=(e,t,n,r)=>{const s=e.doc,i=s.clientID,o=new Map;for(const c in r){const a=r[c],d=n.currentAttributes.get(c)||null;if(!Gt(d,a)){o.set(c,d);const{left:u,right:g}=n;n.right=new H(v(i,tt(s.store,i)),u,u&&u.lastId,g,g&&g.id,t,null,new nt(c,a)),n.right.integrate(e,0),n.forward()}}return o},tr=(e,t,n,r,s)=>{n.currentAttributes.forEach((p,_)=>{s[_]===void 0&&(s[_]=null)});const i=e.doc,o=i.clientID;Ms(n,s);const c=Bs(e,t,n,s),a=r.constructor===String?new At(r):r instanceof ot?new Tt(r):new Jt(r);let{left:d,right:u,index:g}=n;t._searchMarker&&Be(t._searchMarker,n.index,a.getLength()),u=new H(v(o,tt(i.store,o)),d,d&&d.lastId,u,u&&u.id,t,null,a),u.integrate(e,0),n.right=u,n.index=g,n.forward(),Os(e,t,n,c)},Ns=(e,t,n,r,s)=>{const i=e.doc,o=i.clientID;Ms(n,s);const c=Bs(e,t,n,s);t:for(;n.right!==null&&(r>0||c.size>0&&(n.right.deleted||n.right.content.constructor===nt));){if(!n.right.deleted)switch(n.right.content.constructor){case nt:{const{key:a,value:d}=n.right.content,u=s[a];if(u!==void 0){if(Gt(u,d))c.delete(a);else{if(r===0)break t;c.set(a,d)}n.right.delete(e)}else n.currentAttributes.set(a,d);break}default:r<n.right.length&&ht(e,v(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let a="";for(;r>0;r--)a+=`
`;n.right=new H(v(o,tt(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new At(a)),n.right.integrate(e,0),n.forward()}Os(e,t,n,c)},Ls=(e,t,n,r,s)=>{let i=t;const o=U();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===nt){const d=i.content;o.set(d.key,d)}i=i.right}let c=0,a=!1;for(;t!==i;){if(n===t&&(a=!0),!t.deleted){const d=t.content;switch(d.constructor){case nt:{const{key:u,value:g}=d,p=r.get(u)||null;(o.get(u)!==d||p===g)&&(t.delete(e),c++,!a&&(s.get(u)||null)===g&&p!==g&&(p===null?s.delete(u):s.set(u,p))),!a&&!t.deleted&&pe(s,d);break}}}t=t.right}return c},Xo=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===nt){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Zo=e=>{let t=0;return G(e.doc,n=>{let r=e._start,s=e._start,i=U();const o=B(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case nt:pe(o,s.content);break;default:t+=Ls(n,r,s,i,o),i=B(o),r=s;break}s=s.right}}),t},qo=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const i=e.beforeState.get(r)||0;s!==i&&ls(e,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===nt&&o.constructor!==_t&&t.add(o.parent)})}G(n,r=>{ae(e,e.deleteSet,s=>{if(s instanceof _t||!s.parent._hasFormatting||t.has(s.parent))return;const i=s.parent;s.content.constructor===nt?t.add(i):Xo(r,s)});for(const s of t)Zo(s)})},Rs=(e,t,n)=>{const r=n,s=B(t.currentAttributes),i=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Tt:case Jt:case At:n<t.right.length&&ht(e,v(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}i&&Ls(e,i,t.right,s,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Be(o._searchMarker,t.index,-r+n),t};class Qo extends un{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];G(t,r=>{const s=new Map,i=new Map;let o=this.target._start,c=null;const a={};let d="",u=0,g=0;const p=()=>{if(c!==null){let _=null;switch(c){case"delete":g>0&&(_={delete:g}),g=0;break;case"insert":(typeof d=="object"||d.length>0)&&(_={insert:d},s.size>0&&(_.attributes={},s.forEach((S,M)=>{S!==null&&(_.attributes[M]=S)}))),d="";break;case"retain":u>0&&(_={retain:u},so(a)||(_.attributes=eo({},a))),u=0;break}_&&n.push(_),c=null}};for(;o!==null;){switch(o.content.constructor){case Tt:case Jt:this.adds(o)?this.deletes(o)||(p(),c="insert",d=o.content.getContent()[0],p()):this.deletes(o)?(c!=="delete"&&(p(),c="delete"),g+=1):o.deleted||(c!=="retain"&&(p(),c="retain"),u+=1);break;case At:this.adds(o)?this.deletes(o)||(c!=="insert"&&(p(),c="insert"),d+=o.content.str):this.deletes(o)?(c!=="delete"&&(p(),c="delete"),g+=o.length):o.deleted||(c!=="retain"&&(p(),c="retain"),u+=o.length);break;case nt:{const{key:_,value:S}=o.content;if(this.adds(o)){if(!this.deletes(o)){const M=s.get(_)||null;Gt(M,S)?S!==null&&o.delete(r):(c==="retain"&&p(),Gt(S,i.get(_)||null)?delete a[_]:a[_]=S)}}else if(this.deletes(o)){i.set(_,S);const M=s.get(_)||null;Gt(M,S)||(c==="retain"&&p(),a[_]=M)}else if(!o.deleted){i.set(_,S);const M=a[_];M!==void 0&&(Gt(M,S)?M!==null&&o.delete(r):(c==="retain"&&p(),S===null?delete a[_]:a[_]=S))}o.deleted||(c==="insert"&&p(),pe(s,o.content));break}}o=o.right}for(p();n.length>0;){const _=n[n.length-1];if(_.retain!==void 0&&_.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class we extends ot{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new we}clone(){const t=new we;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new Qo(this,t,n);dn(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===At&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?G(this.doc,r=>{const s=new Qn(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const o=t[i];if(o.insert!==void 0){const c=!n&&typeof o.insert=="string"&&i===t.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof c!="string"||c.length>0)&&tr(r,this,s,c,o.attributes||{})}else o.retain!==void 0?Ns(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Rs(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){const s=[],i=new Map,o=this.doc;let c="",a=this._start;function d(){if(c.length>0){const g={};let p=!1;i.forEach((S,M)=>{p=!0,g[M]=S});const _={insert:c};p&&(_.attributes=g),s.push(_),c=""}}const u=()=>{for(;a!==null;){if(qt(a,t)||n!==void 0&&qt(a,n))switch(a.content.constructor){case At:{const g=i.get("ychange");t!==void 0&&!qt(a,t)?(g===void 0||g.user!==a.id.client||g.type!=="removed")&&(d(),i.set("ychange",r?r("removed",a.id):{type:"removed"})):n!==void 0&&!qt(a,n)?(g===void 0||g.user!==a.id.client||g.type!=="added")&&(d(),i.set("ychange",r?r("added",a.id):{type:"added"})):g!==void 0&&(d(),i.delete("ychange")),c+=a.content.str;break}case Tt:case Jt:{d();const g={insert:a.content.getContent()[0]};if(i.size>0){const p={};g.attributes=p,i.forEach((_,S)=>{p[S]=_})}s.push(g);break}case nt:qt(a,t)&&(d(),pe(i,a.content));break}a=a.right}d()};return t||n?G(o,g=>{t&&$n(g,t),n&&$n(g,n),u()},"cleanup"):u(),s}insert(t,n,r){if(n.length<=0)return;const s=this.doc;s!==null?G(s,i=>{const o=wn(i,this,t);r||(r={},o.currentAttributes.forEach((c,a)=>{r[a]=c})),tr(i,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r={}){const s=this.doc;s!==null?G(s,i=>{const o=wn(i,this,t);tr(i,this,o,n,r)}):this._pending.push(()=>this.insertEmbed(t,n,r))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?G(r,s=>{Rs(s,wn(s,this,t),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const s=this.doc;s!==null?G(s,i=>{const o=wn(i,this,t);o.right!==null&&Ns(i,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?G(this.doc,n=>{gn(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?G(this.doc,r=>{Zn(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return qn(this,t)}getAttributes(){return Us(this)}_write(t){t.writeTypeRef(yc)}}const tc=e=>new we;class er{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===_e||n.constructor===te)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class te extends ot{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new te}clone(){const t=new te;return t.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new er(this,t)}querySelector(t){t=t.toUpperCase();const r=new er(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),kt(new er(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){dn(this,t,new rc(this,n,t))}toString(){return Ds(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),Ne(this,i=>{s.insertBefore(i.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?G(this.doc,r=>{As(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)G(this.doc,r=>{const s=t&&t instanceof ot?t._item:t;fn(r,this,s,n)});else{const r=this._prelimContent,s=t===null?0:r.findIndex(i=>i===t)+1;if(s===0&&t!==null)throw ce("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?G(this.doc,r=>{Ts(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Es(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Cs(this,t)}slice(t=0,n=this.length){return ks(this,t,n)}forEach(t){Ne(this,t)}_write(t){t.writeTypeRef(bc)}}const ec=e=>new te;class _e extends te{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new _e(this.nodeName)}clone(){const t=new _e(this.nodeName),n=this.getAttributes();return ro(n,(r,s)=>{typeof r=="string"&&t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof ot?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const c in t)r.push(c);r.sort();const s=r.length;for(let c=0;c<s;c++){const a=r[c];n.push(a+'="'+t[a]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?G(this.doc,n=>{gn(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?G(this.doc,r=>{Zn(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return qn(this,t)}hasAttribute(t){return vs(this,t)}getAttributes(){return Us(this)}toDOM(t=document,n={},r){const s=t.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const c=i[o];typeof c=="string"&&s.setAttribute(o,c)}return Ne(this,o=>{s.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(mc),t.writeKey(this.nodeName)}}const nc=e=>new _e(e.readKey());class rc extends un{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class Le extends Qt{constructor(t){super(),this.hookName=t}_copy(){return new Le(this.hookName)}clone(){const t=new Le(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const s=n[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(Sc),t.writeKey(this.hookName)}}const sc=e=>new Le(e.readKey());class _n extends we{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new _n}clone(){const t=new _n;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const i=[];for(const o in t.attributes[s])i.push({key:o,value:t.attributes[s][o]});i.sort((o,c)=>o.key<c.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const c=i.attrs[o];r+=` ${c.key}="${c.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(kc)}}const ic=e=>new _n;class Vs{constructor(t,n){this.id=t,this.length=n}get deleted(){throw xt()}mergeWith(t){return!1}write(t,n,r){throw xt()}integrate(t,n){throw xt()}}const oc=0;class _t extends Vs{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),os(t.doc.store,this)}write(t,n){t.writeInfo(oc),t.writeLen(this.length-n)}getMissing(t,n){return null}}class ye{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ye(this.content)}splice(t){throw xt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const cc=e=>new ye(e.readBuf());class me{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new me(this.len)}splice(t){const n=new me(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Oe(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const lc=e=>new me(e.readLen()),Fs=(e,t)=>new Xt(sr(mn({guid:e},t),{shouldLoad:t.shouldLoad||t.autoLoad||!1}));class be{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new be(Fs(this.doc.guid,this.opts))}splice(t){throw xt()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const ac=e=>new be(Fs(e.readString(),e.readAny()));class Jt{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Jt(this.embed)}splice(t){throw xt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const uc=e=>new Jt(e.readJSON());class nt{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new nt(this.key,this.value)}splice(t){throw xt()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const hc=e=>new nt(e.readKey(),e.readJSON());class Re{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Re(this.arr)}splice(t){const n=new Re(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const dc=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new Re(n)};class $t{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new $t(this.arr)}splice(t){const n=new $t(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeAny(i)}}getRef(){return 8}}const fc=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new $t(n)};class At{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new At(this.str)}splice(t){const n=new At(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const gc=e=>new At(e.readString()),pc=[Wo,Yo,tc,nc,ec,sc,ic],wc=0,_c=1,yc=2,mc=3,bc=4,Sc=5,kc=6;class Tt{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Tt(this.type._copy())}splice(t){throw xt()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Ec=e=>new Tt(pc[e.readTypeRef()](e)),nr=(e,t)=>{let n=t,r=0,s;do r>0&&(n=v(n.client,n.clock+r)),s=on(e,n),r=n.clock-s.id.clock,n=s.redone;while(n!==null&&s instanceof H);return{item:s,diff:r}},rr=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},yn=(e,t,n)=>{const{client:r,clock:s}=t.id,i=new H(v(r,s+n),t,v(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=v(t.redone.client,t.redone.clock+n)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=n,i},Ps=(e,t)=>bn(e,n=>ue(n.deletions,t)),zs=(e,t,n,r,s,i)=>{const o=e.doc,c=o.store,a=o.clientID,d=t.redone;if(d!==null)return ht(e,d);let u=t.parent._item,g=null,p;if(u!==null&&u.deleted===!0){if(u.redone===null&&(!n.has(u)||zs(e,u,n,r,s,i)===null))return null;for(;u.redone!==null;)u=ht(e,u.redone)}const _=u===null?t.parent:u.content.type;if(t.parentSub===null){for(g=t.left,p=t;g!==null;){let et=g;for(;et!==null&&et.parent._item!==u;)et=et.redone===null?null:ht(e,et.redone);if(et!==null&&et.parent._item===u){g=et;break}g=g.left}for(;p!==null;){let et=p;for(;et!==null&&et.parent._item!==u;)et=et.redone===null?null:ht(e,et.redone);if(et!==null&&et.parent._item===u){p=et;break}p=p.right}}else if(p=null,t.right&&!s){for(g=t;g!==null&&g.right!==null&&(g.right.redone||ue(r,g.right.id)||Ps(i.undoStack,g.right.id)||Ps(i.redoStack,g.right.id));)for(g=g.right;g.redone;)g=ht(e,g.redone);if(g&&g.right!==null)return null}else g=_._map.get(t.parentSub)||null;const S=tt(c,a),M=v(a,S),Q=new H(M,g,g&&g.lastId,p,p&&p.id,_,t.parentSub,t.content.copy());return t.redone=M,rr(Q,!0),Q.integrate(e,0),Q};class H extends Vs{constructor(t,n,r,s,i,o,c,a){super(t,a.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=c,this.redone=null,this.content=a,this.info=this.content.isCountable()?gr:0}set marker(t){(this.info&xn)>0!==t&&(this.info^=xn)}get marker(){return(this.info&xn)>0}get keep(){return(this.info&fr)>0}set keep(t){this.keep!==t&&(this.info^=fr)}get countable(){return(this.info&gr)>0}get deleted(){return(this.info&vn)>0}set deleted(t){this.deleted!==t&&(this.info^=vn)}markDeleted(){this.info|=vn}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=tt(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=tt(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===fe&&this.id.client!==this.parent.client&&this.parent.clock>=tt(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=cs(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=ht(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===_t||this.right&&this.right.constructor===_t)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===H&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===H&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===fe){const r=on(n,this.parent);r.constructor===_t?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=cs(t,t.doc.store,v(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),ge(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(ge(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(on(t.doc.store,s.origin)))i.has(on(t.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),os(t.doc.store,this),this.content.integrate(t,this),us(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new _t(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:v(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&ge(t.origin,this.lastId)&&this.right===t&&ge(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Oe(t.deleteSet,this.id.client,this.id.clock,this.length),us(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Nt();this.content.gc(t),n?To(t,this,new _t(this.id,this.length)):this.content=new me(this.length)}write(t,n){const r=n>0?v(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&Ci|(r===null?0:We)|(s===null?0:pr)|(i===null?0:ui);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){const c=this.parent;if(c._item!==void 0){const a=c._item;if(a===null){const d=ns(c);t.writeParentInfo(!0),t.writeString(d)}else t.writeParentInfo(!1),t.writeLeftID(a.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===fe?(t.writeParentInfo(!1),t.writeLeftID(c)):Nt();i!==null&&t.writeString(i)}this.content.write(t,n)}}const js=(e,t)=>Dc[t&binary.BITS5](e),Dc=[()=>{Nt()},lc,dc,cc,gc,uc,hc,Ec,fc,ac,()=>{Nt()}],Cc=10;class ft extends null{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){error.unexpectedCase()}write(t,n){t.writeInfo(Cc),encoding.writeVarUint(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Hs=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Gs="__ $YJS$ __";Hs[Gs]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Hs[Gs]=!0}}]);
}());